import{r as Kr,g as qr,a as d,X as Xr}from"./vendor-state-BeFTS6K6.js";var xn={exports:{}},_t={};var Jn;function Qr(){if(Jn)return _t;Jn=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,r,o){var a=null;if(o!==void 0&&(a=""+o),r.key!==void 0&&(a=""+r.key),"key"in r){o={};for(var i in r)i!=="key"&&(o[i]=r[i])}else o=r;return r=o.ref,{$$typeof:n,type:s,key:a,ref:r!==void 0?r:null,props:o}}return _t.Fragment=e,_t.jsx=t,_t.jsxs=t,_t}var Zn;function Jr(){return Zn||(Zn=1,xn.exports=Qr()),xn.exports}var g=Jr(),mn={exports:{}},Ee={};var es;function Zr(){if(es)return Ee;es=1;var n=Kr();function e(l){var c="https://react.dev/errors/"+l;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)c+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+l+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function o(l,c,u){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:f==null?null:""+f,children:l,containerInfo:c,implementation:u}}var a=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function i(l,c){if(l==="font")return"";if(typeof c=="string")return c==="use-credentials"?c:""}return Ee.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Ee.createPortal=function(l,c){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)throw Error(e(299));return o(l,c,null,u)},Ee.flushSync=function(l){var c=a.T,u=s.p;try{if(a.T=null,s.p=2,l)return l()}finally{a.T=c,s.p=u,s.d.f()}},Ee.preconnect=function(l,c){typeof l=="string"&&(c?(c=c.crossOrigin,c=typeof c=="string"?c==="use-credentials"?c:"":void 0):c=null,s.d.C(l,c))},Ee.prefetchDNS=function(l){typeof l=="string"&&s.d.D(l)},Ee.preinit=function(l,c){if(typeof l=="string"&&c&&typeof c.as=="string"){var u=c.as,f=i(u,c.crossOrigin),h=typeof c.integrity=="string"?c.integrity:void 0,x=typeof c.fetchPriority=="string"?c.fetchPriority:void 0;u==="style"?s.d.S(l,typeof c.precedence=="string"?c.precedence:void 0,{crossOrigin:f,integrity:h,fetchPriority:x}):u==="script"&&s.d.X(l,{crossOrigin:f,integrity:h,fetchPriority:x,nonce:typeof c.nonce=="string"?c.nonce:void 0})}},Ee.preinitModule=function(l,c){if(typeof l=="string")if(typeof c=="object"&&c!==null){if(c.as==null||c.as==="script"){var u=i(c.as,c.crossOrigin);s.d.M(l,{crossOrigin:u,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0})}}else c==null&&s.d.M(l)},Ee.preload=function(l,c){if(typeof l=="string"&&typeof c=="object"&&c!==null&&typeof c.as=="string"){var u=c.as,f=i(u,c.crossOrigin);s.d.L(l,u,{crossOrigin:f,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0,type:typeof c.type=="string"?c.type:void 0,fetchPriority:typeof c.fetchPriority=="string"?c.fetchPriority:void 0,referrerPolicy:typeof c.referrerPolicy=="string"?c.referrerPolicy:void 0,imageSrcSet:typeof c.imageSrcSet=="string"?c.imageSrcSet:void 0,imageSizes:typeof c.imageSizes=="string"?c.imageSizes:void 0,media:typeof c.media=="string"?c.media:void 0})}},Ee.preloadModule=function(l,c){if(typeof l=="string")if(c){var u=i(c.as,c.crossOrigin);s.d.m(l,{as:typeof c.as=="string"&&c.as!=="script"?c.as:void 0,crossOrigin:u,integrity:typeof c.integrity=="string"?c.integrity:void 0})}else s.d.m(l)},Ee.requestFormReset=function(l){s.d.r(l)},Ee.unstable_batchedUpdates=function(l,c){return l(c)},Ee.useFormState=function(l,c,u){return a.H.useFormState(l,c,u)},Ee.useFormStatus=function(){return a.H.useHostTransitionStatus()},Ee.version="19.2.4",Ee}var ts;function eo(){if(ts)return mn.exports;ts=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),mn.exports=Zr(),mn.exports}var Tn=eo();const pc=qr(Tn);function Me(n,e="data-id"){let t=n;for(!t.tagName&&n.target&&(t=n.target);t;){if(t.getAttribute&&t.getAttribute(e))return t;t=t.parentNode}return null}function kn(n,e="data-id"){const t=Me(n,e);return t?t.getAttribute(e):null}function ot(n,e="data-id"){const t=Me(n,e);return t?vt(t.getAttribute(e)):null}function vt(n){if(typeof n=="string"){const e=n*1;if(!isNaN(e))return e}return n}function to(){return{detect:()=>!0,addEvent:function(n,e,t){return n.addEventListener(e,t),()=>n.removeEventListener(e,t)},addGlobalEvent:function(n,e){return document.addEventListener(n,e),()=>document.removeEventListener(n,e)},getTopNode:function(){return window.document.body}}}var Ie=to();function In(n){Object.assign(Ie,n)}function ns(n,e,t){function s(r){const o=Me(r);if(!o)return;const a=vt(o.dataset.id);if(typeof e=="function")return e(a,r);let i,l=r.target;for(;l!=o;){if(i=l.dataset?l.dataset.action:null,i&&e[i]){e[i](a,r);return}l=l.parentNode}e[t]&&e[t](a,r)}Ie.addEvent(n,t,s)}function Ps(n,e){ns(n,e,"click"),e.dblclick&&ns(n,e.dblclick,"dblclick")}function no(n,e){for(let t=n.length-1;t>=0;t--)if(n[t]===e){n.splice(t,1);break}}var Ws=new Date,Xt=!1,Ot=[],at=[],ss=n=>{if(Xt){Xt=!1;return}for(let e=at.length-1;e>=0;e--){const{node:t,date:s,props:r}=at[e];if(!(s>Ws)&&!t.contains(n.target)&&t!==n.target&&(r.callback&&r.callback(n),r.modal||n.defaultPrevented))break}},so=n=>{Ws=new Date,Xt=!0;for(let e=at.length-1;e>=0;e--){const{node:t}=at[e];if(!t.contains(n.target)&&t!==n.target){Xt=!1;break}}};function rn(n,e){Ot.length||(Ot=[Ie.addGlobalEvent("click",ss,n),Ie.addGlobalEvent("contextmenu",ss,n),Ie.addGlobalEvent("mousedown",so,n)]),typeof e!="object"&&(e={callback:e});const t={node:n,date:new Date,props:e};return at.push(t),{destroy(){no(at,t),at.length||(Ot.forEach(s=>s()),Ot=[])}}}var Pt=n=>n.indexOf("bottom")!==-1,Wt=n=>n.indexOf("left")!==-1,Ut=n=>n.indexOf("right")!==-1,pn=n=>n.indexOf("top")!==-1,rs=n=>n.indexOf("fit")!==-1,Yt=n=>n.indexOf("overlap")!==-1,ro=n=>n.split("-").every(e=>["center","fit"].indexOf(e)>-1),oo=n=>{const e=n.match(/(start|center|end)/);return e?e[0]:null};function ao(n,e){let t=0;const s=Ie.getTopNode(n);for(;n&&n!==s;){const r=getComputedStyle(n).position;if((r==="absolute"||r==="relative"||r==="fixed")&&(t=parseInt(getComputedStyle(n).zIndex)||0),n=n.parentNode,n===e)break}return t}var be,De,Ct,$e;function io(n,e,t="bottom",s=0,r=0){if(!n)return null;be=s,De=r,Ct="auto";let o=0,a=0;const i=lo(n),l=Yt(t)?Ie.getTopNode(n):i;if(!i)return null;const c=i.getBoundingClientRect(),u=n.getBoundingClientRect(),f=l.getBoundingClientRect(),h=window.getComputedStyle(l),x={left:0,top:0,bottom:0,right:0};for(const k in x){const S=`border-${k}-width`;x[k]=parseFloat(h.getPropertyValue(S))}if(e){const k=ao(e,i);o=Math.max(k+1,20)}if(e){if($e=e.getBoundingClientRect(),rs(t)&&(Ct=$e.width+"px"),t!=="point")if(ro(t))rs(t)?be=0:(be=f.width/2,a=1),De=(f.height-u.height)/2;else{const k=Yt(t)?0:1;be=Ut(t)?$e.right+k:$e.left-k,De=Pt(t)?$e.bottom+1:$e.top;const S=oo(t);S&&(Ut(t)||Wt(t)?S==="center"?De-=(u.height-$e.height)/2:S==="end"&&(De-=u.height-$e.height):(Pt(t)||pn(t))&&(S==="center"?be-=(u.width-$e.width)/2:S==="end"&&(be-=u.width-$e.width),Yt(t)||(be+=1)))}}else $e={left:s,right:s,top:r,bottom:r};const w=(Wt(t)||Ut(t))&&(Pt(t)||pn(t));Wt(t)&&(a=2);const m=be-u.width-f.left;e&&Wt(t)&&!w&&m<0&&(be=$e.right,a=0);const y=be+u.width*(1-a/2)-f.right;if(y>0)if(!Ut(t))be=f.right-x.right-u.width;else{const k=$e.left-f.x-u.width;e&&!Yt(t)&&!w&&k>=0?be=$e.left-u.width:be-=y+x.right}a&&(be=Math.round(be-u.width*a/2));const p=m<0||y>0||!w;pn(t)&&(De=$e.top-u.height,e&&De<f.y&&p&&(De=$e.bottom));const v=De+u.height-f.bottom;return v>0&&(e&&Pt(t)&&p?De-=u.height+$e.height+1:De-=v+x.bottom),be-=c.left+x.left,De-=c.top+x.top,be=Math.max(be,0)+l.scrollLeft,De=Math.max(De,0)+l.scrollTop,Ct=Ct||"auto",{x:be,y:De,z:o,width:Ct}}function lo(n){const e=Ie.getTopNode(n);for(n&&(n=n.parentElement);n;){const t=getComputedStyle(n).position;if(n===e||t==="relative"||t==="absolute"||t==="fixed")return n;n=n.parentNode}return null}var os=new Date().valueOf();function Hn(){return os+=1,os}function Te(n){return n<10?"0"+n:n.toString()}function co(n){const e=Te(n);return e.length==2?"0"+e:e}function Us(n){const e=Math.floor(n/11)*11;return{start:e,end:e+11}}function as(n,e=1){let t=n.getDay();t===0&&(t=7),t=(t-e+7)%7;const s=new Date(n.valueOf());s.setDate(n.getDate()+(3-t));const r=s.getFullYear(),o=Math.floor((s.getTime()-new Date(r,0,1).getTime())/864e5);return 1+Math.floor(o/7)}var is=["",""];function uo(n,e,t){switch(n){case"%d":return Te(e.getDate());case"%m":return Te(e.getMonth()+1);case"%j":return e.getDate();case"%n":return e.getMonth()+1;case"%y":return Te(e.getFullYear()%100);case"%Y":return e.getFullYear();case"%D":return t.dayShort[e.getDay()];case"%l":return t.dayFull[e.getDay()];case"%M":return t.monthShort[e.getMonth()];case"%F":return t.monthFull[e.getMonth()];case"%h":return Te((e.getHours()+11)%12+1);case"%g":return(e.getHours()+11)%12+1;case"%G":return e.getHours();case"%H":return Te(e.getHours());case"%i":return Te(e.getMinutes());case"%a":return((e.getHours()>11?t.pm:t.am)||is)[0];case"%A":return((e.getHours()>11?t.pm:t.am)||is)[1];case"%s":return Te(e.getSeconds());case"%S":return co(e.getMilliseconds());case"%W":return Te(as(e));case"%w":return Te(as(e,t.weekStart??1));case"%c":{let s=e.getFullYear()+"";return s+="-"+Te(e.getMonth()+1),s+="-"+Te(e.getDate()),s+="T",s+=Te(e.getHours()),s+=":"+Te(e.getMinutes()),s+=":"+Te(e.getSeconds()),s}case"%Q":return Math.floor(e.getMonth()/3)+1;default:return n}}var fo=/%[a-zA-Z]/g;function Qe(n,e){return typeof n=="function"?n:function(t){return t?(t.getMonth||(t=new Date(t)),n.replace(fo,s=>uo(s,t,e))):""}}function ls(n){return n&&typeof n=="object"&&!Array.isArray(n)}function bn(n,e){for(const t in e){const s=e[t];ls(n[t])&&ls(s)?n[t]=bn({...n[t]},e[t]):n[t]=e[t]}return n}function Dt(n){return{getGroup(e){const t=n[e];return s=>t&&t[s]||s},getRaw(){return n},extend(e,t){if(!e)return this;let s;return t?s=bn({...e},n):s=bn({...n},e),Dt(s)}}}function pe(n){const[e,t]=d.useState(n),s=d.useRef(n);return d.useEffect(()=>{if(s.current!==n){if(Array.isArray(s.current)&&Array.isArray(n)&&s.current.length===0&&n.length===0)return;s.current=n,t(n)}},[n]),[e,t]}function ho(n,e,t){const[s,r]=d.useState(()=>e);return n||console.warn(`Writable ${t} is not defined`),d.useEffect(()=>n?n.subscribe(a=>{r(()=>a)}):void 0,[n]),s}function B(n,e){const t=n.getState(),s=n.getReactiveState();return ho(s[e],t[e],e)}function jt(n,e){const[t,s]=d.useState(()=>null);return d.useEffect(()=>{if(!n)return;const r=n.getReactiveState(),o=r?r[e]:null;return o?o.subscribe(i=>s(()=>i)):void 0},[n,e]),t}function go(n,e){const t=d.useRef(e);t.current=e;const[s,r]=d.useState(1);return d.useEffect(()=>n.subscribe(a=>{t.current=a,r(i=>i+1)}),[n]),[t.current,s]}function Qt(n,e){const t=n.getState(),s=n.getReactiveState();return go(s[e],t[e])}function Ys(n,e){return typeof n=="function"?typeof e=="object"?n(e):n():n}function Bs(n){const e={};return n.split(";").forEach(t=>{const[s,r]=t.split(":");if(r){let o=s.trim();o.indexOf("-")&&(o=o.replace(/-([a-z])/g,(a,i)=>i.toUpperCase())),e[o]=r.trim()}}),e}function Vs(n){let e=n,t=[];return{subscribe:i=>{t.push(i),i(e)},unsubscribe:i=>{t=t.filter(l=>l!==i)},set:i=>{e=i,t.forEach(l=>l(e))},update:i=>{e=i(e),t.forEach(l=>l(e))}}}function cs(n,e,t){function s(r){const o=Me(r);if(!o)return;const a=vt(o.dataset.id);if(typeof e=="function")return e(a,r);let i,l=r.target;for(;l!=o;){if(i=l.dataset?l.dataset.action:null,i&&e[i]){e[i](a,r);return}l=l.parentNode}e[t]&&e[t](a,r)}return Ie.addEvent(n,t,s)}function xo(n,e){const t=[cs(n,e,"click")];return e.dblclick&&t.push(cs(n,e.dblclick,"dblclick")),()=>{t.forEach(s=>s())}}const mo="en-US",po={monthFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],hours:"Hours",minutes:"Minutes",done:"Done",clear:"Clear",today:"Today",am:["am","AM"],pm:["pm","PM"],weekStart:0,clockFormat:24},wo={ok:"OK",cancel:"Cancel",select:"Select","No data":"No data","Rows per page":"Rows per page","Total pages":"Total pages"},yo={timeFormat:"%H:%i",dateFormat:"%m/%d/%Y",monthYearFormat:"%F %Y",yearFormat:"%Y"},on={core:wo,calendar:po,formats:yo,lang:mo},an=d.createContext("willow"),vo=d.createContext({}),Oe=d.createContext(null),An=d.createContext(null),Be=Object.freeze(Object.defineProperty({__proto__:null,fieldId:An,helpers:vo,i18n:Oe,theme:an},Symbol.toStringTag,{value:"Module"}));function kt(n){const e=d.useContext(An),[t]=d.useState(()=>n||e&&e()||Hn());return t}function ko({value:n="",id:e,placeholder:t="",title:s="",disabled:r=!1,error:o=!1,readonly:a=!1,onChange:i}){const l=kt(e),[c,u]=pe(n),f=d.useCallback(w=>{const m=w.target.value;u(m),i&&i({value:m,input:!0})},[i]),h=d.useCallback(w=>{const m=w.target.value;u(m),i&&i({value:m})},[i]),x=d.useRef(null);return d.useEffect(()=>{const w=h,m=x.current;return m.addEventListener("change",w),()=>{m&&m.removeEventListener("change",w)}},[h]),g.jsx("textarea",{className:`wx-3yFVAC wx-textarea ${o?"wx-error":""}`,id:l,disabled:r,placeholder:t,readOnly:a,title:s,value:c,onInput:f,ref:x})}function xt({type:n="",css:e="",icon:t="",disabled:s=!1,title:r="",text:o="",children:a,onClick:i}){const l=d.useMemo(()=>{let u=n?n.split(" ").filter(f=>f!=="").map(f=>"wx-"+f).join(" "):"";return e+(e?" ":"")+u},[n,e]),c=u=>{i&&i(u)};return g.jsxs("button",{title:r,className:`wx-2ZWgb4 wx-button ${l} ${t&&!a?"wx-icon":""}`,disabled:s,onClick:c,children:[t&&g.jsx("i",{className:"wx-2ZWgb4 "+t}),a||o||" "]})}function bo({id:n,label:e="",inputValue:t="",value:s=!1,onChange:r,disabled:o=!1}){const a=kt(n),[i,l]=pe(s);return g.jsxs("div",{className:"wx-2IvefP wx-checkbox",children:[g.jsx("input",{type:"checkbox",id:a,disabled:o,className:"wx-2IvefP wx-check",checked:i,value:t,onChange:({target:c})=>{const u=c.checked;l(u),r&&r({value:u,inputValue:t})}}),g.jsxs("label",{htmlFor:a,className:"wx-2IvefP wx-label",children:[g.jsx("span",{className:"wx-2IvefP wx-before"}),e&&g.jsx("span",{className:"wx-2IvefP wx-after",children:e})]})]})}function ln({position:n="bottom",align:e="start",autoFit:t=!0,onCancel:s,width:r="100%",children:o}){const a=d.useRef(null),[i,l]=pe(n),[c,u]=pe(e);return d.useEffect(()=>{if(t){const f=a.current;if(f){const h=f.getBoundingClientRect(),x=Ie.getTopNode(f).getBoundingClientRect();h.right>=x.right&&u("end"),h.bottom>=x.bottom&&l("top")}}},[t]),d.useEffect(()=>{if(a.current){const f=h=>{s&&s(h)};return rn(a.current,f).destroy}},[s]),g.jsx("div",{ref:a,className:`wx-32GZ52 wx-dropdown wx-${i}-${c}`,style:{width:r},children:o})}function Tt(){return Dt(on)}function So(){let n=null,e=!1,t,s,r,o;const a=(u,f,h,x)=>{t=u,s=f,r=h,o=x},i=u=>{n=u,e=n!==null,r(n)},l=(u,f)=>{if(u!==null&&t){const h=t.querySelectorAll(".wx-list > .wx-item")[u];h&&(h.scrollIntoView({block:"nearest"}),f&&f.preventDefault())}},c=(u,f)=>{const h=u===null?null:Math.max(0,Math.min(n+u,s.length-1));h!==n&&(i(h),t?l(h,f):requestAnimationFrame(()=>l(h,f)))};return{move:u=>{const f=ot(u),h=s.findIndex(x=>x.id==f);h!==n&&i(h)},keydown:(u,f)=>{switch(u.code){case"Enter":e?o():i(0);break;case"Space":e||i(0);break;case"Escape":r(n=null);break;case"Tab":r(n=null);break;case"ArrowDown":c(e?1:f||0,u);break;case"ArrowUp":c(e?-1:f||0,u);break}},init:a,navigate:c}}function cn({items:n=[],children:e,onSelect:t,onReady:s}){const r=d.useRef(),o=d.useRef(So()),[a,i]=d.useState(null),l=d.useRef(a),c=(d.useContext(Oe)||Tt()).getGroup("core"),u=h=>{h&&h.stopPropagation(),t&&t({id:n[l.current]?.id})};d.useEffect(()=>{o.current.init(r.current,n,h=>{i(h),l.current=h},u)},[n,r.current]),d.useEffect(()=>{s&&s(o.current)},[]);const f=d.useCallback(()=>{o.current.navigate(null)},[o]);return a===null?null:g.jsx(ln,{onCancel:f,children:g.jsx("div",{className:"wx-233fr7 wx-list",ref:r,onClick:u,onMouseMove:o.current.move,children:n.length?n.map((h,x)=>g.jsx("div",{className:`wx-233fr7 wx-item ${x===a?"wx-focus":""}`,"data-id":h.id,children:e?Ys(e,{option:h}):h.label},h.id)):g.jsx("div",{className:"wx-233fr7 wx-no-data",children:c("No data")})})})}function _o({value:n="",id:e,options:t=[],textOptions:s=null,textField:r="label",placeholder:o="",title:a="",disabled:i=!1,error:l=!1,clear:c=!1,children:u,onChange:f}){const h=kt(e),x=d.useRef(null),w=d.useRef(null),[m,y]=pe(n),[p,v]=d.useState(!1),[k,S]=d.useState(""),N=d.useRef(null),_=d.useRef(!1),C=d.useMemo(()=>{if(p)return k;if(m||m===0){const F=(s||t).find(P=>P.id===m);if(F)return F[r]}return""},[p,k,m,s,t,r]),$=d.useMemo(()=>!C||!p?t:t.filter(F=>F[r].toLowerCase().includes(C.toLowerCase())),[C,p,t,r]),L=d.useCallback(()=>$.findIndex(F=>F.id===m),[$,m]),I=d.useCallback(F=>{x.current=F.navigate,w.current=F.keydown},[]),T=d.useCallback((F,P)=>{if(F||F===0){let q=t.find(R=>R.id===F);if(v(!1),P&&x.current(null),q&&m!==q.id){const R=q.id;y(R),f&&f({value:R})}}!_.current&&P&&N.current.focus()},[t,m,f]),Y=d.useCallback(({id:F})=>{T(F,!0)},[T]),K=d.useCallback(F=>{F&&F.stopPropagation(),y(""),v(!1),f&&f({value:""})},[f]),D=d.useCallback(F=>{if(!t.length)return;if(F===""&&c){K();return}let P=t.find(R=>R[r]===F);P||(P=t.find(R=>R[r].toLowerCase().includes(F.toLowerCase())));const q=P?P.id:m||t[0].id;T(q,!1)},[t,r,c,m,T,K]),A=d.useCallback(()=>{S(N.current.value),v(!0),$.length?x.current(0):x.current(null)},[$.length,x]),E=d.useCallback(()=>{_.current=!0},[]),U=d.useCallback(()=>{_.current=!1,setTimeout(()=>{_.current||D(C)},200)},[D,C]);return g.jsxs("div",{className:"wx-1j11Jk wx-combo",onClick:()=>x.current(L()),onKeyDown:F=>w.current(F,L()),title:a,children:[g.jsx("input",{className:"wx-1j11Jk wx-input "+(l?"wx-error":""),id:h,ref:N,value:C,disabled:i,placeholder:o,onFocus:E,onBlur:U,onInput:A}),c&&!i&&m?g.jsx("i",{className:"wx-1j11Jk wx-icon wxi-close",onClick:K}):g.jsx("i",{className:"wx-1j11Jk wx-icon wxi-angle-down"}),!i&&g.jsx(cn,{items:$,onReady:I,onSelect:Y,children:({option:F})=>g.jsx(g.Fragment,{children:u?u({option:F}):F[r]})})]})}function It({value:n="",id:e,readonly:t=!1,focus:s=!1,select:r=!1,type:o="text",placeholder:a="",disabled:i=!1,error:l=!1,inputStyle:c={},title:u="",css:f="",icon:h="",clear:x=!1,onChange:w}){const m=kt(e),[y,p]=pe(n),v=d.useRef(null),k=d.useMemo(()=>h&&f.indexOf("wx-icon-left")===-1?"wx-icon-right "+f:f,[h,f]),S=d.useMemo(()=>h&&f.indexOf("wx-icon-left")!==-1,[h,f]);d.useEffect(()=>{const L=setTimeout(()=>{s&&v.current&&v.current.focus(),r&&v.current&&v.current.select()},1);return()=>clearTimeout(L)},[s,r]);const N=d.useCallback(L=>{const I=L.target.value;p(I),w&&w({value:I,input:!0})},[w]),_=d.useCallback(L=>w&&w({value:L.target.value}),[w]);function C(L){L.stopPropagation(),p(""),w&&w({value:""})}let $=o;return o!=="password"&&o!=="number"&&($="text"),d.useEffect(()=>{const L=_,I=v.current;return I.addEventListener("change",L),()=>{I&&I.removeEventListener("change",L)}},[_]),g.jsxs("div",{className:`wx-hQ64J4 wx-text ${k} ${l?"wx-error":""} ${i?"wx-disabled":""} ${x?"wx-clear":""}`,children:[g.jsx("input",{className:"wx-hQ64J4 wx-input",ref:v,id:m,readOnly:t,disabled:i,placeholder:a,type:$,style:c,title:u,value:y,onInput:N}),x&&!i&&y?g.jsxs(g.Fragment,{children:[g.jsx("i",{className:"wx-hQ64J4 wx-icon wxi-close",onClick:C}),S&&g.jsx("i",{className:`wx-hQ64J4 wx-icon ${h}`})]}):h?g.jsx("i",{className:`wx-hQ64J4 wx-icon ${h}`}):null]})}function Co({date:n,type:e,part:t,onShift:s}){const{calendar:r,formats:o}=d.useContext(Oe).getRaw(),a=n.getFullYear(),i=d.useMemo(()=>{switch(e){case"month":return Qe(o.monthYearFormat,r)(n);case"year":return Qe(o.yearFormat,r)(n);case"duodecade":{const{start:c,end:u}=Us(a),f=Qe(o.yearFormat,r);return`${f(new Date(c,0,1))} - ${f(new Date(u,11,31))}`}default:return""}},[n,e,a,r,o]);function l(){s&&s({diff:0,type:e})}return g.jsxs("div",{className:"wx-8HQVQV wx-header",children:[t!=="right"?g.jsx("i",{className:"wx-8HQVQV wx-pager wxi-angle-left",onClick:()=>s&&s({diff:-1,type:e})}):g.jsx("span",{className:"wx-8HQVQV wx-spacer"}),g.jsx("span",{className:"wx-8HQVQV wx-label",onClick:l,children:i}),t!=="left"?g.jsx("i",{className:"wx-8HQVQV wx-pager wxi-angle-right",onClick:()=>s&&s({diff:1,type:e})}):g.jsx("span",{className:"wx-8HQVQV wx-spacer"})]})}function Ln({onClick:n,children:e}){return g.jsx("button",{className:"wx-3s8W4d wx-button",onClick:n,children:e})}function jo({value:n,current:e,part:t="",markers:s=null,onCancel:r,onChange:o}){const a=(d.useContext(Oe)||Tt()).getRaw().calendar,i=(a.weekStart||7)%7,l=a.dayShort.slice(i).concat(a.dayShort.slice(0,i)),c=(S,N,_)=>new Date(S.getFullYear(),S.getMonth()+(N||0),S.getDate()+(_||0));let u=t!=="normal";function f(S){const N=S.getDay();return N===0||N===6}function h(){const S=c(e,0,1-e.getDate());return S.setDate(S.getDate()-(S.getDay()-(i-7))%7),S}function x(){const S=c(e,1,-e.getDate());return S.setDate(S.getDate()+(6-S.getDay()+i)%7),S}const w=d.useRef(0);function m(S,N){N.timeStamp!==w.current&&(w.current=N.timeStamp,N.stopPropagation(),o&&o(new Date(new Date(S))),r&&r())}const y=d.useMemo(()=>t=="normal"?[n?c(n).valueOf():0]:n?[n.start?c(n.start).valueOf():0,n.end?c(n.end).valueOf():0]:[0,0],[t,n]),p=d.useMemo(()=>{const S=h(),N=x(),_=e.getMonth();let C=[];for(let $=S;$<=N;$.setDate($.getDate()+1)){const L={day:$.getDate(),in:$.getMonth()===_,date:$.valueOf()};let I="";if(I+=L.in?"":" wx-inactive",I+=y.indexOf(L.date)>-1?" wx-selected":"",u){const T=L.date==y[0],Y=L.date==y[1];T&&!Y?I+=" wx-left":Y&&!T&&(I+=" wx-right"),L.date>y[0]&&L.date<y[1]&&(I+=" wx-inrange")}if(I+=f($)?" wx-weekend":"",s){const T=s($);T&&(I+=" "+T)}C.push({...L,css:I})}return C},[e,y,u,s]),v=d.useRef(null);let k=d.useRef({});return k.current.click=m,d.useEffect(()=>{Ps(v.current,k.current)},[]),g.jsxs("div",{children:[g.jsx("div",{className:"wx-398RBS wx-weekdays",children:l.map(S=>g.jsx("div",{className:"wx-398RBS wx-weekday",children:S},S))}),g.jsx("div",{className:"wx-398RBS wx-days",ref:v,children:p.map(S=>g.jsx("div",{className:`wx-398RBS wx-day ${S.css} ${S.in?"":"wx-out"}`,"data-id":S.date,children:S.day},S.date))})]})}function $o({value:n,current:e,part:t,onCancel:s,onChange:r,onShift:o}){const[a,i]=pe(n||new Date),[l,c]=pe(e||new Date),u=d.useContext(Oe).getRaw().calendar,f=u.monthShort||[],h=d.useMemo(()=>l.getMonth(),[l]),x=d.useCallback((y,p)=>{if(y!=null){p.stopPropagation();const v=new Date(l);v.setMonth(y),c(v),o&&o({current:v})}t==="normal"&&i(new Date(l)),s&&s()},[l,t,o,s]),w=d.useCallback(()=>{const y=new Date(Gs(a,t)||l);y.setMonth(l.getMonth()),y.setFullYear(l.getFullYear()),r&&r(y)},[a,l,t,r]),m=d.useCallback(y=>{const p=y.target.closest("[data-id]");if(p){const v=parseInt(p.getAttribute("data-id"),10);x(v,y)}},[x]);return g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"wx-34U8T8 wx-months",onClick:m,children:f.map((y,p)=>g.jsx("div",{className:"wx-34U8T8 wx-month"+(h===p?" wx-current":""),"data-id":p,children:y},p))}),g.jsx("div",{className:"wx-34U8T8 wx-buttons",children:g.jsx(Ln,{onClick:w,children:u.done})})]})}const wn="wx-1XEF33",Mo=({value:n,current:e,onCancel:t,onChange:s,onShift:r,part:o})=>{const a=d.useContext(Oe).getRaw().calendar,[i,l]=pe(e),[c,u]=pe(n),f=d.useMemo(()=>i.getFullYear(),[i]),h=d.useMemo(()=>{const{start:p,end:v}=Us(f),k=[];for(let S=p;S<=v;++S)k.push(S);return k},[f]),x={click:w};function w(p,v){if(p){v.stopPropagation();const k=new Date(i);k.setFullYear(p),l(k),r&&r({current:k})}o==="normal"&&u(new Date(i)),t&&t()}function m(){const p=new Date(Gs(c,o)||i);p.setFullYear(i.getFullYear()),s&&s(p)}const y=d.useRef(null);return d.useEffect(()=>{y.current&&Ps(y.current,x)},[]),g.jsxs(g.Fragment,{children:[g.jsx("div",{className:wn+" wx-years",ref:y,children:h.map((p,v)=>g.jsx("div",{className:wn+` wx-year ${f==p?"wx-current":""} ${v===0?"wx-prev-decade":""} ${v===11?"wx-next-decade":""}`,"data-id":p,children:p},v))}),g.jsx("div",{className:wn+" wx-buttons",children:g.jsx(Ln,{onClick:m,children:a.done})})]})},us={month:{component:jo,next:Eo,prev:No},year:{component:$o,next:Do,prev:Ro},duodecade:{component:Mo,next:Io,prev:To}};function No(n){return n=new Date(n),n.setMonth(n.getMonth()-1),n}function Eo(n){return n=new Date(n),n.setMonth(n.getMonth()+1),n}function Ro(n){return n=new Date(n),n.setFullYear(n.getFullYear()-1),n}function Do(n){return n=new Date(n),n.setFullYear(n.getFullYear()+1),n}function To(n){return n=new Date(n),n.setFullYear(n.getFullYear()-10),n}function Io(n){return n=new Date(n),n.setFullYear(n.getFullYear()+10),n}function Gs(n,e){let t;if(e==="normal")t=n;else{const{start:s,end:r}=n;e==="left"?t=s:e=="right"?t=r:t=s&&r}return t}const Ho=["clear","today"];function Ao(n){if(n==="done")return-1;if(n==="clear")return null;if(n==="today")return new Date}function Lo({value:n,current:e,onCurrentChange:t,part:s="normal",markers:r=null,buttons:o,onShift:a,onChange:i}){const l=d.useContext(Oe).getGroup("calendar"),[c,u]=d.useState("month"),f=Array.isArray(o)?o:o?Ho:[],h=(p,v)=>{p.preventDefault(),i&&i({value:v})},x=()=>{c==="duodecade"?u("year"):c==="year"&&u("month")},w=p=>{const{diff:v,current:k}=p;if(v===0){c==="month"?u("year"):c==="year"&&u("duodecade");return}if(v){const S=us[c];t(v>0?S.next(e):S.prev(e))}else k&&t(k);a&&a()},m=p=>{u("month"),i&&i({select:!0,value:p})},y=d.useMemo(()=>us[c].component,[c]);return g.jsx("div",{className:`wx-2Gr4AS wx-calendar ${s!=="normal"&&s!=="both"?"wx-part":""}`,children:g.jsxs("div",{className:"wx-2Gr4AS wx-wrap",children:[g.jsx(Co,{date:e,part:s,type:c,onShift:w}),g.jsxs("div",{children:[g.jsx(y,{value:n,current:e,onCurrentChange:t,part:s,markers:r,onCancel:x,onChange:m,onShift:w}),c==="month"&&f.length>0&&g.jsx("div",{className:"wx-2Gr4AS wx-buttons",children:f.map(p=>g.jsx("div",{className:"wx-2Gr4AS wx-button-item",children:g.jsx(Ln,{onClick:v=>h(v,Ao(p)),children:l(p)})},p))})]})]})})}function Ks(n){let{words:e=null,optional:t=!1,children:s}=n,r=d.useContext(Oe);const o=d.useMemo(()=>{let a=r;return(!a||!a.extend)&&(a=Dt(on)),e!==null&&(a=a.extend(e,t)),a},[e,t,r]);return g.jsx(Oe.Provider,{value:o,children:s})}function ds(n,e,t,s){if(!n||s){const r=e?new Date(e):new Date;r.setDate(1),t(r)}else if(n.getDate()!==1){const r=new Date(n);r.setDate(1),t(r)}}const Fo=["clear","today"];function qs({value:n,current:e,markers:t=null,buttons:s=Fo,onChange:r}){const[o,a]=pe(n),[i,l]=pe(e);d.useEffect(()=>{ds(i,o,l,!1)},[o,i]);const c=d.useCallback(f=>{const h=f.value;h?(a(new Date(h)),ds(i,new Date(h),l,!0)):a(null),r&&r({value:h?new Date(h):null})},[r,i]),u=d.useCallback(f=>{l(f)},[l]);return i?g.jsx(Ks,{children:g.jsx(Lo,{value:o,current:i,markers:t,buttons:s,onChange:c,onCurrentChange:u})}):null}const zo=["clear","today"];function Oo({value:n,id:e,disabled:t=!1,error:s=!1,width:r="unset",align:o="start",placeholder:a="",format:i="",buttons:l=zo,css:c="",title:u="",editable:f=!1,clear:h=!1,onChange:x}){const{calendar:w,formats:m}=(d.useContext(Oe)||Tt()).getRaw(),y=i||m?.dateFormat;let p=typeof y=="function"?y:Qe(y,w);const[v,k]=d.useState(n),[S,N]=d.useState(!1);d.useEffect(()=>{k(n)},[n]);function _(){N(!1)}function C(I){const T=I===v||I&&v&&I.valueOf()===v.valueOf()||!I&&!v;k(I),T||x&&x({value:I}),setTimeout(_,1)}const $=d.useMemo(()=>v?p(v):"",[v,p]);function L({value:I,input:T}){if(!f&&!h||T)return;let Y=typeof f=="function"?f(I):I?new Date(I):null;Y=isNaN(Y)?v||null:Y||null,C(Y)}return d.useEffect(()=>{const I=_;return window.addEventListener("scroll",I),()=>window.removeEventListener("scroll",I)},[]),g.jsxs("div",{className:"wx-1lKOFG wx-datepicker",onClick:()=>N(!0),children:[g.jsx(It,{css:c,title:u,value:$,id:e,readonly:!f,disabled:t,error:s,placeholder:a,onInput:_,onChange:L,icon:"wxi-calendar",inputStyle:{cursor:"pointer",width:"100%",paddingRight:"calc(var(--wx-input-icon-size) + var(--wx-input-icon-indent) * 2)"},clear:h}),S&&!t&&g.jsx(ln,{onCancel:_,width:r,align:o,autoFit:!!o,children:g.jsx(qs,{buttons:l,value:v,onChange:I=>C(I.value)})})]})}function Xs({value:n="",options:e=[],textOptions:t=null,placeholder:s="",disabled:r=!1,error:o=!1,title:a="",textField:i="label",clear:l=!1,children:c,onChange:u}){const f=d.useRef(null),h=d.useRef(null);let[x,w]=pe(n);function m(S){f.current=S.navigate,h.current=S.keydown}const y=d.useMemo(()=>x||x===0?(t||e).find(S=>S.id===x):null,[x,t,e]),p=d.useCallback(({id:S})=>{(S||S===0)&&(w(S),f.current(null),u&&u({value:S}))},[w,u]),v=d.useCallback(S=>{S.stopPropagation(),w(""),u&&u({value:""})},[w,u]),k=d.useCallback(()=>e.findIndex(S=>S.id===x),[e,x]);return g.jsxs("div",{className:`wx-2YgblL wx-richselect ${o?"wx-2YgblL wx-error":""} ${r?"wx-2YgblL wx-disabled":""} ${c?"":"wx-2YgblL wx-nowrap"}`,title:a,onClick:()=>f.current(k()),onKeyDown:S=>h.current(S,k()),tabIndex:0,children:[g.jsx("div",{className:"wx-2YgblL wx-label",children:y?c?c(y):y[i]:s?g.jsx("span",{className:"wx-2YgblL wx-placeholder",children:s}):"Â "}),l&&!r&&x?g.jsx("i",{className:"wx-2YgblL wx-icon wxi-close",onClick:v}):g.jsx("i",{className:"wx-2YgblL wx-icon wxi-angle-down"}),!r&&g.jsx(cn,{items:e,onReady:m,onSelect:p,children:({option:S})=>c?c(S):S[i]})]})}function Sn({id:n,label:e="",css:t="",min:s=0,max:r=100,value:o=0,step:a=1,title:i="",disabled:l=!1,onChange:c}){const u=kt(n),[f,h]=pe(o),x=d.useRef({value:f,input:f}),w=d.useMemo(()=>(f-s)/(r-s)*100+"%",[f,s,r]),m=d.useMemo(()=>l?"":`linear-gradient(90deg, var(--wx-slider-primary) 0% ${w}, var(--wx-slider-background) ${w} 100%)`,[l,w]);function y({target:k}){const S=k.value*1;h(S),c&&c({value:S,previous:x.current.input,input:!0}),x.current.input=S}function p({target:k}){const S=k.value*1;h(S),c&&c({value:S,previous:x.current.value}),x.current.value=S}d.useEffect(()=>{h(o)},[o]);const v=d.useRef(null);return d.useEffect(()=>{if(v.current)return v.current.addEventListener("change",p),()=>{v.current&&v.current.removeEventListener("change",p)}},[v,p]),g.jsxs("div",{className:`wx-2EDJ8G wx-slider ${t}`,title:i,children:[e&&g.jsx("label",{className:"wx-2EDJ8G wx-label",htmlFor:u,children:e}),g.jsx("div",{className:"wx-2EDJ8G wx-inner",children:g.jsx("input",{id:u,className:"wx-2EDJ8G wx-input",type:"range",min:s,max:r,step:a,disabled:l,value:f,onInput:y,style:{background:m},ref:v})})]})}const Po=({id:n,value:e=0,step:t=1,min:s=0,max:r=1/0,error:o=!1,disabled:a=!1,readonly:i=!1,onChange:l})=>{const c=kt(n),[u,f]=pe(e),h=d.useCallback(()=>{if(i||u<=s)return;const y=u-t;f(y),l&&l({value:y})},[u,i,s,t,l]),x=d.useCallback(()=>{if(i||u>=r)return;const y=u+t;f(y),l&&l({value:y})},[u,i,r,t,l]),w=d.useCallback(()=>{if(!i){const y=Math.round(Math.min(r,Math.max(u,s))/t)*t,p=isNaN(y)?Math.max(s,0):y;f(p),l&&l({value:p})}},[i,u,r,s,t,l]),m=d.useCallback(y=>{const p=y.target.value*1;f(p),l&&l({value:p,input:!0})},[l]);return g.jsxs("div",{className:`wx-22t21n wx-counter ${a?"wx-disabled":""} ${i?"wx-readonly":""} ${o?"wx-error":""}`,children:[g.jsx("button",{"aria-label":"-",className:"wx-22t21n wx-btn wx-btn-dec",disabled:a,onClick:h,children:g.jsx("svg",{className:"wx-22t21n wx-dec",width:"12",height:"2",viewBox:"0 0 12 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:g.jsx("path",{d:"M11.2501 1.74994H0.750092V0.249939H11.2501V1.74994Z"})})}),g.jsx("input",{id:c,type:"text",className:"wx-22t21n wx-input",disabled:a,readOnly:i,required:!0,value:u,onBlur:w,onInput:m}),g.jsx("button",{"aria-label":"-",className:"wx-22t21n wx-btn wx-btn-inc",disabled:a,onClick:x,children:g.jsx("svg",{className:"wx-22t21n wx-inc",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:g.jsx("path",{d:`M11.2501
								6.74994H6.75009V11.2499H5.25009V6.74994H0.750092V5.24994H5.25009V0.749939H6.75009V5.24994H11.2501V6.74994Z`})})})]})};function Wo({notice:n={}}){function e(){n.remove&&n.remove()}return g.jsxs("div",{className:`wx-11sNg5 wx-notice wx-${n.type?n.type:""}`,role:"status","aria-live":"polite",children:[g.jsx("div",{className:"wx-11sNg5 wx-text",children:n.text}),g.jsx("div",{className:"wx-11sNg5 wx-button",children:g.jsx("i",{className:"wx-11sNg5 wxi-close",onClick:e})})]})}function Uo({data:n=[]}){return g.jsx("div",{className:"wx-3nwoO9 wx-notices",children:n.map(e=>g.jsx(Wo,{notice:e},e.id))})}function Yo({title:n="",buttons:e=["cancel","ok"],header:t,children:s,footer:r,onConfirm:o,onCancel:a}){const i=(d.useContext(Oe)||Tt()).getGroup("core"),l=d.useRef(null);d.useEffect(()=>{l.current?.focus()},[]);function c(f){switch(f.code){case"Enter":{const h=f.target.tagName;if(h==="TEXTAREA"||h==="BUTTON")return;o&&o({event:f});break}case"Escape":a&&a({event:f});break}}function u(f,h){const x={event:f,button:h};h==="cancel"?a&&a(x):o&&o(x)}return g.jsx("div",{className:"wx-1FxkZa wx-modal",ref:l,tabIndex:0,onKeyDown:c,children:g.jsxs("div",{className:"wx-1FxkZa wx-window",children:[t||(n?g.jsx("div",{className:"wx-1FxkZa wx-header",children:n}):null),g.jsx("div",{children:s}),r||e&&g.jsx("div",{className:"wx-1FxkZa wx-buttons",children:e.map(f=>g.jsx("div",{className:"wx-1FxkZa wx-button",children:g.jsx(xt,{type:`block ${f==="ok"?"primary":"secondary"}`,onClick:h=>u(h,f),children:i(f)})},f))})]})})}function Bo({children:n},e){const[t,s]=d.useState(null),[r,o]=d.useState([]);return d.useImperativeHandle(e,()=>({showModal:a=>{const i={...a};return s(i),new Promise((l,c)=>{i.resolve=u=>{s(null),l(u)},i.reject=u=>{s(null),c(u)}})},showNotice:a=>{a={...a},a.id=a.id||Hn(),a.remove=()=>o(i=>i.filter(l=>l.id!==a.id)),a.expire!=-1&&setTimeout(a.remove,a.expire||5100),o(i=>[...i,a])}}),[]),g.jsxs(g.Fragment,{children:[n,t&&g.jsx(Yo,{title:t.title,buttons:t.buttons,onConfirm:t.resolve,onCancel:t.reject,children:t.message}),g.jsx(Uo,{data:r})]})}d.forwardRef(Bo);function Jt({label:n="",position:e="",css:t="",error:s=!1,type:r="",required:o=!1,children:a}){const i=d.useRef(null),l=d.useCallback(()=>{if(i.current)return i.current;const c=Hn();return i.current=c,c},[]);return g.jsx(An.Provider,{value:l,children:g.jsxs("div",{className:`wx-2oVUvC wx-field wx-${e} ${t} ${s?"wx-error":""} ${o?"wx-required":""}`.trim(),children:[n&&g.jsx("label",{className:"wx-2oVUvC wx-label",htmlFor:i.current,children:n}),g.jsx("div",{className:`wx-2oVUvC wx-field-control wx-${r}`,children:a})]})})}const Qs=({value:n=!1,type:e="",icon:t="",disabled:s=!1,iconActive:r="",onClick:o,title:a="",css:i="",text:l="",textActive:c="",children:u,active:f,onChange:h})=>{const[x,w]=pe(n),m=d.useMemo(()=>(x?"pressed":"")+(e?" "+e:""),[x,e]),y=d.useCallback(p=>{let v=!x;o&&o(p),p.defaultPrevented||(w(v),h&&h({value:v}))},[x,o,h]);return x&&f?g.jsx(xt,{title:a,text:x&&c||l,css:i,type:m,icon:x&&r||t,onClick:y,disabled:s,children:Ys(f,{value:x})}):u?g.jsx(xt,{title:a,text:x&&c||l,css:i,type:m,icon:x&&r||t,onClick:y,disabled:s,children:u}):g.jsx(xt,{title:a,text:x&&c||l,css:i,type:m,icon:x&&r||t,onClick:y,disabled:s})},fs=new Date(0,0,0,0,0);function Vo({value:n=fs,id:e,title:t="",css:s="",disabled:r=!1,error:o=!1,format:a="",onChange:i}){let[l,c]=pe(n);const{calendar:u,formats:f}=(d.useContext(Oe)||Tt()).getRaw(),h=u.clockFormat==12,x=23,w=59,m=d.useMemo(()=>{const R=a||f?.timeFormat;return typeof R=="function"?R:Qe(R,u)},[a,f,u]),y=d.useMemo(()=>m(new Date(0,0,0,1)).indexOf("01")!=-1,[m]),p=(R,Z)=>(R<10&&Z?`0${R}`:`${R}`).slice(-2),v=R=>p(R,!0),k=R=>`${R}`.replace(/[^\d]/g,"")||0,S=R=>h&&(R=R%12,R===0)?"12":p(R,y),N=d.useCallback((R,Z)=>(R=k(R),Math.min(R,Z)),[]),[_,C]=d.useState(null),$=l||fs,L=N($.getHours(),x),I=N($.getMinutes(),w),T=L>12,Y=S(L),K=v(I),D=d.useMemo(()=>m(new Date(0,0,0,L,I)),[L,I,m]),A=d.useCallback(()=>{C(!0)},[]),E=d.useCallback(()=>{const R=new Date($);R.setHours(R.getHours()+(T?-12:12)),c(R),i&&i({value:R})},[$,T,i]),U=d.useCallback(({value:R})=>{if($.getHours()===R)return;const Z=new Date($);Z.setHours(R),c(Z),i&&i({value:Z})},[$,i]),F=d.useCallback(({value:R})=>{if($.getMinutes()===R)return;const Z=new Date($);Z.setMinutes(R),c(Z),i&&i({value:Z})},[$,i]),P=d.useCallback(R=>(R=N(R,x),h&&(R=R*1,R===12&&(R=0),T&&(R+=12)),R),[N,h,T]),q=d.useCallback(()=>{C(null)},[]);return g.jsxs("div",{className:`wx-7f497i wx-timepicker ${o?"wx-7f497i wx-error":""} ${r?"wx-7f497i wx-disabled":""}`,onClick:r?void 0:A,style:{cursor:r?"default":"pointer"},children:[g.jsx(It,{id:e,css:s,title:t,value:D,readonly:!0,disabled:r,error:o,icon:"wxi-clock",inputStyle:{cursor:"pointer",width:"100%",paddingRight:"calc(var(--wx-input-icon-size) + var(--wx-input-icon-indent) * 2)"}}),_&&!r&&g.jsx(ln,{onCancel:q,width:"unset",children:g.jsxs("div",{className:"wx-7f497i wx-wrapper",children:[g.jsxs("div",{className:"wx-7f497i wx-timer",children:[g.jsx("input",{className:"wx-7f497i wx-digit",value:Y,onChange:R=>{const Z=P(R.target.value);U({value:Z})}}),g.jsx("div",{className:"wx-7f497i wx-separator",children:":"}),g.jsx("input",{className:"wx-7f497i wx-digit",value:K,onChange:R=>{const Z=N(R.target.value,w);F({value:Z})}}),h&&g.jsx(Qs,{value:T,onClick:E,active:()=>g.jsx("span",{children:"pm"}),children:g.jsx("span",{children:"am"})})]}),g.jsx(Jt,{width:"unset",children:g.jsx(Sn,{label:u.hours,value:L,onChange:U,max:x})}),g.jsx(Jt,{width:"unset",children:g.jsx(Sn,{label:u.minutes,value:I,onChange:F,max:w})})]})})]})}function Js({theme:n="",target:e,children:t}){const s=d.useRef(null),r=d.useRef(null),[o,a]=d.useState(null);s.current||(s.current=document.createElement("div"));const i=d.useContext(an);return d.useEffect(()=>{a(e||Go(r.current)||Ie.getTopNode(r.current))},[r.current]),g.jsxs(g.Fragment,{children:[g.jsx("span",{ref:r,style:{display:"none"}}),r.current&&o?Tn.createPortal(g.jsx("div",{className:`wx-3ZWsT0 wx-${n||i}-theme`,children:t}),o):null]})}function Go(n){const e=Ie.getTopNode(n);for(;n&&n!==e&&!n.getAttribute("data-wx-portal-root");)n=n.parentNode;return n}function Zs(){return g.jsx(g.Fragment,{})}function hs(n){const{fonts:e=!0,children:t}=n;return g.jsx(an.Provider,{value:"willow",children:g.jsxs(g.Fragment,{children:[t&&t&&g.jsx("div",{className:"wx-theme wx-willow-theme",children:t}),e&&g.jsxs(g.Fragment,{children:[g.jsx("link",{rel:"preconnect",href:"https://cdn.svar.dev",crossOrigin:"true"}),g.jsx(Zs,{}),g.jsx("link",{rel:"stylesheet",href:"https://cdn.svar.dev/fonts/wxi/wx-icons.css"})]})]})})}function gs(n){const{fonts:e=!0,children:t}=n;return g.jsx(an.Provider,{value:"willow-dark",children:g.jsxs(g.Fragment,{children:[t&&t&&g.jsx("div",{className:"wx-theme wx-willow-dark-theme",children:t}),e&&g.jsxs(g.Fragment,{children:[g.jsx("link",{rel:"preconnect",href:"https://cdn.svar.dev",crossOrigin:"true"}),g.jsx(Zs,{}),g.jsx("link",{rel:"stylesheet",href:"https://cdn.svar.dev/fonts/wxi/wx-icons.css"})]})]})})}In(Ie);const er={gantt:{"Task name":"Task name","Start date":"Start date","Add task":"Add task",Duration:"Duration",Task:"Task",Milestone:"Milestone","Summary task":"Summary task",Save:"Save",Delete:"Delete",Name:"Name",Description:"Description","Select type":"Select type",Type:"Type","End date":"End date",Progress:"Progress",Predecessors:"Predecessors",Successors:"Successors","Add task name":"Add task name","Add description":"Add description","Select link type":"Select link type","End-to-start":"End-to-start","Start-to-start":"Start-to-start","End-to-end":"End-to-end","Start-to-end":"Start-to-end",Add:"Add","Child task":"Child task","Task above":"Task above","Task below":"Task below","Convert to":"Convert to",Edit:"Edit",Cut:"Cut",Copy:"Copy",Paste:"Paste",Move:"Move",Up:"Up",Down:"Down",Indent:"Indent",Outdent:"Outdent","Split task":"Split task",Segment:"Segment","New task":"New task","Move up":"Move up","Move down":"Move down",Undo:"Undo",Redo:"Redo",Week:"Week",Q:"Quarter"}};new Date().valueOf();var tr=class{constructor(n){this._nextHandler=null,this._dispatch=n,this.exec=this.exec.bind(this)}async exec(n,e){return this._dispatch(n,e),this._nextHandler&&await this._nextHandler.exec(n,e),e}setNext(n){return this._nextHandler=n}},nr=new Date().valueOf(),Ko=()=>nr++;function Fn(){return"temp://"+nr++}var xs=class{constructor(n){this._data=n,this._pool=new Map;for(let e=0;e<n.length;e++){const t=n[e];this._pool.set(t.id,t)}}add(n){n={id:Ko(),...n},this._data.push(n),this._pool.set(n.id,n)}update(n,e){const t=this._data.findIndex(r=>r.id==n),s={...this._data[t],...e};this._data[t]=s,this._pool.set(s.id,s)}remove(n){this._data=this._data.filter(e=>e.id!=n),this._pool.delete(n)}filter(n){this._data=this._data.filter(e=>{const t=n(e);return t||this._pool.delete(e.id),t})}byId(n){return this._pool.get(n)}map(n){return this._data.map(n)}forEach(n){this._data.forEach(n)}},qo=class{constructor(e){const t={id:0,$level:0,data:[],parent:null},s=new Map;s.set(0,t),this._pool=s,e&&e.length&&this.parse(e,0)}parse(e,t){const s=this._pool;for(let o=0;o<e.length;o++){const a=e[o];a.parent=a.parent||t,a.data=null,s.set(a.id,a)}for(let o=0;o<e.length;o++){const a=e[o],i=s.get(a.parent);i&&(i.data||(i.data=[]),i.data.push(a))}const r=s.get(t);this.setLevel(r,r.$level+1,!1)}add(e,t){const s=this._pool.get(e.parent||0);e.$level=s.$level+1,this._pool.set(e.id,e),s.data?t===-1?s.data=[...s.data,e]:ms(s,t,e):s.data=[e]}addAfter(e,t){if(!t)return this.add(e,-1);const s=this.byId(t),r=this.byId(s.parent),o=Bt(r,s.id)+1;e.parent=r.id,e.$level=r.$level+1,this.add(e,o)}remove(e){const t=this._pool.get(e);this._remove(t);const s=this._pool.get(t.parent);s.data=s.data.filter(r=>r.id!=e),this._clearBranch(s)}_remove(e){e.data&&e.data.forEach(t=>this._remove(t)),this._pool.delete(e.id)}update(e,t){let s=this._pool.get(e);const r=this._pool.get(s.parent),o=Bt(r,s.id);s={...s,...t},r&&o>=0&&(r.data[o]=s,r.data=[...r.data]),this._pool.set(s.id,s)}move(e,t,s){const r=this._pool.get(e),o=t==="child",a=this._pool.get(s),i=a.$level+(o?1:0);if(!r||!a)return;const l=this._pool.get(r.parent),c=o?a:this._pool.get(a.parent);c.data||(c.data=[]);const u=Bt(l,r.id);Xo(l,u);const f=o?c.data.length:Bt(c,a.id)+(t==="after"?1:0);if(ms(c,f,r),l.id===c.id&&u===f)return null;r.parent=c.id,r.$level!==i&&(r.$level=i,this.setLevel(r,i+1,!0)),this.update(r.id,r),this._clearBranch(l)}_clearBranch(e){e.data&&!e.data.length&&(e.open&&delete e.open,this.update(e.id,{data:null}))}toArray(){const e=[],t=this._pool.get(0).data;return t&&sr(t,e),e}byId(e){return this._pool.get(e)}getBranch(e){return this._pool.get(e).data}forEach(e){this._pool.forEach((t,s)=>{s!==0&&e(t)})}eachChild(e,t){const s=this.byId(t);!s||!s.data||s.data.forEach((r,o)=>{e(this.byId(r.id),o),this.eachChild(e,r.id)})}setLevel(e,t,s){e.data&&(e.data=e.data.map(r=>(s&&(r={...r},this._pool.set(r.id,r)),r.$level=t,r.data&&this.setLevel(r,t+1,s),r)))}};function sr(n,e){n.forEach(t=>{e.push(t),t.open===!0&&sr(t.data,e)})}function Xo(n,e){const t=[...n.data];t.splice(e,1),n.data=t}function ms(n,e,t){const s=[...n.data];s.splice(e,0,t),n.data=s}function Bt(n,e){return n?.data.findIndex(t=>t.id===e)}var rr=2,Qo=class{constructor(e){e&&(this._writable=e.writable,this._async=e.async),this._values={},this._state={}}setState(e,t=0){const s={};return this._wrapProperties(e,this._state,this._values,"",s,t),s}getState(){return this._values}getReactive(){return this._state}_wrapProperties(e,t,s,r,o,a){for(const i in e){const l=t[i],c=s[i],u=e[i];if(l&&(c===u&&typeof u!="object"||u instanceof Date&&c instanceof Date&&c.getTime()===u.getTime()))continue;const f=r+(r?".":"")+i;l?(l.__parse(u,f,o,a)&&(s[i]=u),a&rr?o[f]=l.__trigger:l.__trigger()):(u&&u.__reactive?t[i]=this._wrapNested(u,u,f,o):t[i]=this._wrapWritable(u),s[i]=u),o[f]=o[f]||null}}_wrapNested(e,t,s,r){const o=this._wrapWritable(e);return this._wrapProperties(e,o,t,s,r,0),o.__parse=(a,i,l,c)=>(this._wrapProperties(a,o,t,i,l,c),!1),o}_wrapWritable(e){const t=[],s=function(){for(let r=0;r<t.length;r++)t[r](e)};return{subscribe:r=>(t.push(r),this._async?setTimeout(r,1,e):r(e),()=>{const o=t.indexOf(r);o>=0&&t.splice(o,1)}),__trigger:()=>{t.length&&(this._async?setTimeout(s,1):s())},__parse:function(r){return e=r,!0}}}},Jo=class{constructor(e,t,s,r){typeof e=="function"?this._setter=e:this._setter=e.setState.bind(e),this._routes=t,this._parsers=s,this._prev={},this._triggers=new Map,this._sources=new Map,this._routes.forEach(o=>{o.in.forEach(a=>{const i=this._triggers.get(a)||[];i.push(o),this._triggers.set(a,i)}),o.out.forEach(a=>{const i=this._sources.get(a)||{};o.in.forEach(l=>i[l]=!0),this._sources.set(a,i)})}),this._routes.forEach(o=>{o.length=Math.max(...o.in.map(a=>or(a,this._sources,1)))}),this._bus=r}init(e){const t={};for(const s in e)if(this._prev[s]!==e[s]){const r=this._parsers[s];t[s]=r?r(e[s]):e[s]}this._prev=this._prev?{...this._prev,...e}:{...e},this.setState(t),this._bus&&this._bus.exec("init-state",t)}setStateAsync(e){const t=this._setter(e,rr);return this._async?Object.assign(this._async.signals,t):this._async={signals:t,timer:setTimeout(this._applyState.bind(this),1)},t}_applyState(){const e=this._async;if(e){this._async=null,this._triggerUpdates(e.signals,[]);for(const t in e.signals){const s=e.signals[t];s&&s()}}}setState(e,t=[]){const s=this._setter(e);return this._triggerUpdates(s,t),s}_triggerUpdates(e,t){const s=Object.keys(e),r=!t.length;t=t||[];for(let o=0;o<s.length;o++){const a=s[o],i=this._triggers.get(a);i&&i.forEach(l=>{t.indexOf(l)==-1&&t.push(l)})}r&&this._execNext(t)}_execNext(e){for(;e.length;){e.sort((s,r)=>s.length<r.length?1:-1);const t=e[e.length-1];e.splice(e.length-1),t.exec(e)}}};function or(n,e,t){const s=e.get(n);if(!s)return t;const r=Object.keys(s).map(o=>or(o,e,t+1));return Math.max(...r)}var Zo=class{constructor(){this._nextHandler=null,this._handlers={},this._tag=new WeakMap,this.exec=this.exec.bind(this)}on(e,t,s){let r=this._handlers[e];r?s&&s.intercept?r.unshift(t):r.push(t):r=this._handlers[e]=[t],s&&s.tag&&this._tag.set(t,s.tag)}intercept(e,t,s){this.on(e,t,{...s,intercept:!0})}detach(e){for(const t in this._handlers){const s=this._handlers[t];for(let r=s.length-1;r>=0;r--)this._tag.get(s[r])===e&&s.splice(r,1)}}async exec(e,t){const s=this._handlers[e];if(s)for(let r=0;r<s.length;r++){const o=s[r](t);if(o===!1||o&&o.then&&await o===!1)return}return this._nextHandler&&await this._nextHandler.exec(e,t),t}setNext(e){return this._nextHandler=e}};function ea(n,e){return typeof n=="string"?n.localeCompare(e,void 0,{numeric:!0}):typeof n=="object"?n.getTime()-e.getTime():(n??0)-(e??0)}function ta(n,e){return typeof n=="string"?-n.localeCompare(e,void 0,{numeric:!0}):typeof e=="object"?e.getTime()-n.getTime():(e??0)-(n??0)}function na({key:n,order:e}){const t=e==="asc"?ea:ta;return(s,r)=>t(s[n],r[n])}function sa(n){if(!n||!n.length)return;const e=n.map(t=>na(t));return n.length===1?e[0]:function(t,s){for(let r=0;r<e.length;r++){const o=e[r](t,s);if(o!==0)return o}return 0}}function ra(n,e){return n.sort(sa(e))}class oa extends qo{_sort;constructor(e){super(),this.parse(e,0)}parse(e,t){if(!e||!e.length)return;const s=e.map(r=>this.normalizeTask(r));super.parse(s,t),this._sort&&this.sortBranch(this._sort,t)}getBranch(e){const t=this._pool.get(e);return this._pool.get(t.parent||0).data}contains(e,t){const s=this._pool.get(e).data;let r=!1;if(s)for(let o=0;o<s.length;o++){if(s[o].id===t){r=!0;break}if(s[o].data&&(r=this.contains(s[o].id,t),r))break}return r}getIndexById(e){return this.getBranch(e).findIndex(t=>t.id===e)}add(e,t){const s=this.normalizeTask(e);return super.add(s,t),s}copy(e,t,s){const r=this.add({...e,id:null,data:null,parent:t},s);let o=[[e.id,r.id]];return e.data?.forEach((a,i)=>{const l=this.copy(a,r.id,i);o=o.concat(l)}),o}normalizeTask(e){const t=e.id||Fn(),s=e.parent||0,r=e.text||"",o=e.type||"task",a=e.progress||0,i=e.details||"",l={...e,id:t,text:r,parent:s,progress:a,type:o,details:i};return e.segments&&(l.segments=e.segments.map(c=>({...c}))),e.segments&&(l.segments=e.segments.map(c=>({...c}))),l}getSummaryId(e,t=!1){const s=this._pool.get(e);if(!s.parent)return null;const r=this._pool.get(s.parent);if(t){let o=e,a=this.getSummaryId(o);const i=[];for(;a;)o=a,i.push(a),a=this.getSummaryId(o);return i}return r.type==="summary"?r.id:this.getSummaryId(r.id)}sort(e){this._sort=e,e&&this.sortBranch(e,0)}sortBranch(e,t){const s=this._pool.get(t||0).data;s&&(ra(s,e),s.forEach(r=>{this.sortBranch(e,r.id)}))}serialize(){const e=[],t=this._pool.get(0).data;return t&&ar(t,e),e}clear(){this.forEach(e=>{this.remove(e.id)})}}function ar(n,e){n.forEach(t=>{e.push(t),t.data&&ar(t.data,e)})}function re(n){const e=Object.prototype.toString.call(n);return n instanceof Date||typeof n=="object"&&e==="[object Date]"?new n.constructor(+n):typeof n=="number"||e==="[object Number]"||typeof n=="string"||e==="[object String]"?new Date(n):new Date(NaN)}function Ke(n,e){return n instanceof Date?new n.constructor(e):new Date(e)}function un(n,e){const t=re(n);return isNaN(e)?Ke(n,NaN):(e&&t.setDate(t.getDate()+e),t)}function zn(n,e){const t=re(n);if(isNaN(e))return Ke(n,NaN);if(!e)return t;const s=t.getDate(),r=Ke(n,t.getTime());r.setMonth(t.getMonth()+e+1,0);const o=r.getDate();return s>=o?r:(t.setFullYear(r.getFullYear(),r.getMonth(),s),t)}function ir(n,e){const t=+re(n);return Ke(n,t+e)}const lr=6048e5,aa=864e5,cr=6e4,ur=36e5;function ia(n,e){return ir(n,e*ur)}let la={};function ca(){return la}function Zt(n,e){const t=ca(),s=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,r=re(n),o=r.getDay(),a=(o<s?7:0)+o-s;return r.setDate(r.getDate()-a),r.setHours(0,0,0,0),r}function Et(n){return Zt(n,{weekStartsOn:1})}function ua(n){const e=re(n),t=e.getFullYear(),s=Ke(n,0);s.setFullYear(t+1,0,4),s.setHours(0,0,0,0);const r=Et(s),o=Ke(n,0);o.setFullYear(t,0,4),o.setHours(0,0,0,0);const a=Et(o);return e.getTime()>=r.getTime()?t+1:e.getTime()>=a.getTime()?t:t-1}function it(n){const e=re(n);return e.setHours(0,0,0,0),e}function en(n){const e=re(n),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+n-+t}function dr(n,e){const t=it(n),s=it(e),r=+t-en(t),o=+s-en(s);return Math.round((r-o)/aa)}function ps(n){const e=ua(n),t=Ke(n,0);return t.setFullYear(e,0,4),t.setHours(0,0,0,0),Et(t)}function da(n,e){return ir(n,e*cr)}function fa(n,e){const t=e*3;return zn(n,t)}function fr(n,e){const t=e*7;return un(n,t)}function ha(n,e){return zn(n,e*12)}function Nt(n,e){const t=re(n),s=re(e),r=t.getTime()-s.getTime();return r<0?-1:r>0?1:r}function ga(n,e){const t=it(n),s=it(e);return+t==+s}function On(n,e){const t=Et(n),s=Et(e),r=+t-en(t),o=+s-en(s);return Math.round((r-o)/lr)}function xa(n,e){const t=re(n),s=re(e),r=t.getFullYear()-s.getFullYear(),o=t.getMonth()-s.getMonth();return r*12+o}function ma(n,e){const t=re(n),s=re(e);return t.getFullYear()-s.getFullYear()}function Pn(n){return e=>{const t=(n?Math[n]:Math.trunc)(e);return t===0?0:t}}function hr(n,e){return+re(n)-+re(e)}function pa(n,e,t){const s=hr(n,e)/ur;return Pn(t?.roundingMethod)(s)}function wa(n,e,t){const s=hr(n,e)/cr;return Pn(t?.roundingMethod)(s)}function ya(n){const e=re(n);return e.setHours(23,59,59,999),e}function gr(n){const e=re(n),t=e.getMonth();return e.setFullYear(e.getFullYear(),t+1,0),e.setHours(23,59,59,999),e}function va(n){const e=re(n);return+ya(e)==+gr(e)}function xr(n,e){const t=re(n),s=re(e),r=Nt(t,s),o=Math.abs(xa(t,s));let a;if(o<1)a=0;else{t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-r*o);let i=Nt(t,s)===-r;va(re(n))&&o===1&&Nt(n,s)===1&&(i=!1),a=r*(o-Number(i))}return a===0?0:a}function ka(n,e,t){const s=xr(n,e)/3;return Pn(t?.roundingMethod)(s)}function ba(n,e){const t=re(n),s=re(e),r=Nt(t,s),o=Math.abs(ma(t,s));t.setFullYear(1584),s.setFullYear(1584);const a=Nt(t,s)===-r,i=r*(o-+a);return i===0?0:i}function Rt(n){const e=re(n),t=e.getMonth(),s=t-t%3;return e.setMonth(s,1),e.setHours(0,0,0,0),e}function mr(n){const e=re(n);return e.setDate(1),e.setHours(0,0,0,0),e}function Sa(n){const e=re(n),t=Ke(n,0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}function pr(n){const e=re(n),t=e.getMonth(),s=t-t%3+3;return e.setMonth(s,0),e.setHours(23,59,59,999),e}function wr(n){const e=re(n),t=e.getFullYear(),s=e.getMonth(),r=Ke(n,0);return r.setFullYear(t,s+1,0),r.setHours(0,0,0,0),r.getDate()}function _a(n){const e=re(n).getFullYear();return e%400===0||e%4===0&&e%100!==0}function yr(n){const e=re(n);return String(new Date(e))==="Invalid Date"?NaN:_a(e)?366:365}function Ca(n){const e=ps(n),t=+ps(fr(e,60))-+e;return Math.round(t/lr)}function gt(n,e){const t=re(n),s=re(e);return+t==+s}function ja(n){const e=re(n);return e.setMinutes(0,0,0),e}function $a(n,e,t){const s=Zt(n,t),r=Zt(e,t);return+s==+r}function Ma(n,e){const t=re(n),s=re(e);return t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()}function Na(n,e){const t=Rt(n),s=Rt(e);return+t==+s}function Ea(n,e){const t=re(n),s=re(e);return t.getFullYear()===s.getFullYear()}const ws={year:ba,quarter:ka,month:xr,week:On,day:dr,hour:pa,minute:wa},tn={year:{quarter:4,month:12,week:Ca,day:Ra,hour:Da},quarter:{month:3,week:Ta,day:vr,hour:Ia},month:{week:Ha,day:Aa,hour:La},week:{day:7,hour:168},day:{hour:24},hour:{minute:60}};function Ra(n){return n?yr(n):365}function Da(n){return yr(n)*24}function Ta(n){const e=Rt(n),t=un(it(pr(n)),1);return On(t,e)}function vr(n){if(n){const e=Rt(n),t=pr(n);return dr(t,e)+1}return 91}function Ia(n){return vr(n)*24}function Ha(n){if(n){const e=mr(n),t=un(it(gr(n)),1);return On(t,e)}return 5}function Aa(n){return n?wr(n):30}function La(n){return wr(n)*24}function nn(n,e,t){const s=tn[n][e];return s?typeof s=="number"?s:s(t):1}function Fa(n,e){return n===e||!!(tn[n]&&tn[n][e])}const _n={year:ha,quarter:fa,month:zn,week:fr,day:un,hour:ia,minute:da};function Wn(n,e,t){if(e){if(n==="day")return(s,r)=>e.getWorkingDays(r,s,!0);if(n==="hour")return(s,r)=>e.getWorkingHours(r,s,!0)}return(s,r,o,a)=>{const i=tn[n]?.[o];return!i||typeof i=="number"||kr(n,s,r,t)?$t(n,s,r,o,a,t):za(s,r,n,o,a,t)}}function $t(n,e,t,s,r,o){const a=s||n;let i=t,l=e;if(r&&(i=Ge(a,t,o),l=Ge(a,e,o),l<e&&(l=Ye(a)(l,1))),n!==a){const c=ws[a](l,i),u=nn(n,a,t);return c/u}else return ws[a](l,i)}function za(n,e,t,s,r,o){let a=0;const i=Ge(t,e,o);if(e>i){const c=_n[t](i,1);a=$t(t,c,e,s,void 0,o),e=c}let l=0;return kr(t,e,n,o)||(l=$t(t,Ge(t,n,o),e,void 0,void 0,o),e=_n[t](e,l)),l+=a+$t(t,n,e,s,void 0,o),!l&&r&&(l=$t(t,n,e,s,r,o)),l}function Ye(n,e){if(e){if(n==="day")return(t,s)=>e.addWorkingDays(t,s,!0);if(n==="hour")return(t,s)=>e.addWorkingHours(t,s)}return _n[n]}const Oa={year:Sa,quarter:Rt,month:mr,week:(n,e)=>Zt(n,{weekStartsOn:e}),day:it,hour:ja};function Ge(n,e,t){const s=Oa[n];return s?s(e,t):new Date(e)}const Pa={year:Ea,quarter:Na,month:Ma,week:(n,e,t)=>$a(n,e,{weekStartsOn:t}),day:ga};function kr(n,e,t,s){const r=Pa[n];return r?r(e,t,s):!1}function yn(n,e=1,t){return t.isWorkingDay(n)||(n=e>0?t.getNextWorkingDay(n):t.getPreviousWorkingDay(n)),n}function Wa(n){return(e,t)=>{if(t>0)for(let s=0;s<t;s++)e=n.getNextWorkingDay(e);if(t<0)for(let s=0;s>t;s--)e=n.getPreviousWorkingDay(e);return e}}function yt(n){const e=new Date;return n.map(t=>({item:t,len:Ye(t.unit)(e,1)})).sort((t,s)=>t.len<s.len?-1:1)[0].item}const mt=["year","quarter","month","week","day","hour"],Cn=50,jn=300;function Ua(n,e,t,s,r,o){const a=!n||t,i=!e||t;let l=n,c=e,u=!1,f=!1;(a||i)&&(r?.forEach(x=>{a&&(!l||x.start<=l)&&(l=x.start,u=!0);const w=x.type==="milestone"?x.start:x.end;i&&(!c||w>=c)&&(c=w,f=!0)}),o?.forEach(x=>{a&&(!l||x.start<=l)&&(l=x.start,u=!0),i&&(!c||x.start>=c)&&(c=x.start,f=!0)}));const h=Ye(s||"day");return l?u&&(l=h(l,-1)):c?l=h(c,-30):l=new Date,c?f&&(c=h(c,1)):c=h(l,30),{_start:l,_end:c}}function Ya(n,e,t,s,r,o,a){const i=yt(a).unit,l=Wn(i,void 0,o),c=l(e,n,"",!0),u=Ge(i,e,o);n=Ge(i,n,o),e=u<e?Ye(i)(u,1):u;const f=c*s,h=r*a.length,x=a.map(m=>{const y=[],p=Ye(m.unit);let v=Ge(m.unit,n,o);for(;v<e;){const k=p(v,m.step),S=v<n?n:v,N=k>e?e:k,_=l(N,S,"",!0)*s,C=typeof m.format=="function"?m.format(v,k):m.format;let $="";m.css&&($+=typeof m.css=="function"?m.css(v):m.css),y.push({width:_,value:C,date:S,css:$,unit:m.unit}),v=k}return{cells:y,add:p,height:r}});let w=s;return i!==t&&(w=w/nn(i,t)),{rows:x,width:f,height:h,diff:l,start:n,end:e,lengthUnit:t,minUnit:i,lengthUnitWidth:w}}function Ba(n,e,t,s){const r=typeof n=="boolean"?{}:n,o=mt.indexOf(yt(t).unit);if(typeof r.level>"u"&&(r.level=o),r.levels)r.levels.forEach(l=>{l.minCellWidth||(l.minCellWidth=Vt(r.minCellWidth,Cn)),l.maxCellWidth||(l.maxCellWidth=Vt(r.maxCellWidth,jn))});else{const l=[],c=t.length||1,u=Vt(r.minCellWidth,Cn),f=Vt(r.maxCellWidth,jn);t.forEach(h=>{h.format&&!e[h.unit]&&(e[h.unit]=h.format)}),mt.forEach((h,x)=>{if(x===o)l.push({minCellWidth:u,maxCellWidth:f,scales:t});else{const w=[];if(x)for(let m=c-1;m>0;m--){const y=mt[x-m];y&&w.push({unit:y,step:1,format:e[y]})}w.push({unit:h,step:1,format:e[h]}),l.push({minCellWidth:u,maxCellWidth:f,scales:w})}}),r.levels=l}r.levels[r.level]||(r.level=0);const a=r.levels[r.level],i=Math.min(Math.max(s,a.minCellWidth),a.maxCellWidth);return{zoom:r,scales:a.scales,cellWidth:i}}function Va(n,e,t,s,r,o,a){n.level=t;let i;const l=s.scales||s,c=yt(l).unit,u=Ga(c,r);if(e===-1){const x=nn(c,r);i=a*x}else{const x=nn(yt(o).unit,c);i=Math.round(a/x)}const f=s.minCellWidth??Cn,h=s.maxCellWidth??jn;return{scales:l,cellWidth:Math.min(h,Math.max(f,i)),lengthUnit:u,zoom:n}}function Ga(n,e){const t=mt.indexOf(n),s=mt.indexOf(e);return s>=t?n==="hour"?"hour":"day":mt[s]}function Vt(n,e){return n??e}const $n=8,br=4,Ka=3,ys=7,qa=$n+br;function Sr(n,e,t){(n.open||n.type!="summary")&&n.data?.forEach(s=>{typeof s.$x>"u"&&Cr(s,t),s.$x+=e,Sr(s,e,t)})}function Mn(n,e,t,s){const r=n.getSummaryId(e.id);if(r){const o=n.byId(r),a={xMin:1/0,xMax:0};s&&$r(o,t),_r(o,a,t),o.$x=a.xMin,o.$w=a.xMax-a.xMin,Mn(n,o,t)}}function _r(n,e,t){n.data?.forEach(s=>{if(!s.unscheduled){typeof s.$x>"u"&&Cr(s,t);const r=s.type==="milestone"&&s.$h?s.$h/2:0;e.xMin>s.$x+r&&(e.xMin=s.$x+r);const o=s.$x+s.$w-r;e.xMax<o&&(e.xMax=o)}s.type!=="summary"&&_r(s,e,t)})}function Cr(n,e){const{_scales:t,cellWidth:s}=e;n.$x=Math.round(t.diff(n.start,t.start,t.lengthUnit)*s),n.$w=Math.round(t.diff(n.end,n.start,t.lengthUnit,!0)*s)}function Un(n,e){let t;e&&(t=e.filter(r=>r.parent==n.id));const s={data:t,...n};if(s.data?.length)s.data.forEach(r=>{if(r.unscheduled&&!r.data)return;(e||r.type!="summary"&&r.data)&&(r.unscheduled&&(r={...r,start:void 0,end:void 0}),r=Un(r,e)),r.start&&(!s.start||s.start>r.start)&&(s.start=new Date(r.start));const o=r.end||r.start;o&&(!s.end||s.end<o)&&(s.end=new Date(o))});else if(n.type==="summary")throw Error("Summary tasks must have start and end dates if they have no subtasks");return s}function jr(n,e,t){return Nn(n,e,t,!1),t.splitTasks&&n.segments?.forEach(s=>{jr(s,e,{...t,baselines:!1}),s.$x-=n.$x}),t.baselines&&Nn(n,e,t,!0),n}function Nn(n,e,t,s){const{cellWidth:r,cellHeight:o,_scales:a,baselines:i}=t,{start:l,end:c,lengthUnit:u,diff:f}=a,h=(s?"base_":"")+"start",x=(s?"base_":"")+"end",w="$x"+(s?"_base":""),m="$y"+(s?"_base":""),y="$w"+(s?"_base":""),p="$h"+(s?"_base":""),v="$skip"+(s?"_baseline":"");let k=n[h],S=n[x];if(s&&!k){n[v]=!0;return}n[h]<l&&(n[x]<l||gt(n[x],l))?k=S=l:n[h]>c&&(k=S=c),n[w]=Math.round(f(k,l,u)*r),n[y]=Math.round(f(S,k,u,!0)*r),e!==null&&(n[m]=s?n.$y+n.$h+br:o*e+Ka),n[p]=s?$n:i?o-ys-qa:o-ys,n.type==="milestone"&&(n[w]=n[w]-n.$h/2,n[y]=n.$h,s&&(n[m]=n.$y+$n,n[y]=n[p]=n.$h)),t.unscheduledTasks&&n.unscheduled&&!s?n.$skip=!0:n[v]=gt(k,S)}function $r(n,e,t){n.data&&!n.$skip&&(t=t||!n.open,n.data.forEach(s=>{t&&Nn(s,null,e,!1),$r(s,e,t)}))}const vn=20,Xa=function(n,e,t,s,r){const o=Math.round(s/2)-3;if(!e||!t||!e.$y||!t.$y||e.$skip||t.$skip)return n.$p="",n.$pl=0,n;let a=!1,i=!1;switch(n.type){case"e2s":i=!0;break;case"s2s":a=!0,i=!0;break;case"s2e":a=!0;break}const l=a?e.$x:e.$x+e.$w,c=r?e.$y-7:e.$y,u=i?t.$x:t.$x+t.$w,f=r?t.$y-7:t.$y;if(l!==u||c!==f){const h=Ja(l,c+o,u,f+o,a,i,s/2,r),x=Za(u,f+o,i);n.$p=`${h},${x}`,n.$pl=Qa(n.$p)}return n};function Qa(n){const e=n.split(",").map(Number),t=[];for(let r=0;r<e.length;r+=2)r+1<e.length&&t.push([e[r],e[r+1]]);let s=0;for(let r=0;r<t.length-1;r++){const[o,a]=t[r],[i,l]=t[r+1];s+=Math.hypot(i-o,l-a)}return s}function Ja(n,e,t,s,r,o,a,i){const l=vn*(r?-1:1),c=vn*(o?-1:1),u=n+l,f=t+c,h=[n,e,u,e,0,0,0,0,f,s,t,s],x=f-u;let w=s-e;const m=o===r;return m||(f<=n+vn-2&&o||f>n&&!o)&&(w=i?w-a+6:w-a),m&&o&&u>f||m&&!o&&u<f?(h[4]=h[2]+x,h[5]=h[3],h[6]=h[4],h[7]=h[5]+w):(h[4]=h[2],h[5]=h[3]+w,h[6]=h[4]+x,h[7]=h[5]),h.join(",")}function Za(n,e,t){return t?`${n-5},${e-3},${n-5},${e+3},${n},${e}`:`${n+5},${e+3},${n+5},${e-3},${n},${e}`}function Mr(n){return n.map(e=>{const t=e.id||Fn();return{...e,id:t}})}const Nr=["start","end","duration"];function ei(n,e){const{type:t,unscheduled:s}=n;return s||t==="summary"?!Nr.includes(e):t==="milestone"?!["end","duration"].includes(e):!0}function ti(n,e){return typeof e=="function"?e:Nr.includes(n)?(typeof e=="string"&&(e={type:e,config:{}}),e.config||(e.config={}),e.type==="datepicker"&&(e.config.buttons=["today"]),(t,s)=>ei(t,s.id)?e:null):e}function ni(n){return!n||!n.length?[]:n.map(e=>{const t=e.align||"left",s=e.id==="add-task",r=!s&&e.flexgrow?e.flexgrow:null,o=r?1:e.width||(s?50:120),a=e.editor&&ti(e.id,e.editor);return{width:o,align:t,header:e.header,id:e.id,template:e.template,_template:e._template,...r&&{flexgrow:r},cell:e.cell,resize:e.resize??!0,sort:e.sort??!s,...a&&{editor:a},...e.options&&{options:e.options}}})}const si=[{id:"text",header:"Task name",flexgrow:1,sort:!0},{id:"start",header:"Start date",align:"center",sort:!0},{id:"duration",header:"Duration",width:100,align:"center",sort:!0},{id:"add-task",header:"Add task",width:50,align:"center",sort:!1,resize:!1}];function Mt(n,e,t,s){const{selected:r,tasks:o}=n.getState(),a=r.length,i=["edit-task","paste-task","edit-task:task","edit-task:segment"],l=["copy-task","cut-task"],c=["copy-task","cut-task","delete-task","indent-task:remove","move-task:down"],u=["add-task","undo","redo"],f=["indent-task:add","move-task:down","move-task:up"],h={"indent-task:remove":2},x=!a&&u.includes(e),w={parent:f.includes(e),level:h[e]};if(t=t||(a?r[r.length-1]:null),!(!t&&!x)){if(e!=="paste-task"&&(n._temp=null),i.includes(e)||x||r.length===1)vs(n,e,t,s);else if(a){const m=l.includes(e)?r:ri(r,o,w);c.includes(e)&&m.reverse();const y=n.getHistory();y&&y.startBatch(),m.forEach((p,v)=>vs(n,e,p,s,v)),y&&y.endBatch()}}}function ri(n,e,t){let s=n.map(r=>{const o=e.byId(r);return{id:r,level:o.$level,parent:o.parent,index:e.getIndexById(r)}});return(t.parent||t.level)&&(s=s.filter(r=>t.level&&r.level<=t.level||!n.includes(r.parent))),s.sort((r,o)=>r.level-o.level||r.index-o.index),s.map(r=>r.id)}function vs(n,e,t,s,r){const o=n.exec?n.exec:n.in.exec;let a=e.split(":")[0],i=e.split(":")[1];const l=t?.id||t;let c={id:l},u={},f=!1;if(a=="copy-task"||a=="cut-task"){n._temp||(n._temp=[]),n._temp.push({id:l,cut:a=="cut-task"});return}else if(a=="paste-task"){if(n._temp&&n._temp.length){const h=n.getHistory();h&&h.startBatch();const x=new Map;if(n._temp.forEach(w=>{const m={id:w.id,target:l,mode:"after"};o(w.cut?"move-task":"copy-task",m),x.set(w.id,m.id)}),!n._temp[0].cut){const{links:w}=n.getState(),m=n._temp.map(p=>p.id),y=[];w.forEach(p=>{m.includes(p.source)&&m.includes(p.target)&&y.push(p)}),y.forEach(p=>{o("add-link",{link:{source:x.get(p.source),target:x.get(p.target),type:p.type}})}),n._temp.forEach((p,v)=>{o("select-task",{id:x.get(p.id),toggle:!!v})})}h&&h.endBatch(),n._temp=null}return}else a==="add-task"?(u={task:{type:"task",text:s("New Task")},target:l,show:!0,select:!1},c={},f=!0):a==="edit-task"?(a="show-editor",i==="segment"&&typeof t=="object"&&(u=t)):a==="convert-task"?(a="update-task",u={task:{type:i}},i=void 0):a==="indent-task"&&(i=i==="add");if(a==="split-task"&&typeof t=="object")u=t;else if(a==="delete-task"&&i==="segment"&&typeof t=="object"){const h=n.getTask(l),{segmentIndex:x}=t,w=h.segments.filter((m,y)=>y!==x);o("update-task",{id:l,task:{segments:w}});return}typeof i<"u"&&(u={mode:i,...u}),c={...c,...u},o(a,c),f&&o("select-task",{id:c.id,toggle:!!r})}function Er(n,e){return n.some(t=>t.data?Er(t.data,e):t.id===e)}const ks=(n,e)=>Ye(n,e),oi=(n,e)=>Wn(n,e);function En(n,e){Array.isArray(n)&&(n.forEach(t=>rt(t,e)),n.forEach(t=>{if(t.type==="summary"&&!(t.start&&t.end)){const{start:s,end:r}=Un(t,n);t.start=s,t.end=r,rt(t,e)}}))}function rt(n,e){n.unscheduled||bs(n,e,!1),n.base_start&&bs(n,e,!0)}function bs(n,e,t){const{calendar:s,durationUnit:r}=e,o=r||"day",[a,i,l]=Rr(t);n.type==="milestone"?(n[l]=0,n[i]=void 0):n[a]&&(n[l]?n[i]=ks(o,s)(n[a],n[l]):n[i]?n[l]=oi(o,s)(n[i],n[a]):(n[i]=ks(o,s)(n[a],1),n[l]=1))}function Rr(n){return n?["base_start","base_end","base_duration"]:["start","end","duration"]}function Ss(n,e,t){const[s,r,o]=Rr(t);(e===o||e===s)&&(n[r]=null),e===r&&(n[o]=0,n[s]&&n[s]>=n[r]&&(n[r]=null,n[o]=1))}function ai(n,e,t){Ss(n,t,!1),n.base_start&&Ss(n,t,!0),rt(n,e)}class ii extends Qo{in;_router;_modules=new Map;constructor(e){super({writable:e,async:!1}),this._router=new Jo(super.setState.bind(this),[{in:["tasks","start","end","scales","autoScale","markers"],out:["_start","_end"],exec:r=>{const{_end:o,_start:a,start:i,end:l,tasks:c,scales:u,autoScale:f,markers:h}=this.getState();if(!i||!l||f){const x=yt(u).unit,w=Ua(i,l,f,x,c,h);(w._end!=o||w._start!=a)&&this.setState(w,r)}else this.setState({_start:i,_end:l},r)}},{in:["_start","_end","cellWidth","scaleHeight","scales","lengthUnit","_weekStart"],out:["_scales"],exec:r=>{const o=this.getState();let{lengthUnit:a}=o;const{_start:i,_end:l,cellWidth:c,scaleHeight:u,scales:f,_weekStart:h}=o,x=yt(f).unit;Fa(x,a)||(a=x);const w=Ya(i,l,a,c,u,h,f);this.setState({_scales:w},r)}},{in:["_scales","tasks","cellHeight","baselines","unscheduledTasks"],out:["_tasks"],exec:r=>{const{cellWidth:o,cellHeight:a,tasks:i,_scales:l,baselines:c,splitTasks:u,unscheduledTasks:f}=this.getState(),h=i.toArray().map((x,w)=>jr(x,w,{cellWidth:o,cellHeight:a,_scales:l,baselines:c,splitTasks:u,unscheduledTasks:f}));this.setState({_tasks:h},r)}},{in:["_tasks","links","cellHeight"],out:["_links"],exec:r=>{const{tasks:o,links:a,cellHeight:i,baselines:l,criticalPath:c}=this.getState(),u=a.map(f=>{const h=o.byId(f.source),x=o.byId(f.target);return Xa(f,h,x,i,l)}).toSorted((f,h)=>c?!!f.$critical==!!h.$critical?h.$pl-f.$pl:f.$critical?1:-1:h.$pl-f.$pl).filter(f=>f!==null);this.setState({_links:u},r)}},{in:["tasks","activeTask"],out:["_activeTask"],exec:r=>{const o=this.getState();let{activeTask:a}=o;a&&typeof a=="object"&&(a=a.id);const i=o.tasks.byId(a);this.setState({_activeTask:i||null},r)}},{in:["tasks","selected"],out:["_selected"],exec:r=>{const{tasks:o,selected:a}=this.getState(),i=a.map(l=>o.byId(l)).filter(l=>!!l);this.setState({_selected:i},r)}},{in:["start","end"],out:["cellWidth"],exec:r=>{const{_cellWidth:o,cellWidth:a}=this.getState();o!=a&&this.setState({cellWidth:o},r)}}],{tasks:r=>new oa(r),links:r=>new xs(r),columns:r=>ni(r)});const t=this.in=new Zo;t.on("show-editor",r=>{const{splitTasks:o}=this.getState();if(o){const{id:a,segmentIndex:i}=r;if(a&&(i||i===0)){this.setStateAsync({activeTask:{id:a,segmentIndex:i}});return}}this.setStateAsync({activeTask:r.id})}),t.on("select-task",({id:r,toggle:o,range:a,show:i,segmentIndex:l})=>{const{selected:c,_tasks:u,activeTask:f,splitTasks:h}=this.getState();let x=!1,w;if(c.length&&(o||a)){const y=[...c];if(a){const p=y[y.length-1],v=u.findIndex(C=>C.id==p),k=u.findIndex(C=>C.id==r),S=Math.min(v,k),N=Math.max(v,k)+1,_=u.slice(S,N).map(C=>C.id);v>k&&_.reverse(),_.forEach(C=>{y.includes(C)||y.push(C)})}else if(o){const p=y.findIndex(v=>v==r);p===-1?y.push(r):(x=!0,y.splice(p,1))}w=y}else w=[r];const m={selected:w};i&&w.length&&(m._scrollTask={id:w[0],mode:i}),this.setStateAsync(m),!x&&f&&(f!==r||h)&&t.exec("show-editor",{id:r,...h&&{segmentIndex:l}})}),t.on("delete-link",({id:r})=>{const{links:o}=this.getState();o.remove(r),this.setStateAsync({links:o})}),t.on("update-link",r=>{const{links:o}=this.getState(),a=r.id;let i=r.link;o.update(a,i),i=o.byId(a),!i.lag&&i.lag!==0&&delete i.lag,this.setStateAsync({links:o}),r.link=i}),t.on("add-link",r=>{const{link:o}=r,{links:a}=this.getState();!o.source||!o.target||(o.type||(o.type="e2s"),o.id=o.id||Fn(),a.add(o),this.setStateAsync({links:a}),r.id=o.id,r.link=a.byId(o.id))});let s=null;t.on("move-task",r=>{const{tasks:o}=this.getState();let{mode:a,target:i}=r;const{id:l,inProgress:c}=r,u=o.byId(l);if(typeof c>"u"?r.source=u.parent:r.source=s=s??u.parent,c===!1){o.update(u.id,{$reorder:!1}),this.setState({tasks:o}),s=null;return}if(i===l||o.contains(l,i)){r.skipProvider=!0;return}if(a==="up"||a==="down"){const f=o.getBranch(l);let h=o.getIndexById(l);if(a==="up"){const x=u.parent===0;if(h===0&&x){r.skipProvider=!0;return}h-=1,a="before"}else if(a==="down"){const x=h===f.length-1,w=u.parent===0;if(x&&w){r.skipProvider=!0;return}h+=1,a="after"}if(i=f[h]&&f[h].id||u.parent,i){const x=o.getBranch(i);let w=o.getIndexById(i),m=x[w];if(m.data){if(a==="before"){if(m.parent===u.parent){for(;m.data;)m.open||t.exec("open-task",{id:m.id,mode:!0}),m=m.data[m.data.length-1];i=m.id}}else if(a==="after"){let v;m.parent===u.parent?(v=m,m=m.data[0],i=m.id,a="before"):x.length-1!==w&&(v=m,w+=1,m=x[w],u.$level>m.$level&&m.data?(v=m,m=m.data[0],i=m.id,a="before"):i=m.id),v&&!v.open&&t.exec("open-task",{id:v.id,mode:!0})}}const y=o.getSummaryId(u.id);o.move(l,a,i);const p=o.getSummaryId(l);y!=p&&(y&&this.resetSummaryDates(y,"move-task"),p&&this.resetSummaryDates(p,"move-task"))}}else{const f=o.byId(i);let h=f,x=!1;for(;h.$level>u.$level;)h=o.byId(h.parent),h.id===l&&(x=!0);if(x)return;const w=o.getSummaryId(u.id);if(o.move(l,a,i),a=="child"){let y=f;for(;y.id!==0&&!y.open;)t.exec("open-task",{id:y.id,mode:!0}),y=o.byId(y.parent)}const m=o.getSummaryId(l);w!=m&&(w&&this.resetSummaryDates(w,"move-task"),m&&this.resetSummaryDates(m,"move-task"))}c?this.setState({tasks:o}):this.setStateAsync({tasks:o}),r.target=i,r.mode=a}),t.on("drag-task",r=>{const o=this.getState(),{tasks:a,_tasks:i,_selected:l,_scales:c,cellWidth:u,cellHeight:f}=o,h=a.byId(r.id),{left:x,top:w,width:m,start:y,inProgress:p}=r,v={_tasks:i,_selected:l};if(typeof m<"u"&&(h.$w=m,Mn(a,h,{_scales:c,cellWidth:u})),typeof x<"u"){if(h.type==="summary"){const k=x-h.$x;Sr(h,k,{_scales:c,cellWidth:u})}h.$x=x,Mn(a,h,{_scales:c,cellWidth:u,cellHeight:f},!y)}typeof w<"u"&&(h.$y=w+4,h.$reorder=p),this.setState(v)}),t.on("update-task",r=>{const{id:o,segmentIndex:a,diff:i,eventSource:l}=r;let{task:c}=r;const{tasks:u,_scales:f,durationUnit:h,splitTasks:x,calendar:w}=this.getState(),m=u.byId(o),y={durationUnit:h,calendar:w};if(l==="add-task"||l==="copy-task"||l==="move-task"||l==="update-task"||l==="delete-task"||l==="provide-data"){rt(c,y),u.update(o,c);return}const p=f.lengthUnit;let v=Ye(p);const k=Wn(h,w);if(i&&(c.start&&(c.start=v(c.start,i)),!a&&a!==0&&(c.start&&c.end?c.duration=m.duration:(c.start?c.end=m.end:(c.end=v(c.end,i),c.start=m.start,c.duration=k(c.end,c.start)),k(c.end,c.start)||(c.duration=1)))),c.type=c.type??m.type,w&&c.start&&(c.start=yn(c.start,i,w)),c.start&&c.end&&(!gt(c.start,m.start)||!gt(c.end,m.end))&&c.type==="summary"&&m.data?.length){let N=i||k(c.start,m.start);w&&(N=c.start>m.start?k(c.start,m.start):-k(m.start,c.start),v=Wa(w)),this.moveSummaryKids(m,_=>(_=v(_,N),w?yn(_,i,w):_),"update-task")}c.start||(c.start=m.start),!c.end&&!c.duration&&(c.duration=m.duration),rt(c,y),u.update(o,c),(w&&c.type==="summary"||c.type==="summary"&&m.type!=="summary")&&this.resetSummaryDates(o,"update-task",!0);const S=u.getSummaryId(o);S&&this.resetSummaryDates(S,"update-task"),this.setStateAsync({tasks:u}),r.task=u.byId(o)}),t.on("add-task",r=>{const{tasks:o,_scales:a,unscheduledTasks:i,durationUnit:l,splitTasks:c,calendar:u}=this.getState(),{target:f,mode:h,task:x,show:w,select:m=!0}=r;!r.eventSource&&i&&(x.unscheduled=!0);let y=-1,p,v;if(f?(v=o.byId(f),h=="child"?(p=v,x.parent=p.id):(v.parent!==null&&(p=o.byId(v.parent),x.parent=p.id),y=o.getIndexById(f),h=="after"&&(y+=1))):x.parent&&(p=o.byId(x.parent)),!x.start){if(p?.start)x.start=new Date(p.start.valueOf());else if(v)x.start=new Date(v.start.valueOf());else{const _=o.getBranch(0);let C;if(_?.length){const $=_[_.length-1];if(!$.$skip){const L=new Date($.start.valueOf());a.start<=L&&(C=L)}}x.start=C||Ye(l,u)(a.start,1)}x.duration=1}u&&(x.start=yn(x.start,1,u)),this.getState().baselines&&(x.base_start=x.start,x.base_duration=x.duration),rt(x,{durationUnit:l,calendar:u});const k=o.add(x,y),S={tasks:o};if(p&&w){for(;p&&p.id;)t.exec("open-task",{id:p.id,mode:!0}),p=o.byId(p.parent);S._scrollTask={id:k.id,mode:w}}r.id=k.id;const N=o.getSummaryId(k.id);N&&this.resetSummaryDates(N,"add-task"),this.setStateAsync(S),r.id=k.id,r.task=k,m&&t.exec("select-task",{id:k.id})}),t.on("delete-task",r=>{const{id:o}=r,{tasks:a,links:i,selected:l}=this.getState();r.source=a.byId(o).parent;const c=a.getSummaryId(o),u=[o];a.eachChild(h=>u.push(h.id),o),i.filter(h=>!(u.includes(h.source)||u.includes(h.target)));const f={tasks:a,links:i};l.includes(o)&&(f.selected=l.filter(h=>h!==o)),a.remove(o),c&&this.resetSummaryDates(c,"delete-task"),this.setStateAsync(f)}),t.on("indent-task",({id:r,mode:o})=>{const{tasks:a}=this.getState();if(o){const i=a.getBranch(r)[a.getIndexById(r)-1];i&&t.exec("move-task",{id:r,mode:"child",target:i.id})}else{const i=a.byId(r),l=a.byId(i.parent);l&&l.parent!==null&&t.exec("move-task",{id:r,mode:"after",target:i.parent})}}),t.on("copy-task",r=>{const{id:o,target:a,mode:i,eventSource:l}=r;if(l==="copy-task")return;const{tasks:c,links:u}=this.getState();if(c.contains(o,a)){r.skipProvider=!0;return}const f=c.getSummaryId(o),h=c.getSummaryId(a);let x=c.getIndexById(a);i=="before"&&(x-=1);const w=c.byId(o),m=c.copy(w,c.byId(a).parent,x+1);r.source=r.id,r.id=m[0][1],w.lazy&&(r.lazy=!0),f!=h&&h&&this.resetSummaryDates(h,"copy-task");let y=[];for(let p=1;p<m.length;p++){const[v,k]=m[p];u.forEach(S=>{if(S.source===v){const N={...S};delete N.target,y.push({...N,source:k})}else if(S.target===v){const N={...S};delete N.source,y.push({...N,target:k})}})}y=y.reduce((p,v)=>{const k=p.findIndex(S=>S.id===v.id);return k>-1?p[k]={...p[k],...v}:p.push(v),p},[]);for(let p=1;p<m.length;p++){const[v,k]=m[p],S=c.byId(k);t.exec("copy-task",{source:v,id:k,lazy:!!S.lazy,eventSource:"copy-task",target:S.parent,mode:"child",skipUndo:!0})}y.forEach(p=>{t.exec("add-link",{link:{source:p.source,target:p.target,type:p.type},eventSource:"copy-task",skipUndo:!0})}),this.setStateAsync({tasks:c})}),t.on("open-task",({id:r,mode:o})=>{const{tasks:a}=this.getState(),i=a.byId(r);i.lazy?t.exec("request-data",{id:i.id}):(a.toArray().forEach(l=>l.$y=0),a.update(r,{open:o}),this.setState({tasks:a}))}),t.on("scroll-chart",({left:r,top:o})=>{if(!isNaN(r)){const a=this.calcScaleDate(r);this.setState({scrollLeft:r,_scaleDate:a})}isNaN(o)||this.setState({scrollTop:o})}),t.on("render-data",r=>{this.setState({area:r})}),t.on("provide-data",r=>{const{tasks:o,links:a,durationUnit:i,calendar:l,splitTasks:c}=this.getState(),u=o.byId(r.id);u.lazy?(u.lazy=!1,u.open=!0):u.data=[],En(r.data.tasks,{durationUnit:i,calendar:l}),o.parse(r.data.tasks,r.id),u.type=="summary"&&this.resetSummaryDates(u.id,"provide-data"),this.setStateAsync({tasks:o,links:new xs(a.map(f=>f).concat(Mr(r.data.links)))})}),t.on("zoom-scale",({dir:r,offset:o})=>{const{zoom:a,cellWidth:i,_cellWidth:l,scrollLeft:c}=this.getState(),u=o+c,f=this.calcScaleDate(u);let h=i;r<0&&(h=l||i);const x=h+r*50,w=a.levels[a.level],m=r<0&&i>w.maxCellWidth;if(x<w.minCellWidth||x>w.maxCellWidth||m){if(!this.changeScale(a,r))return}else this.setState({cellWidth:x,_cellWidth:x});const{_scales:y,_start:p,cellWidth:v,_weekStart:k}=this.getState(),S=Ge(y.minUnit,p,k),N=y.diff(f,S,"hour");typeof o>"u"&&(o=v);let _=Math.round(N*v)-o;_<0&&(_=0),this.setState({scrollLeft:_,_scaleDate:f,_zoomOffset:o})}),t.on("expand-scale",({minWidth:r})=>{const{_start:o,_scales:a,start:i,end:l,_end:c,cellWidth:u,_scaleDate:f,_zoomOffset:h}=this.getState(),x=Ye(a.minUnit);let w=a.width;if(i&&l){if(w<r&&w){const k=r/w;this.setState({cellWidth:u*k})}return!0}let m=0;for(;w<r;)w+=u,m++;const y=m&&l?-m:0,p=i||x(o,y);let v=0;if(f){const k=a.diff(f,p,"hour");v=Math.max(0,Math.round(k*u)-(h||0))}this.setState({_start:p,_end:l||x(c,m),scrollLeft:v})}),t.on("sort-tasks",({key:r,order:o,add:a})=>{const i=this.getState(),{tasks:l}=i;let c=i._sort;const u={key:r,order:o};let f=c?.length||0;f&&a?(c.forEach((h,x)=>{h.key===r&&(f=x)}),c[f]=u):c=[u],l.sort(c),this.setState({_sort:c,tasks:l})}),t.on("hotkey",({key:r,event:o,eventSource:a})=>{switch(r){case"arrowup":case"arrowdown":{const{selected:i,_tasks:l}=this.getState();o.preventDefault();const c=i.length;let u;if(r==="arrowup"?u=c?this.getPrevRow(i[c-1])?.id:l[l.length-1]?.id:u=c?this.getNextRow(i[c-1])?.id:l[0]?.id,u){const f=a==="chart"?"xy":!0;this.in.exec("select-task",{id:u,show:f})}break}case"ctrl+c":{Mt(this,"copy-task",null,null);break}case"ctrl+x":{Mt(this,"cut-task",null,null);break}case"ctrl+v":{Mt(this,"paste-task",null,null);break}case"ctrl+d":case"backspace":{o.preventDefault(),Mt(this,"delete-task",null,null);break}case"ctrl+z":{this.in.exec("undo",{});break}case"ctrl+y":{this.in.exec("redo",{});break}}})}init(e){const t=this.getState().area?{}:{scrollLeft:0,scrollTop:0,area:{from:0,start:0,end:0}};e.cellWidth&&(e._cellWidth=e.cellWidth),e._sort=null,e.unscheduledTasks=!1,e.baselines=!1,e.markers=[],e._markers=[],e.undo=!1,e.schedule={},e.criticalPath=null,e.splitTasks=!1,e.summary={},Array.isArray(e.tasks)&&this.getHistory()?.resetHistory(),this._router.init({_scrollTask:null,selected:[],markers:[],autoScale:!0,durationUnit:"day",...t,...e})}setState(e,t){return this._router.setState(e,t)}setStateAsync(e){this._router.setStateAsync(e)}getTask(e){const{tasks:t}=this.getState();return t.byId(e)}getHistory(){return this.getState().undo?this._modules.get("historyManager"):null}serialize(){return this.getState().tasks.serialize()}changeScale(e,t){const s=e.level+t,r=e.levels[s];if(r){const{cellWidth:o,scales:a,_scales:i}=this.getState(),l=Va(e,t,s,r,i.lengthUnit,a,o);return l._cellWidth=l.cellWidth,this.setState(l),!0}return!1}isScheduled(e){return this.getState().unscheduledTasks?e.some(t=>!t.unscheduled||t.data&&this.isScheduled(t.data)):!0}resetSummaryDates(e,t,s){const{tasks:r,durationUnit:o,splitTasks:a,calendar:i}=this.getState(),l=r.byId(e),c=l.data;if(c?.length&&this.isScheduled(c)){const u=Un({...l,start:void 0,end:void 0,duration:void 0});if(!gt(l.start,u.start)||!gt(l.end,u.end)){s?(rt(u,{durationUnit:o,calendar:i}),r.update(e,u)):this.in.exec("update-task",{id:e,task:u,eventSource:t,skipUndo:!0});const f=r.getSummaryId(e);f&&this.resetSummaryDates(f,t)}}}moveSummaryKids(e,t,s){const{tasks:r}=this.getState();e.data.forEach(o=>{const a={...r.byId(o.id),start:t(o.start)};delete a.end,delete a.id,this.in.exec("update-task",{id:o.id,task:a,eventSource:s,skipUndo:!0}),o.data?.length&&this.moveSummaryKids(o,t,s)})}calcScaleDate(e){const{_scales:t,_start:s,_weekStart:r}=this.getState(),o=t.lengthUnit==="day"?t.lengthUnitWidth/24:t.lengthUnitWidth;return Ye("hour")(Ge(t.minUnit,s,r),Math.floor(e/o))}getNextRow(e){const t=this.getState()._tasks,s=t.findIndex(r=>r.id==e);return t[s+1]}getPrevRow(e){const t=this.getState()._tasks,s=t.findIndex(r=>r.id==e);return t[s-1]}}function li(n,e,t,s){if(typeof document>"u")return"";const r=document.createElement("canvas");{const o=ci(r,n,e,1,t);ui(o,s,0,n,0,e)}return r.toDataURL()}function ci(n,e,t,s,r){n.setAttribute("width",(e*s).toString()),n.setAttribute("height",(t*s).toString());const o=n.getContext("2d");return o.translate(-.5,-.5),o.strokeStyle=r,o}function ui(n,e,t,s,r,o){n.beginPath(),n.moveTo(s,r),n.lineTo(s,o),e==="full"&&n.lineTo(t,o),n.stroke()}const Dr=[{id:"task",label:"Task"},{id:"summary",label:"Summary task"},{id:"milestone",label:"Milestone"}];function _s(n){let e=[...pi];const t=n?.taskTypes||Dr,s=e.find(r=>r.id=="convert-task");return s.data=[],t.forEach(r=>{(!n?.summary?.autoConvert||r.id!=="summary")&&s.data.push(s.dataFactory(r))}),e}function Yn(n){return n.map(e=>{switch(e.data&&Yn(e.data),e.id){case"add-task:before":case"move-task:up":e.isDisabled=(t,s)=>fi(t,s);break;case"move-task:down":e.isDisabled=(t,s)=>hi(t,s);break;case"indent-task:add":e.isDisabled=(t,s)=>gi(t,s)===t.parent;break;case"indent-task:remove":e.isDisabled=t=>di(t);break}return e})}function di(n){return n.parent===0}function fi(n,e){const{_tasks:t}=e;return t[0]?.id===n.id}function hi(n,e){const{_tasks:t}=e;return t[t.length-1]?.id===n.id}function gi(n,e){const{_tasks:t}=e,s=t.findIndex(r=>r.id===n.id);return t[s-1]?.id??n.parent}function Cs(n){return n&&typeof n=="object"}function xi(n){return!n.selected||n.selected.length<2}const mi=n=>e=>e.type===n,pi=Yn([{id:"add-task",text:"Add",icon:"wxi-plus",data:[{id:"add-task:child",text:"Child task"},{id:"add-task:before",text:"Task above"},{id:"add-task:after",text:"Task below"}]},{type:"separator"},{id:"convert-task",text:"Convert to",icon:"wxi-swap-horizontal",dataFactory:n=>({id:`convert-task:${n.id}`,text:`${n.label}`,isDisabled:mi(n.id)})},{id:"edit-task",text:"Edit",icon:"wxi-edit",isHidden:(n,e,t)=>Cs(t)},{type:"separator"},{id:"cut-task",text:"Cut",icon:"wxi-content-cut",subtext:"Ctrl+X"},{id:"copy-task",text:"Copy",icon:"wxi-content-copy",subtext:"Ctrl+C"},{id:"paste-task",text:"Paste",icon:"wxi-content-paste",subtext:"Ctrl+V"},{id:"move-task",text:"Move",icon:"wxi-swap-vertical",data:[{id:"move-task:up",text:"Up"},{id:"move-task:down",text:"Down"}]},{type:"separator"},{id:"indent-task:add",text:"Indent",icon:"wxi-indent"},{id:"indent-task:remove",text:"Outdent",icon:"wxi-unindent"},{type:"separator"},{id:"delete-task",icon:"wxi-delete",text:"Delete",subtext:"Ctrl+D / BS",isHidden:(n,e,t)=>xi(e)&&Cs(t)}]);Yn([{id:"add-task",comp:"button",icon:"wxi-plus",text:"New task",type:"primary"},{id:"edit-task",comp:"icon",icon:"wxi-edit",menuText:"Edit",text:"Ctrl+E"},{id:"delete-task",comp:"icon",icon:"wxi-delete",menuText:"Delete",text:"Ctrl+D, Backspace"},{comp:"separator"},{id:"move-task:up",comp:"icon",icon:"wxi-angle-up",menuText:"Move up"},{id:"move-task:down",comp:"icon",icon:"wxi-angle-down",menuText:"Move down"},{comp:"separator"},{id:"copy-task",comp:"icon",icon:"wxi-content-copy",menuText:"Copy",text:"Ctrl+V"},{id:"cut-task",comp:"icon",icon:"wxi-content-cut",menuText:"Cut",text:"Ctrl+X"},{id:"paste-task",comp:"icon",icon:"wxi-content-paste",menuText:"Paste",text:"Ctrl+V"},{comp:"separator"},{id:"indent-task:add",comp:"icon",icon:"wxi-indent",menuText:"Indent"},{id:"indent-task:remove",comp:"icon",icon:"wxi-unindent",menuText:"Outdent"}]);new Date().valueOf();function wi(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in e){const s=n[t],r=e[t];if(!Ht(s,r))return!1}return!0}function Ht(n,e){if(typeof n=="number"||typeof n=="string"||typeof n=="boolean"||n===null)return n===e;if(typeof n!=typeof e||(n===null||e===null)&&n!==e||n instanceof Date&&e instanceof Date&&n.getTime()!==e.getTime())return!1;if(typeof n=="object")if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;for(let t=n.length-1;t>=0;t--)if(!Ht(n[t],e[t]))return!1;return!0}else return wi(n,e);return n===e}function Rn(n){if(typeof n!="object"||n===null)return n;if(n instanceof Date)return new Date(n);if(n instanceof Array)return n.map(Rn);const e={};for(const t in n)e[t]=Rn(n[t]);return e}var Tr=2,yi=class{constructor(e){e&&(this._writable=e.writable,this._async=e.async),this._values={},this._state={}}setState(e,t=0){const s={};return this._wrapProperties(e,this._state,this._values,"",s,t),s}getState(){return this._values}getReactive(){return this._state}_wrapProperties(e,t,s,r,o,a){for(const i in e){const l=t[i],c=s[i],u=e[i];if(l&&(c===u&&typeof u!="object"||u instanceof Date&&c instanceof Date&&c.getTime()===u.getTime()))continue;const f=r+(r?".":"")+i;l?(l.__parse(u,f,o,a)&&(s[i]=u),a&Tr?o[f]=l.__trigger:l.__trigger()):(u&&u.__reactive?t[i]=this._wrapNested(u,u,f,o):t[i]=this._wrapWritable(u),s[i]=u),o[f]=o[f]||null}}_wrapNested(e,t,s,r){const o=this._wrapWritable(e);return this._wrapProperties(e,o,t,s,r,0),o.__parse=(a,i,l,c)=>(this._wrapProperties(a,o,t,i,l,c),!1),o}_wrapWritable(e){const t=[],s=function(){for(let r=0;r<t.length;r++)t[r](e)};return{subscribe:r=>(t.push(r),this._async?setTimeout(r,1,e):r(e),()=>{const o=t.indexOf(r);o>=0&&t.splice(o,1)}),__trigger:()=>{t.length&&(this._async?setTimeout(s,1):s())},__parse:function(r){return e=r,!0}}}},vi=class{constructor(n,e,t,s){typeof n=="function"?this._setter=n:this._setter=n.setState.bind(n),this._routes=e,this._parsers=t,this._prev={},this._triggers=new Map,this._sources=new Map,this._routes.forEach(r=>{r.in.forEach(o=>{const a=this._triggers.get(o)||[];a.push(r),this._triggers.set(o,a)}),r.out.forEach(o=>{const a=this._sources.get(o)||{};r.in.forEach(i=>a[i]=!0),this._sources.set(o,a)})}),this._routes.forEach(r=>{r.length=Math.max(...r.in.map(o=>Ir(o,this._sources,1)))}),this._bus=s}init(n){const e={};for(const t in n)if(this._prev[t]!==n[t]){const s=this._parsers[t];e[t]=s?s(n[t]):n[t]}this._prev=this._prev?{...this._prev,...n}:{...n},this.setState(e),this._bus&&this._bus.exec("init-state",e)}setStateAsync(n){const e=this._setter(n,Tr);return this._async?Object.assign(this._async.signals,e):this._async={signals:e,timer:setTimeout(this._applyState.bind(this),1)},e}_applyState(){const n=this._async;if(n){this._async=null,this._triggerUpdates(n.signals,[]);for(const e in n.signals){const t=n.signals[e];t&&t()}}}setState(n,e=[]){const t=this._setter(n);return this._triggerUpdates(t,e),t}_triggerUpdates(n,e){const t=Object.keys(n),s=!e.length;e=e||[];for(let r=0;r<t.length;r++){const o=t[r],a=this._triggers.get(o);a&&a.forEach(i=>{e.indexOf(i)==-1&&e.push(i)})}s&&this._execNext(e)}_execNext(n){for(;n.length;){n.sort((t,s)=>t.length<s.length?1:-1);const e=n[n.length-1];n.splice(n.length-1),e.exec(n)}}};function Ir(n,e,t){const s=e.get(n);if(!s)return t;const r=Object.keys(s).map(o=>Ir(o,e,t+1));return Math.max(...r)}var ki=class{constructor(){this._nextHandler=null,this._handlers={},this._tag=new WeakMap,this.exec=this.exec.bind(this)}on(n,e,t){let s=this._handlers[n];s?t&&t.intercept?s.unshift(e):s.push(e):s=this._handlers[n]=[e],t&&t.tag&&this._tag.set(e,t.tag)}intercept(n,e,t){this.on(n,e,{...t,intercept:!0})}detach(n){for(const e in this._handlers){const t=this._handlers[e];for(let s=t.length-1;s>=0;s--)this._tag.get(t[s])===n&&t.splice(s,1)}}async exec(n,e){const t=this._handlers[n];if(t)for(let s=0;s<t.length;s++){const r=t[s](e);if(r===!1||r&&r.then&&await r===!1)return}return this._nextHandler&&await this._nextHandler.exec(n,e),e}setNext(n){return this._nextHandler=n}};function bi(n){return e=>e[n]}function Si(n){return(e,t)=>e[n]=t}function lt(n,e){return(e.getter||bi(e.id))(n)}function js(n,e,t){return(e.setter||Si(e.id))(n,t)}function $s(n,e){const t=document.createElement("a");t.href=URL.createObjectURL(n),t.download=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Je(n,e){let t=lt(n,e)??"";return e.template&&(t=e.template(t,n,e)),e.optionsMap&&(Array.isArray(t)?t=t.map(s=>e.optionsMap.get(s)):t=e.optionsMap.get(t)),typeof t>"u"?"":t+""}function _i(n,e){const t=/\n|"|;|,/;let s="";const r=e.rows||`
`,o=e.cols||"	",a=n._columns,i=n.flatData;e.header!==!1&&a[0].header&&(s=Ms("header",a,s,o,r));for(let l=0;l<i.length;l++){const c=[];for(let u=0;u<a.length;u++){let f=Je(i[l],a[u]);t.test(f)&&(f='"'+f.replace(/"/g,'""')+'"'),c.push(f)}s+=(s?r:"")+c.join(o)}return e.footer!==!1&&a[0].footer&&(s=Ms("footer",a,s,o,r)),s}function Ms(n,e,t,s,r){const o=/\n|"|;|,/;for(let a=0;a<e[0][n].length;a++){const i=[];for(let l=0;l<e.length;l++){let c=(e[l][n][a].text||"")+"";o.test(c)&&(c='"'+c.replace(/"/g,'""')+'"'),i.push(c)}t+=(t?r:"")+i.join(s)}return t}function Ci(n,e,t){const s=[],r=[],o=[];let a=[];const i=n._columns,l=n.flatData,c=n._sizes;for(const f of i)o.push({width:f.flexgrow?c.columnWidth:f.width});let u=0;e.header!==!1&&i[0].header&&(Ns("header",i,s,r,u,e,t),a=a.concat(c.headerRowHeights.map(f=>({height:f}))),u+=i[0].header.length);for(let f=0;f<l.length;f++){const h=[];for(let x=0;x<i.length;x++){const w=l[f],m=i[x],y=lt(w,m)??"";let p=Je(w,m),v;e.cellStyle&&(v=e.cellStyle(y,w,m)),e.cellTemplate&&(p=e.cellTemplate(y,w,m)??p);const k=Hr(p,2,v,t);h.push(k)}s.push(h),a.push({height:c.rowHeight})}return u+=l.length,e.footer!==!1&&i[0].footer&&(Ns("footer",i,s,r,u,e,t),a=a.concat(c.footerRowHeights.map(f=>({height:f})))),{cells:s,merged:r,rowSizes:a,colSizes:o,styles:t}}function Ns(n,e,t,s,r,o,a){for(let i=0;i<e[0][n].length;i++){const l=[];for(let c=0;c<e.length;c++){const u=e[c][n][i],f=u.colspan?u.colspan-1:0,h=u.rowspan?u.rowspan-1:0;(f||h)&&s.push({from:{row:i+r,column:c},to:{row:i+r+h,column:c+f}});let x=u.text??"",w;o.headerCellStyle&&(w=o.headerCellStyle(x,u,e[c],n)),o.headerCellTemplate&&(x=o.headerCellTemplate(x,u,e[c],n)??x);let m;n=="header"?i==e[0][n].length-1?m=1:m=0:i?m=4:m=3;const y=Hr(x,m,w,a);l.push(y)}t.push(l)}}function Hr(n,e,t,s){let r=e;if(n&&n instanceof Date&&(n=$i(n),t=t||{},t.format=t.format||"dd/mm/yyyy"),t){t={...s[e],...t};const o=s.findIndex(a=>Ht(a,t));o<0?(s.push(t),r=s.length-1):r=o}return{v:n+"",s:r}}function ji(n){const e={material:"#000000",willow:"#000000","willow-dark":"#ffffff"},t={material:"none",willow:"none","willow-dark":"#2a2b2d"},s={material:"#fafafb",willow:"#f2f3f7","willow-dark":"#20262b"},r={material:"0.5px solid #dfdfdf",willow:"0.5px solid #e6e6e6","willow-dark":"0.5px solid #384047"},o={material:"#dfdfdf",willow:"#e6e6e6","willow-dark":"#384047"},a=e[n],i="0.5px solid "+o[n],l={verticalAlign:"center",align:"left"},c={fontWeight:"bold",color:a,background:s[n],...l,borderBottom:i,borderRight:i};return{cell:{color:a,background:t[n],borderBottom:r[n],borderRight:r[n],...l},header:{...c},footer:{...c}}}function $i(n){return n?25569+(n.getTime()-n.getTimezoneOffset()*6e4)/(86400*1e3):null}const Mi="portrait",Ni=100,Ei="a4",Ri={a3:{width:11.7,height:16.5},a4:{width:8.27,height:11.7},letter:{width:8.5,height:11}};function Di(n,e){const t=[];let s=[],r=0;const o=n.filter(i=>!i.hidden),a=Ti(e);return o.forEach((i,l)=>{r+i.width<=a?(r+=i.width,s.push(i)):(s.length&&t.push(s),s=[i],r=i.width),l===o.length-1&&s.length&&t.push(s)}),t}function Es(n,e,t){const s=[];return n.forEach((r,o)=>{const a=r[e];for(let i=0;i<t.length;i++){s[i]||(s[i]=[]);const l={...a[i]};if(s[i][o]!==null){if(!o&&!l.rowspan&&!l.colspan){let c=1,u=n[o+c][e][i],f=l.width;for(;!u.rowspan&&!u.colspan;)c++,u=n[o+c][e][i],f+=u.width;l.colspan=c,l.width=f,l.height=t[i]}if(s[i].push(l),!l.collapsed&&l.colspan>1){let c=l.colspan-1;if(l.colspan+o>n.length){const u=l.colspan-(l.colspan+o-n.length);l.colspan=u,l.width=n.slice(o,o+c+1).reduce((f,h)=>f+h.width,0),u>1&&(c=u-1)}for(let u=0;u<c;u++)s[i].push(null)}if(l.rowspan>1){const c=l.rowspan;for(let u=1;u<c;u++)s[i+u]||(s[i+u]=[]),s[i+u].push(null)}}}if(r.collapsed)for(let i=0;i<s.length;i++){const l=s[i],c=l[o];if(c&&c.collapsed){if(l[o]=null,!i)break}else{const u=c||l.findLast(f=>f?.colspan>=1);u&&(u.colspan=u.colspan-1,u.width=u.width-r.width)}}}),s.map(r=>r.filter(o=>o&&o.colspan!==0))}function Ti(n){const{mode:e,ppi:t,paper:s}=n,{width:r,height:o}=Ri[s];return Ii(e==="portrait"?r:o,t)}function Ii(n,e){return n*e}function Hi(n={}){const{mode:e,ppi:t,paper:s}=n;return{mode:e||Mi,ppi:t||Ni,paper:s||Ei}}function Ar(n,e){return n.flexgrow?`min-width:${e}px;width:auto`:`width:${n.width}px; max-width:${n.width}px; height:${n.height}px`}function Ai(n,e,t){let s=n[t.id];if(t.filter.type==="richselect"&&s){const r=t.filter.config?.options||e.find(({id:o})=>o==t.id).options;r&&(s=r.find(({id:o})=>o==s).label)}return s??""}const Rs=["resize-column","hide-column","update-cell"],Li=["delete-row","update-row","update-cell"],Fi=["move-item"],zi=["resize-column","move-item"];class Oi{undo=[];redo=[];progress={};in;getState;setState;_previousValues={};constructor(e,t,s){this.in=e,this.getState=t,this.setState=s,this.setHandlers(),this.resetStateHistory()}getHandlers(){return{"add-row":{handler:e=>({action:"delete-row",data:{id:e.id},source:{action:"add-row",data:e}})},"delete-row":{handler:e=>{const{id:t}=e,{data:s}=this.getPrev(),r=s.findIndex(o=>o.id==t);return{action:"add-row",data:{id:t,row:s[r],before:r<s.length-1?s[r+1].id:void 0},source:{action:"delete-row",data:e}}}},"update-cell":{handler:e=>{const{id:t,column:s}=e,r=this.getRow(t),o=this.getColumn(s),a=lt(r,o);return Ht(a,e.value)?null:{action:"update-cell",data:{id:t,column:s,value:a},source:{action:"update-cell",data:e}}}},"update-row":{handler:e=>{const{id:t,row:s}=e,r=this.getRow(t);for(const o in s)Object.keys(r).includes(o)||(r[o]=void 0);return{action:"update-row",data:{id:t,row:r},source:{action:"update-row",data:e}}}},"copy-row":{handler:e=>{const{id:t}=e,{data:s}=this.getState(),r=s.findIndex(a=>a.id==t),o=s[r];return{action:"delete-row",data:{id:t},source:{action:"add-row",data:{id:t,row:o,before:r<s.length-1?s[r+1].id:void 0}}}}},"resize-column":{handler:e=>{const{id:t,width:s}=e,r=this.getColumn(t),{_sizes:o}=this.getState();return{action:"resize-column",data:{id:t,width:r.width??o.columnWidth},source:{action:"resize-column",data:{id:t,width:s}}}}},"hide-column":{handler:e=>{const{id:t}=e,s=this.getColumn(t);return{action:"hide-column",data:{id:t,mode:s.hidden},source:{action:"hide-column",data:e}}}},"collapse-column":{handler:e=>{const{id:t,row:s,mode:r}=e;return{action:"collapse-column",data:{id:t,row:s,mode:typeof r=="boolean"?!r:r},source:{action:"collapse-column",data:e}}}},"move-item":{handler:e=>{const{id:t,target:s,mode:r}=e,{flatData:o}=this.getPrev(),a=o.findIndex(i=>i.id==t);return{action:"move-item",data:{id:t,target:o[a+(a?-1:1)].id,mode:a?"after":"before"},source:{action:"move-item",data:{id:t,target:s,mode:r}}}}},"open-row":{handler:e=>{const{id:t,nested:s}=e;return{action:"close-row",data:{id:t,nested:s},source:{action:"open-row",data:e}}}},"close-row":{handler:e=>{const{id:t,nested:s}=e;return{action:"open-row",data:{id:t,nested:s},source:{action:"close-row",data:e}}}}}}resetHistory(){this.undo=[],this.redo=[],this.progress={},this.resetStateHistory()}getPrev(){return this._previousValues}setHandlers(){const e=this.getHandlers();for(const t in e)this.in.intercept(t,s=>{if(!(s.eventSource==="undo"||s.eventSource==="redo"||s.skipUndo)){if(zi.includes(t)){(s.inProgress&&!this.progress[t]||typeof s.inProgress!="boolean")&&(Fi.includes(t)&&this.setPrev("flatData"),Rs.includes(t)&&this.setPrev("columns")),this.progress[t]=s.inProgress;return}Li.includes(t)&&this.setPrev("data"),Rs.includes(t)&&this.setPrev("columns")}}),this.in.on(t,s=>{if(s.eventSource==="undo"||s.eventSource==="redo"||s.skipUndo||s.inProgress)return;const r=e[t].handler(s);r&&this.addToHistory(r)})}setPrev(e){this._previousValues[e]=Rn(this.getState()[e])}addToHistory(e){this.undo.push(e),this.redo=[],this.setStateHistory()}handleUndo(){if(!this.undo.length)return;const e=this.undo.pop();this.redo.push({...e.source,source:e}),this.in.exec(e.action,{...e.data,eventSource:"undo"}),this.setStateHistory()}handleRedo(){if(!this.redo.length)return;const e=this.redo.pop();this.undo.push({...e.source,source:e}),this.in.exec(e.action,{...e.data,eventSource:"redo"}),this.setStateHistory()}resetStateHistory(){this.setState({history:{undo:0,redo:0}})}setStateHistory(){this.setState({history:{undo:this.undo.length,redo:this.redo.length}})}getRow(e){const{data:t}=this.getPrev();return this.getState().tree?this.getTreeRow(t,e):t.find(s=>s.id==e)}getTreeRow(e,t){for(let s=0;s<e.length;s++){if(e[s].id==t)return e[s];if(e[s].data){const r=this.getTreeRow(e[s].data,t);if(r)return r}}return null}getColumn(e){const{columns:t}=this.getPrev();return t.find(s=>s.id==e)}}function Lr(){let n=!0;return n=!1,n}function Fr(n,e){return typeof n>"u"||n===null?-1:typeof e>"u"||e===null?1:n===e?0:n>e?1:-1}function Pi(n,e){return-Fr(n,e)}function Wi(n,e){if(typeof e.sort=="function")return function(s,r){const o=e.sort(s,r);return n==="asc"?o:-o};const t=n==="asc"?Fr:Pi;return function(s,r){return t(lt(s,e),lt(r,e))}}function Ui(n,e){if(!n||!n.length)return;const t=n.map(s=>{const r=e.find(o=>o.id==s.key);return Wi(s.order,r)});return n.length===1?t[0]:function(s,r){for(let o=0;o<t.length;o++){const a=t[o](s,r);if(a!==0)return a}return 0}}const Gt=28,Yi=20;function Bi(){if(typeof document>"u")return"willow";const n=document.querySelector('[class^="wx"][class$="theme"]');return n?n.className.substring(3,n.className.length-6):"willow"}function sn(n,e,t,s,r){const o=document.createElement("div"),a=document.createElement("div"),i=document.body;r=r?`${r}px`:"auto";let l,c;a.className=e,o.classList.add(`wx-${t}-theme`),o.style.cssText=`height:auto;position:absolute;top:0px;left:100px;overflow:hidden;width=${r};white-space:nowrap;`,o.appendChild(a),i.appendChild(o),typeof n!="object"&&(n=[n]);for(let u=0;u<n.length;u++){a.innerText=n[u]+"";const f=o.getBoundingClientRect(),h=Math.ceil(f.width)+(s&&s.length?s[u]:0),x=Math.ceil(f.height);l=Math.max(l||0,h),c=Math.max(c||0,x)}return o.remove(),{width:l,height:c}}function Ds(n,e,t,s,r){const o=[];for(let a=0;a<n.length;a++){const i=n[a][e],l=i.length;for(let c=0;c<l;c++){const{text:u,vertical:f,collapsed:h,rowspan:x,css:w}=i[c];if(!u){o[c]=Math.max(o[c]||0,s);continue}let m=0;if(f&&!h){let y=`wx-measure-cell-${e}`;if(y+=w?` ${w}`:"",m=sn(u,y,r).width,(x>1||!i[c+1])&&t>c+1){const p=x||t-c,v=o.slice(c,c+p).reduce((k,S)=>k+S,0);if(v<m){const k=Math.ceil((m-v)/p);for(let S=c;S<c+p;S++)o[S]=(o[S]||s)+k}continue}}o[c]=Math.max(o[c]||s,m)}}return o}function Vi(n,e,t){const s=[],r=[];let o="wx-measure-cell-body";o+=n.css?` ${n.css}`:"";for(let a=0;a<e.length;a++){const i=e[a],l=Je(i,n);l&&(s.push(l),n.treetoggle?r.push(e[a].$level*Gt+(e[a].$count?Gt:0)+(n.draggable?Gt:0)):n.draggable&&r.push(Gt))}return sn(s,o,t,r).width}function Gi(n,e){const t="wx-measure-cell-header",s=n.sort?Yi:0;let r=n.header;if(typeof r=="string")return sn(r,t,e).width+s;let o;Array.isArray(r)||(r=[r]);for(let a=0;a<r.length;a++){const i=r[a],l=typeof i=="string"?i:i.text,c=t+(typeof i=="string"?"":` ${i.css}`);let u=sn(l,c,e).width;a===r.length-1&&(u+=s),o=Math.max(o||0,u)}return o}const Ki={text:(n,e)=>n?n.toString().toLowerCase().indexOf(e.toLowerCase())!==-1:!e,richselect:(n,e)=>typeof e!="number"&&!e?!0:n==e};function qi(n){return Ki[n]}let Xi=class extends yi{in;_router;_branches;_xlsxWorker;_historyManager;constructor(e){super({writable:e,async:!1});const t={rowHeight:37,columnWidth:160,headerHeight:36,footerHeight:36};this._router=new vi(super.setState.bind(this),[{in:["columns","sizes","_skin"],out:["_columns","_sizes"],exec:r=>{const{columns:o,sizes:a,_skin:i}=this.getState(),l=this.copyColumns(o),c=l.reduce((h,x)=>Math.max(x.header.length,h),0),u=l.reduce((h,x)=>Math.max(x.footer.length,h),0);l.forEach(this.setCollapsibleColumns);const f=this.normalizeSizes(l,a,c,u,i);for(let h=0;h<l.length;h++)this.normalizeColumns(l,h,"header",c,f),this.normalizeColumns(l,h,"footer",u,f);this.setState({_columns:l,_sizes:f},r)}},{in:["data","tree","_filterIds"],out:["flatData","_rowHeightFromData"],exec:r=>{const{data:o,tree:a,dynamic:i,_filterIds:l}=this.getState(),c=l&&new Set(l),u=a?this.flattenRows(o,[],l):c?o.filter(h=>c.has(h.id)):o,f=!i&&u.some(h=>h.rowHeight);this.setState({flatData:u,_rowHeightFromData:f},r)}}],{sizes:r=>({...t,...r})});const s=this.in=new ki;s.on("close-editor",({ignore:r})=>{const{editor:o}=this.getState();o&&(r||s.exec("update-cell",o),this.setState({editor:null}))}),s.on("open-editor",({id:r,column:o})=>{let a=this.getState().editor;a&&s.exec("close-editor",{});const i=this.getRow(r),l=o?this.getColumn(o):this.getNextEditor(i);if(l?.editor){let c=l.editor;if(typeof c=="function"&&(c=c(i,l)),!c)return;a={column:l.id,id:r,value:lt(i,l)??"",renderedValue:Je(i,l)},typeof c=="object"&&c.config&&(a.config=c.config,c.config.options&&(a.options=c.config.options)),l.options&&!a.options&&(a.options=l.options),this.setState({editor:a})}}),s.on("editor",({value:r})=>{const o=this.getState().editor;o&&(o.value=r,this.setState({editor:o}))}),s.on("add-row",r=>{const o=this.getState();let{data:a}=o;const{select:i,_filterIds:l}=o,{row:c,before:u,after:f,select:h}=r;if(r.id=c.id=r.id||c.id||Kt(),u||f){const w=u||f,m=a.findIndex(y=>y.id===w);a=[...a],a.splice(m+(f?1:0),0,r.row)}else a=[...a,r.row];const x={data:a};l&&(x._filterIds=[...l,r.id]),this.setState(x),!(typeof h=="boolean"&&!h)&&(h||i)&&s.exec("select-row",{id:c.id,show:!0})}),s.on("delete-row",r=>{const{data:o,selectedRows:a,focusCell:i,editor:l}=this.getState(),{id:c}=r,u={data:o.filter(f=>f.id!==c)};this.isSelected(c)&&(u.selectedRows=a.filter(f=>f!==c)),l?.id==c&&(u.editor=null),this.setState(u),i?.row===c&&this.in.exec("focus-cell",{eventSource:"delete-row"})}),s.on("update-cell",r=>{const o=this.getState();let{data:a}=o;a=[...a];const{tree:i}=o,{id:l,column:c,value:u}=r,f=this.getColumn(c);if(i){const h={...this._branches[l]};js(h,f,u);const x=this.updateTreeRow(h);h.$parent===0&&(a=x)}else{const h=a.findIndex(w=>w.id==l),x={...a[h]};js(x,f,u),a[h]=x}this.setState({data:a})}),s.on("update-row",r=>{let{data:o}=this.getState();const{id:a,row:i}=r,l=o.findIndex(c=>c.id==a);o=[...o],o[l]={...o[l],...i},this.setState({data:o})}),s.on("select-row",({id:r,toggle:o,range:a,mode:i,show:l,column:c})=>{const u=this.getState(),{focusCell:f}=u;let{selectedRows:h}=u;if(h.length||(a=o=!1),a){const{data:x}=this.getState();let w=x.findIndex(y=>y.id==h[h.length-1]),m=x.findIndex(y=>y.id==r);w>m&&([w,m]=[m,w]),x.slice(w,m+1).forEach(y=>{h.indexOf(y.id)===-1&&h.push(y.id)})}else if(o&&this.isSelected(r)){if(i===!0)return;h=h.filter(x=>x!==r)}else if(o){if(i===!1)return;h.push(r)}else h=[r];this.setState({selectedRows:[...h]}),f?.row!==r&&this.in.exec("focus-cell",{eventSource:"select-row"}),l&&this.in.exec("scroll",{row:r,column:c})}),this.in.on("focus-cell",r=>{const{row:o,column:a,eventSource:i}=r,{_columns:l,split:c}=this.getState();o&&a?(this.setState({focusCell:{row:o,column:a}}),i!=="click"&&((!c.left||l.findIndex(u=>u.id==r.column)>=c.left)&&(!c.right||l.findIndex(u=>u.id==r.column)<l.length-c.right)?this.in.exec("scroll",{row:o,column:a}):this.in.exec("scroll",{row:o}))):this.setState({focusCell:null})}),s.on("resize-column",r=>{const{id:o,auto:a,maxRows:i,inProgress:l}=r;if(l===!1)return;let c=r.width||0;const u=[...this.getState().columns],f=u.find(h=>h.id==o);if(a){if(a=="data"||a===!0){const{flatData:h,_skin:x}=this.getState();let w=h.length;i&&(w=Math.min(i,w));const m=h.slice(0,w);c=Vi(f,m,x)}if(a=="header"||a===!0){const{_skin:h}=this.getState();c=Math.max(Gi(f,h),c)}}f.width=Math.max(17,c),delete f.flexgrow,this.setState({columns:u})}),s.on("hide-column",r=>{const{id:o,mode:a}=r,i=[...this.getState().columns],l=i.find(u=>u.id==o),c=i.reduce((u,f)=>u+(f.hidden?0:1),0);!a||c>1?(l.hidden=!l.hidden,this.setState({columns:i})):r.skipUndo=!0}),s.on("sort-rows",r=>{const{key:o,add:a,sort:i}=r,l=this.getState(),{columns:c,data:u,tree:f}=l;if(i){const v=[...u];v.sort(i),this.setState({data:v});return}const{order:h="asc"}=r;let x=l.sortMarks;const w=Object.keys(x),m=w.length;!a||!m||m===1&&x[o]?x={[o]:{order:h}}:(m===1&&(x[w[0]]={...x[w[0]],index:0}),x={...x,[o]:{order:h,index:typeof a=="number"?a:x[o]?.index??m}});const y=Object.keys(x).sort((v,k)=>x[v].index-x[k].index).map(v=>({key:v,order:x[v].order}));this.setState({sortMarks:x});const p=Ui(y,c);if(p){const v=[...u];f?this.sortTree(v,p):v.sort(p),this.setState({data:v})}}),s.on("filter-rows",r=>{const{value:o,key:a,filter:i}=r;if(!Object.keys(r).length){this.setState({filterValues:{},_filterIds:null});return}const l=this.getState(),{data:c,tree:u}=l;let f=l.filterValues;const h={};a&&(f={...f,[a]:o},h.filterValues=f);const x=i??this.createFilter(f);let w=[];u?w=this.filterTree(c,x,w):c.forEach(m=>{x(m)&&w.push(m.id)}),h._filterIds=w,this.setState(h)}),s.on("collapse-column",r=>{const{id:o,row:a,mode:i}=r,l=[...this.getState().columns],c=this.getColumn(o).header,u=Array.isArray(c)?c[a]:c;typeof u=="object"&&(u.collapsed=i??!u.collapsed,this.setState({columns:l}))}),s.on("move-item",r=>{const{id:o,inProgress:a}=r;let{target:i,mode:l="after"}=r;const{data:c,flatData:u,tree:f}=this.getState(),h=u.findIndex(m=>m.id==o);let x;if(l==="up"||l==="down"){if(l==="up"){if(h===0)return;x=h-1,l="before"}else if(l==="down"){if(h===u.length-1)return;x=h+1,l="after"}i=u[x]&&u[x].id}else x=u.findIndex(m=>m.id==i);if(h===-1||x===-1||a===!1)return;let w;f?w=this.moveItem(o,i,c,l):w=this.moveItem(o,i,c,l),this.setState({data:f?this.normalizeTreeRows(w):w})}),s.on("copy-row",r=>{const{id:o,target:a,mode:i="after"}=r,l=this.getState(),{flatData:c,_filterIds:u}=l;let{data:f}=l;const h=this.getRow(o);if(!h)return;const x={...h,id:Kt()};r.id=x.id;const w=c.findIndex(y=>y.id==a);if(w===-1)return;f.splice(w+(i==="after"?1:0),0,x),f=[...f];const m={data:f};u&&(m._filterIds=[...u,x.id]),this.setState(m)}),s.on("open-row",r=>{const{id:o,nested:a}=r;this.toggleBranch(o,!0,a)}),s.on("close-row",r=>{const{id:o,nested:a}=r;this.toggleBranch(o,!1,a)}),s.on("export-data",r=>new Promise((o,a)=>{const i=r.format||"csv",l=`${r.fileName||"data"}.${i}`;if(i=="csv"){const c=_i(this.getState(),r.csv||{});r.download!==!1?$s(new Blob(["\uFEFF"+c],{type:"text/csv"}),l):r.result=c,o(!0)}else if(i=="xlsx"){let c=r.excel?.styles;!c&&c!==!1&&(c=ji(this.getState()._skin));const u=c,f=u?[{...u.header},{...u.lastHeaderCell||u.header},{...u.cell},{...u.firstFooterCell||u.footer},{...u.footer}]:Array(5).fill({}),{cells:h,merged:x,rowSizes:w,colSizes:m,styles:y}=Ci(this.getState(),r.excel||{},f),p=r.cdn||"https://cdn.dhtmlx.com/libs/json2excel/1.3.2/worker.js";this.getXlsxWorker(p).then(v=>{v.onmessage=k=>{if(k.data.type=="ready"){const S=k.data.blob;r.download!==!1?$s(S,l):r.result=S,o(!0)}},v.postMessage({type:"convert",data:{data:[{name:r.sheetName||"data",cells:h,cols:m,rows:w,merged:x}],styles:y}})})}else a()})),s.on("search-rows",r=>{const{search:o,columns:a}=r,i=this.searchRows(o,a);this.setState({search:{value:o,rows:i}})}),s.on("hotkey",({key:r,event:o,isInput:a})=>{switch(r){case"arrowup":{const{flatData:i,focusCell:l,select:c}=this.getState();if(o.preventDefault(),a)return;const u=l?l.column:this._getFirstVisibleColumn()?.id,f=l?this.getPrevRow(l.row)?.id:i[i.length-1]?.id;u&&f&&(this.in.exec("focus-cell",{row:f,column:u,eventSource:"key"}),c&&this.in.exec("select-row",{id:f}));break}case"arrowdown":{const{flatData:i,focusCell:l,select:c}=this.getState();if(o.preventDefault(),a)return;const u=l?l.column:this._getFirstVisibleColumn()?.id,f=l?this.getNextRow(l.row)?.id:i[0]?.id;u&&f&&(this.in.exec("focus-cell",{row:f,column:u,eventSource:"key"}),c&&this.in.exec("select-row",{id:f}));break}case"arrowright":{const{focusCell:i}=this.getState();if(a)return;if(o.preventDefault(),i){const l=this.getNextColumn(i.column,!0)?.id;l&&this.in.exec("focus-cell",{row:i.row,column:l,eventSource:"key"})}break}case"arrowleft":{const{focusCell:i}=this.getState();if(a)return;if(o.preventDefault(),i){const l=this.getPrevColumn(i.column,!0)?.id;l&&this.in.exec("focus-cell",{row:i.row,column:l,eventSource:"key"})}break}case"tab":{const{editor:i,focusCell:l,select:c}=this.getState();if(i){o.preventDefault();const u=i.column;let f=i.id,h=this.getNextEditor(this.getRow(f),this.getColumn(u));if(!h){const x=this.getNextRow(f);x&&(f=x.id,h=this.getNextEditor(x))}h&&(this.in.exec("open-editor",{id:f,column:h.id}),this.in.exec("focus-cell",{row:f,column:h.id,eventSource:"key"}),c&&!this.isSelected(f)&&this.in.exec("select-row",{id:f}))}else l&&this.in.exec("focus-cell",{eventSource:"key"});break}case"shift+tab":{const{editor:i,focusCell:l,select:c}=this.getState();if(i){o.preventDefault();const u=i.column;let f=i.id,h=this.getPrevEditor(this.getRow(f),this.getColumn(u));if(!h){const x=this.getPrevRow(f);x&&(f=x.id,h=this.getPrevEditor(x))}h&&(this.in.exec("open-editor",{id:f,column:h.id}),this.in.exec("focus-cell",{row:f,column:h.id,eventSource:"key"}),c&&!this.isSelected(f)&&this.in.exec("select-row",{id:f}))}else l&&this.in.exec("focus-cell",{eventSource:"key"});break}case"escape":{const{editor:i}=this.getState();i&&(this.in.exec("close-editor",{ignore:!0}),this.in.exec("focus-cell",{row:i.id,column:i.column,eventSource:"key"}));break}case"f2":{const{editor:i,focusCell:l}=this.getState();!i&&l&&this.in.exec("open-editor",{id:l.row,column:l.column});break}case"enter":{const{focusCell:i,tree:l}=this.getState();if(!a&&l&&i&&this.getColumn(i.column).treetoggle){const c=this.getRow(i.row);if(!c.data)return;this.in.exec(c.open?"close-row":"open-row",{id:i.row,nested:!0})}break}case"home":{const{editor:i,focusCell:l}=this.getState();if(!i&&l){o.preventDefault();const c=this._getFirstVisibleColumn()?.id;this.in.exec("focus-cell",{row:l.row,column:c,eventSource:"key"})}break}case"ctrl+home":{const{editor:i,focusCell:l,flatData:c,select:u}=this.getState();if(!i&&l){o.preventDefault();const f=c[0]?.id,h=this._getFirstVisibleColumn()?.id;f&&h&&(this.in.exec("focus-cell",{row:f,column:h,eventSource:"key"}),u&&!this.isSelected(f)&&this.in.exec("select-row",{id:f}))}break}case"end":{const{editor:i,focusCell:l}=this.getState();if(!i&&l){o.preventDefault();const c=this._getLastVisibleColumn()?.id,u=l.row;this.in.exec("focus-cell",{row:u,column:c,eventSource:"key"})}break}case"ctrl+end":{const{editor:i,focusCell:l,flatData:c,select:u}=this.getState();if(!i&&l){o.preventDefault();const f=c.at(-1).id,h=this._getLastVisibleColumn()?.id;f&&h&&(this.in.exec("focus-cell",{row:f,column:h,eventSource:"key"}),u&&!this.isSelected(f)&&this.in.exec("select-row",{id:f}))}break}case"ctrl+z":{this.in.exec("undo",{});break}case"ctrl+y":{this.in.exec("redo",{});break}}}),s.on("scroll",r=>{const{_columns:o,split:a,_sizes:i,flatData:l,dynamic:c,_rowHeightFromData:u}=this.getState();let f=-1,h=-1,x=0,w=0;if(r.column){f=0;const m=o.findIndex(y=>y.id==r.column);x=o[m].width;for(let y=a.left??0;y<m;y++){const p=o[y];p.hidden||(f+=p.width)}}if(r.row&&!c){const m=l.findIndex(y=>y.id==r.row);m>=0&&(u?(h=l.slice(0,m).reduce((y,p)=>y+(p.rowHeight||i.rowHeight),0),w=l[m].rowHeight):h=i.rowHeight*m)}this.setState({scroll:{top:h,left:f,width:x,height:w||i.rowHeight}})}),s.on("print",r=>{const o=Hi(r);this.setState({_print:o}),this.setStateAsync({_print:null})}),s.on("undo",()=>{this._historyManager?.handleUndo()}),s.on("redo",()=>{this._historyManager?.handleRedo()}),this.initOnce()}getXlsxWorker(e){if(!this._xlsxWorker){const t=window.URL.createObjectURL(new Blob([`importScripts('${e}');`],{type:"text/javascript"}));this._xlsxWorker=new Promise(s=>{const r=new Worker(t);r.addEventListener("message",o=>{o.data.type==="init"&&s(r)})})}return this._xlsxWorker}initOnce(){const e={sortMarks:{},_filterIds:null,data:[],filterValues:{},scroll:null,editor:null,focusCell:null,_print:null,history:{undo:0,redo:0},search:null};this._router.init(e)}init(e){e.hasOwnProperty("_skin")&&!e._skin&&(e._skin=Bi()),e.columns&&e.columns.forEach(t=>{t.options&&(t.optionsMap=new Map(t.options.map(s=>[s.id,s.label])))}),Ht(this.getState().data,e.data)||(e.tree?(this._branches={0:{data:e.data}},e.data=this.normalizeTreeRows(e.data)):e.data=this.normalizeRows(e.data),this.setState({_filterIds:null,filterValues:{},sortMarks:{},search:null}),this._historyManager&&this._historyManager.resetHistory()),Lr()&&(e.tree&&(e.undo=!1,e.reorder=!1),e.split?.right&&(e.split.right=0)),e.undo&&!this._historyManager&&(this._historyManager=new Oi(this.in,this.getState.bind(this),this.setState.bind(this))),this._router.init({...e})}setState(e,t){return this._router.setState(e,t)}setStateAsync(e){this._router.setStateAsync(e)}getRow(e){const{tree:t}=this.getState();return t?this._branches[e]:this.getState().data.find(s=>s.id==e)}getRowIndex(e,t){return t||(t=this.getState().flatData),t.findIndex(s=>s.id==e)}getNextRow(e){const t=this.getState().flatData,s=this.getRowIndex(e,t);return t[s+1]}getPrevRow(e){const t=this.getState().flatData,s=this.getRowIndex(e,t);return t[s-1]}getColumn(e){return this.getState().columns.find(t=>t.id==e)}getNextColumn(e,t){const s=this.getState()._columns,r=s.findIndex(o=>o.id==e);return t?this._getFirstVisibleColumn(r+1):s[r+1]}getPrevColumn(e,t){const s=this.getState()._columns,r=s.findIndex(o=>o.id==e);return t?this._getLastVisibleColumn(r-1):s[r-1]}_getFirstVisibleColumn(e){const t=this.getState()._columns;let s=e??0;for(;s<t.length&&(t[s]?.hidden||t[s]?.collapsed);)s++;return t[s]}_getLastVisibleColumn(e){const t=this.getState()._columns;let s=e??t.length-1;for(;s<t.length&&(t[s]?.hidden||t[s]?.collapsed);)s--;return t[s]}isCellEditable(e,t){const{editor:s,hidden:r}=t;return!s||r?!1:typeof s=="function"?s(e,t):!0}getNextEditor(e,t){let s=this.getState().columns;if(t){const r=s.findIndex(o=>o.id==t.id);s=s.slice(r+1)}return s.find(r=>this.isCellEditable(e,r))}getPrevEditor(e,t){let s=this.getState().columns;if(t){const r=s.findLastIndex(o=>o.id==t.id);s=s.slice(0,r)}return s.findLast(r=>this.isCellEditable(e,r))}toggleBranch(e,t,s){let r=this._branches[e],{data:o}=this.getState();if(o=[...o],e!==0){r={...r,open:t};const a=this.updateTreeRow(r);r.$parent===0&&(o=a)}s&&r.data?.length&&r.data.forEach(a=>{const i=this.toggleKids(a,t,s);e===0&&(o=i)}),this.setState({data:o})}toggleKids(e,t,s){e={...e,open:t};const r=this.updateTreeRow(e);return s&&e.data?.length&&e.data.forEach(o=>{this.toggleKids(o,t,s)}),r}updateTreeRow(e){const t=e.id;this._branches[t]=e;const s=this._branches[e.$parent],r=s.data.findIndex(o=>o.id==t);return s.data=[...s.data],s.data[r]=e,s.data}isSelected(e){return this.getState().selectedRows.indexOf(e)!==-1}findAndRemove(e,t){for(let s=0;s<e.length;s++){if(e[s].id==t)return e.splice(s,1)[0];if(e[s].data){const r=[...e[s].data],o=this.findAndRemove(r,t);if(o)return e[s]={...e[s],data:r},o}}return null}insertItem(e,t,s,r){for(let o=0;o<e.length;o++){if(e[o].id==t){const a=e[o],i=r==="before"?o:o+1;if(a.data){if(r==="before"){const l=o>0?e[o-1]:null;return l?.data&&l.open?e[o-1]={...l,data:[...l.data,s]}:e.splice(i,0,s),!0}else if(a.open)return e[o]={...a,data:[s,...a.data]},!0}return e.splice(i,0,s),!0}if(e[o].data&&(e[o]={...e[o],data:[...e[o].data]},this.insertItem(e[o].data,t,s,r)))return!0}return!1}moveItem(e,t,s,r){const o=[...s],a=this.findAndRemove(o,e);return this.insertItem(o,t,a,r),o}copyColumns(e){const t=[];for(let s=0;s<e.length;s++){const r={...e[s]};this.copyHeaderFooter(r,"header"),this.copyHeaderFooter(r,"footer"),t[s]=r}return t}copyHeaderFooter(e,t){let s=e[t];s=Array.isArray(s)?[...s]:[s],s.forEach((r,o)=>{s[o]=typeof r=="string"?{text:r}:{...r}}),e[t]=s}setCollapsibleColumns(e,t,s){let r=e.header;for(let o=0;o<r.length;o++){const a=r[o];if(a.collapsible&&a.collapsed){if(a.collapsible!=="first"){e.collapsed=!0,e.width=36,a.vertical=!0;const l=r.length-o;r=r.slice(0,o+1),r[o].rowspan=l}const i=a.colspan;if(i){const l=r[o+1];let c=1;l&&l.colspan&&!l.collapsed&&(c=l.colspan);for(let u=c;u<i;u++){const f=s[t+u];f&&(f.hidden=!0)}}}}}normalizeColumns(e,t,s,r,o){const a=e[t];a.width||(a.width=a.flexgrow?17:o.columnWidth),a._colindex=t+1;const i=a[s],l=o[`${s}RowHeights`];for(let c=0;c<r;c++){const u=i[c];u.id=a.id,c===i.length-1&&(u.rowspan=u.rowspan?Math.min(u.rowspan,r-c):r-c);for(let f=1;f<u.rowspan;f++){i.splice(c+f,0,{_hidden:!0});for(let h=1;h<u.colspan;h++)e[t+h][s].splice(c+f,0,{})}if(u.rowspan){const f=(u.rowspan===r?l:l.slice(c,u.rowspan+c)).reduce((h,x)=>h+x,0);u.height=f,c+u.rowspan!=r&&u.height--}if(u.colspan){let f=a.width,h=a.flexgrow||0;const x=u.colspan;for(let w=1;w<x;w++){const m=e[t+w];m&&(m.hidden?u.colspan-=1:m.flexgrow?h+=m.flexgrow:f+=m.width||o.columnWidth),h?u.flexgrow=h:u.width=f}}else u.width=a.width,u.flexgrow=a.flexgrow;s==="header"&&u.filter&&typeof u.filter=="string"&&(u.filter={type:u.filter})}i.length>r&&(i.length=r),a[s]=i}normalizeRows(e){for(let t=0;t<e.length;t++)e[t].id||(e[t].id=Kt());return e}normalizeTreeRows(e,t,s){return e.forEach(r=>{r.id||(r.id=Kt()),r.$level=t||0,r.$parent=s||0,this._branches[r.id]=r,r.data&&(r.data.length?(r.$count=r.data.length,this.normalizeTreeRows(r.data,r.$level+1,r.id)):(delete r.data,delete r.$count,delete r.open))}),e}sortTree(e,t){e.sort(t),e.forEach(s=>{s.data&&this.sortTree(s.data,t)})}filterTree(e,t,s){return e.forEach(r=>{t(r)&&s.push(r.id),r.data&&this.filterTree(r.data,t,s)}),s}flattenRows(e,t,s){const r=t;return e.forEach(o=>{(!s||s.includes(o.id))&&r.push(o),o.data?.length&&o.open!==!1&&this.flattenRows(o.data,r,s)}),r}createFilter(e){const{_columns:t}=this.getState(),s=[];for(const r in e){const{config:o,type:a}=t.find(l=>l.id==r).header.find(l=>l.filter).filter,i=e[r];s.push(l=>o?.handler?o.handler(l[r],i):qi(a)(l[r],i))}return r=>{for(let o=0;o<s.length;o++)if(!s[o](r))return!1;return!0}}searchRows(e,t){e=e.trim().toLowerCase();const s={};if(!e)return s;const{flatData:r,columns:o}=this.getState(),a=t?o.filter(i=>t[i.id]):o;return r.forEach(i=>{const l={};a.forEach(c=>{const u=Je(i,c);String(u).toLowerCase().includes(e)&&(l[c.id]=!0)}),Object.keys(l).length&&(s[i.id]=l)}),s}normalizeSizes(e,t,s,r,o){const a=Ds(e,"header",s,t.headerHeight,o),i=Ds(e,"footer",r,t.footerHeight,o),l=a.reduce((u,f)=>u+f,0),c=i.reduce((u,f)=>u+f,0);return{...t,headerRowHeights:a,footerRowHeights:i,headerHeight:l,footerHeight:c}}},Qi=new Date().valueOf();function Kt(){return"temp://"+Qi++}function Ji(n,e="data-id"){let t=n;for(!t.tagName&&n.target&&(t=n.target);t;){if(t.getAttribute&&t.getAttribute(e))return t;t=t.parentNode}return null}new Date().valueOf();var Zi=class{constructor(){this.store=new Map}configure(n,e){this.node=e;for(const t in n)if(n[t]){const s=t.toLowerCase().replace(/[ ]/g,""),r=n[t];this.store.set(s,r)}}},pt=[],el={subscribe:n=>{tl();const e=new Zi;return pt.push(e),n(e),()=>{const t=pt.findIndex(s=>s===e);t>=0&&pt.splice(t,1)}}},Ts=!1;function tl(){Ts||(Ts=!0,document.addEventListener("keydown",n=>{if(pt.length&&(n.ctrlKey||n.altKey||n.metaKey||n.shiftKey||n.key.length>1||n.key===" ")){const e=[];n.ctrlKey&&e.push("ctrl"),n.altKey&&e.push("alt"),n.metaKey&&e.push("meta"),n.shiftKey&&e.push("shift");let t=n.code.replace("Key","").toLocaleLowerCase();n.key===" "&&(t="space"),e.push(t);const s=e.join("+");for(let r=pt.length-1;r>=0;r--){const o=pt[r],a=o.store.get(s)||o.store.get(t);a&&o.node.contains(n.target)&&a(n,{key:s,evKey:t})}}}))}const nl={tab:!0,"shift+tab":!0,arrowup:!0,arrowdown:!0,arrowright:!0,arrowleft:!0,enter:!0,escape:!0,f2:!0,home:!0,end:!0,"ctrl+home":!0,"ctrl+end":!0,"ctrl+z":!0,"ctrl+y":!0};function Bn(n,{keys:e,exec:t}){if(!e)return;function s(a){const i=a.target;return i.tagName==="INPUT"||i.tagName==="TEXTAREA"||Ji(i,"data-header-id")?.classList.contains("wx-filter")||!!i.closest(".wx-cell.wx-editor")}const r={};for(const a in e){const i=e[a];typeof i<"u"&&(typeof i=="function"?r[a]=i:i&&(r[a]=l=>{const c=s(l);t({key:a,event:l,isInput:c})}))}const o=el.subscribe(a=>{a.configure(r,n)});return{destroy:()=>{o()}}}function sl(n,e){let t=null;e.scroll.subscribe(s=>{if(!s||s===t)return;t=s;const{left:r,top:o,height:a,width:i}=s,l=e.getHeight(),c=e.getWidth(),u=e.getScrollMargin();if(o>=0){const f=n.scrollTop;o<f?n.scrollTop=o:o+a>f+l&&(n.scrollTop=o-l+a)}if(r>=0){const f=n.scrollLeft;r<f?n.scrollLeft=r:r+i>f+c-u&&(n.scrollLeft=r-c+i+u)}})}const rl={grid:{"Add before":"Add before","Add after":"Add after",Copy:"Copy",Cut:"Cut",Paste:"Paste",Delete:"Delete","New row":"New row","Move up":"Move up","Move down":"Move down",Undo:"Undo",Redo:"Redo"}};function zr(n,e){return n.map(t=>{const s=e(t);return t.data&&t.data.length&&(s.data=zr(t.data,e)),s})}function Or(n,e){const t=[];return n.forEach(s=>{if(s.data){const r=Or(s.data,e);r.length&&t.push({...s,data:r})}else e(s)&&t.push(s)}),t}let ol=1;function al(n){return zr(n,e=>{const t={...e,id:e.id||ol++};return t.type&&(t.comp=t.type),t})}const il={};function ll(n){return il[n]||n}function cl({onClick:n,onShow:e,option:t}){const s=d.useRef(null),r=d.useCallback(()=>{e(t.data?t.id:!1,s.current)},[e,t]),o=d.useMemo(()=>t&&t.comp?ll(t.comp):null,[t]);return g.jsxs("div",{ref:s,className:`wx-cDCz9rZQ wx-option ${t.css||""} ${t.disabled?"wx-disabled":""}`,"data-id":t.id,onMouseEnter:r,onClick:n,children:[t.icon?g.jsx("i",{className:`wx-cDCz9rZQ wx-icon ${t.icon}`}):null,t.comp?o?g.jsx(o,{item:t,option:t}):null:g.jsxs("span",{className:"wx-cDCz9rZQ wx-value",children:[" ",t.text," "]}),t.subtext?g.jsx("span",{className:"wx-cDCz9rZQ wx-subtext",children:t.subtext}):null,t.data?g.jsx("i",{className:"wx-cDCz9rZQ wx-sub-icon wxi-angle-right"}):null]})}function Vn({options:n,left:e=0,top:t=0,at:s="bottom",parent:r=null,mount:o=null,context:a=null,css:i="",onClick:l}){const[c,u]=d.useState(-1e4),[f,h]=d.useState(-1e4),[x,w]=d.useState(20),[m,y]=d.useState(),p=d.useRef(null),[v,k]=d.useState(!1),[S,N]=d.useState(null),_=d.useCallback(()=>{const T=io(p.current,r,s,e,t);T&&(u(T.x),h(T.y),w(T.z),y(T.width))},[r,s,e,t]);d.useEffect(()=>{o&&o(_)},[]);const C=d.useCallback(()=>{k(!1)},[]),$=d.useCallback(()=>{l&&l({action:null,option:null})},[l]),L=d.useCallback((T,Y)=>{k(T),N(Y)},[]),I=d.useMemo(()=>al(n),[n]);return d.useEffect(()=>{_()},[r,_]),d.useEffect(()=>{if(p.current)return rn(p.current,{callback:$,modal:!0}).destroy},[$]),g.jsx("div",{ref:p,"data-wx-menu":"true",className:`wx-XMmAGqVx wx-menu ${i}`,style:{position:"absolute",top:f+"px",left:c+"px",width:m,zIndex:x},onMouseLeave:C,children:I.map(T=>g.jsxs(d.Fragment,{children:[T.comp==="separator"?g.jsx("div",{className:"wx-XMmAGqVx wx-separator"}):g.jsx(cl,{option:T,onShow:L,onClick:Y=>{if(!T.data&&!Y.defaultPrevented){const K={context:a,action:T,option:T,event:Y};T.handler&&T.handler(K),l&&l(K),Y.stopPropagation()}}}),T.data&&v===T.id?g.jsx(Vn,{css:i,options:T.data,at:"right-overlap",parent:S,context:a,onClick:l}):null]},T.id))})}const ul=d.forwardRef(function(n,e){const{options:t,at:s="bottom",resolver:r=null,dataKey:o="contextId",filter:a=null,css:i="",children:l,onClick:c}=n,[u,f]=d.useState(null),[h,x]=d.useState(null),[w,m]=d.useState(0),[y,p]=d.useState(0),v=d.useMemo(()=>u!==null&&a?Or(t,_=>a(_,u)):t,[u,a,t]),k=d.useCallback(_=>{x(null),c&&c(_)},[c]),S=d.useCallback((_,C)=>{let $=null;for(;_&&_.dataset&&!$;)$=_.dataset[C],_=_.parentNode;return $?vt($):null},[]),N=d.useCallback((_,C)=>{if(!_){x(null);return}if(_.defaultPrevented)return;const $=_.target;if($&&$.dataset&&$.dataset.menuIgnore)return;m(_.clientX+1),p(_.clientY+1);let L=typeof C<"u"?C:S($,o);r&&(L=r(L,_),!L)||(f(L),x($),_.preventDefault())},[o,S,r]);return d.useImperativeHandle(e,()=>({show:N}),[N]),g.jsxs(g.Fragment,{children:[l?g.jsx("span",{onClick:N,"data-menu-ignore":"true",children:typeof l=="function"?l():l}):null,h?g.jsx(Js,{children:g.jsx(Vn,{css:i,at:s,top:y,left:w,parent:h,context:u,onClick:k,options:v},h)}):null]})});d.forwardRef(function(n,e){const{options:t,at:s="bottom",css:r="",children:o,onClick:a}=n,[i,l]=d.useState(null);function c(w){l(null),a&&a(w)}const u=d.useCallback(w=>{l(w.target),w.preventDefault()},[]);d.useImperativeHandle(e,()=>({show:u}),[u]);function f(w){let m=w.target;for(;!m.dataset.menuIgnore;)l(m),m=m.parentNode}const h=d.useRef(0),x=d.useRef(i);return d.useEffect(()=>{x.current!==i&&(h.current+=1,x.current=i)},[i]),g.jsxs(g.Fragment,{children:[g.jsx("span",{onClick:f,"data-menu-ignore":"true",children:o}),i?g.jsx(Js,{children:g.jsx(Vn,{css:r,at:s,parent:i,options:t,onClick:c},h.current)}):null]})});const dl=d.forwardRef(function(n,e){const{options:t,at:s="bottom",resolver:r=null,dataKey:o="contextId",filter:a=null,css:i="",children:l,onClick:c}=n,u=d.useRef(null),f=d.useCallback((h,x)=>{u.current.show(h,x)},[]);return d.useImperativeHandle(e,()=>({show:f}),[f]),g.jsxs(g.Fragment,{children:[l?g.jsx("span",{onContextMenu:f,"data-menu-ignore":"true",children:l}):null,g.jsx(ul,{css:i,at:s,options:t,resolver:r,dataKey:o,filter:a,ref:u,onClick:c})]})}),Fe=d.createContext(null);function fl(n,e){const t=new ResizeObserver(s=>{requestAnimationFrame(()=>e(s[0].contentRect))});return t.observe(n.parentNode),{destroy(){t.disconnect()}}}const Is=5,hl=700;function gl(n){return vt(n.getAttribute("data-id"))}function qt(n){const e=n.getBoundingClientRect(),t=document.body,s=e.top+t.scrollTop-t.clientTop||0,r=e.left+t.scrollLeft-t.clientLeft||0;return{y:Math.round(s),x:Math.round(r),width:n.offsetWidth,height:n.offsetHeight}}function Dn(n,e){const t=qt(e);return{x:n.clientX-t.x,y:n.clientY-t.y}}function xl(n,e){const t=e.current;let s=null,r,o,a=!1,i=!1;const l=document.createElement("DIV");l.className="wx-drag-zone",l.setAttribute("tabindex",-1);function c(){clearTimeout(r),r=null}function u(C){const $=Me(C);$&&(s={container:l,sourceNode:C.target,from:gl($),pos:Dn(C,n)},o=s.pos,f(C))}function f(C){if(!s)return;const $=s.pos=Dn(C,n);if(!a){if(!i&&!C?.target?.getAttribute("draggable-data")&&Math.abs(o.x-$.x)<Is&&Math.abs(o.y-$.y)<Is)return;if(N(C)===!1)return _()}if(i){const L=window.scrollX||document.documentElement.scrollLeft||document.body.scrollLeft,I=window.scrollY||document.documentElement.scrollTop||document.body.scrollTop;s.targetNode=document.elementFromPoint(C.pageX-L,C.pageY-I)}else s.targetNode=C.target;t.move&&t.move(C,s),l.style.left=-(s.offset?s.offset.x:0)+"px",l.style.top=s.pos.y+(s.offset?s.offset.y:0)+"px"}function h(C){l.parentNode&&l.parentNode.removeChild(l),l.innerHTML="",a&&t.end&&t.end(C,s),s=o=null,_()}function x(C){t.getReorder&&!t.getReorder()||C.button===0&&(S(C),window.addEventListener("mousemove",w),window.addEventListener("mouseup",m),u(C))}function w(C){f(C)}function m(C){h(C)}function y(C){if(t.getReorder&&!t.getReorder())return;r=setTimeout(()=>{i=!0,u(C.touches[0])},hl),S(C);function $(){r&&c(),C.target.removeEventListener("touchmove",p),C.target.removeEventListener("touchend",$),h(C)}C.target.addEventListener("touchmove",p),C.target.addEventListener("touchend",$),n.addEventListener("contextmenu",v)}function p(C){a?(C.preventDefault(),f(C.touches[0])):r&&c()}function v(C){if(a||r)return C.preventDefault(),!1}function k(C){C.preventDefault()}function S(C){if(!t.getDraggableInfo)return;const{hasDraggable:$}=t.getDraggableInfo();(!$||C.target.getAttribute("draggable-data"))&&(document.body.style.userSelect="none",document.body.style.webkitUserSelect="none")}function N(C){if(a=!0,t.start){if(t.start(C,s)===!1)return!1;n.appendChild(l),document.body.style.cursor="move"}}function _(C){a=i=!1,document.body.style.cursor="",document.body.style.userSelect="",document.body.style.webkitUserSelect="",window.removeEventListener("mousemove",w),window.removeEventListener("mouseup",m),C&&(n.removeEventListener("mousedown",x),n.removeEventListener("touchstart",y),n.removeEventListener("dragstart",k))}return n.addEventListener("mousedown",x),n.addEventListener("touchstart",y),n.addEventListener("dragstart",k),{destroy(){_(!0)}}}const ml=.004;function pl(){return{dirX:0,dirY:0,scrollSpeedFactor:1}}function wl(n,e,t,s){const{node:r,left:o,top:a,bottom:i,sense:l,xScroll:c,yScroll:u}=s,f=Dn(n,r);t.scrollState||(t.scrollState=pl());let h=0,x=0;f.x<o+l?h=-1:f.x>e.width-l&&(h=1),f.y<a+Math.round(l/2)?x=-1:f.y>e.height-i-Math.round(l/2)&&(x=1),(t.scrollState.dirX!==h||t.scrollState.dirY!==x)&&(Pr(t),t.scrollState.dirX=h,t.scrollState.dirY=x),(c&&t.scrollState.dirX!==0||u&&t.scrollState.dirY!==0)&&yl(t,s,{x:t.scrollState.dirX,y:t.scrollState.dirY})}function yl(n,e,t){n.autoScrollTimer||(n.autoScrollTimer=setTimeout(()=>{n.activeAutoScroll=setInterval(vl,15,n,e,t)},250))}function Pr(n){n.scrollSpeedFactor=1,n.autoScrollTimer&&(n.autoScrollTimer=clearTimeout(n.autoScrollTimer),n.activeAutoScroll=clearInterval(n.activeAutoScroll))}function vl(n,e,t){const{x:s,y:r}=t;n.scrollSpeedFactor+=ml,s!==0&&bl(n,e,s),r!==0&&kl(n,e,r)}function kl(n,e,t){const s=e.node.scrollTop;Wr(s+Math.round(e.sense/3)*n.scrollSpeedFactor*t,"scrollTop",e)}function bl(n,e,t){const s=e.node.scrollLeft;Wr(s+Math.round(e.sense/3)*n.scrollSpeedFactor*t,"scrollLeft",e)}function Wr(n,e,t){t.node[e]=n}function dn(n,e,t,s,r,o){const a={};return n&&(a.width=`${n}px`,a.minWidth=`${n}px`),e&&(a.flexGrow=e),o&&(a.height=`${o}px`),t&&(a.position="sticky",t.left&&(a.left=`${s}px`),t.right&&(a.right=`${r}px`)),a}function Ur(n,e,t){let s="";if(n.fixed)for(const r in n.fixed)s+=n.fixed[r]===-1?"wx-shadow ":"wx-fixed ";return s+=e.rowspan>1?"wx-rowspan ":"",s+=e.colspan>1?"wx-colspan ":"",s+=e.vertical?"wx-vertical ":"",s+=t?t(n)+" ":"",s}function Sl(n){const{row:e,column:t,cellStyle:s=null,columnStyle:r=null,children:o}=n,[a,i]=pe(n.focusable),l=d.useContext(Fe),c=B(l,"focusCell"),u=B(l,"search"),f=B(l,"reorder"),h=d.useMemo(()=>u?.rows[e.id]&&u.rows[e.id][t.id],[u,e.id,t.id]),x=d.useMemo(()=>dn(t.width,t.flexgrow,t.fixed,t.left,t.right),[t.width,t.flexgrow,t.fixed,t.left,t.right]);function w(_,C){let $="wx-cell";return $+=t.fixed?" "+(t.fixed===-1?"wx-shadow":"wx-fixed"):"",$+=_?" "+_(t):"",$+=C?" "+C(e,t):"",$+=t.treetoggle?" wx-tree-cell":"",$}const m=d.useMemo(()=>w(r,s),[r,s,t,e]),y=d.useMemo(()=>typeof t.draggable=="function"?t.draggable(e,t)!==!1:t.draggable,[t,e]),p=d.useRef(null);d.useEffect(()=>{p.current&&a&&c?.row===e.id&&c?.column===t.id&&p.current.focus()},[c,a,e.id,t.id]);const v=d.useCallback(()=>{a&&!c&&l.exec("focus-cell",{row:e.id,column:t.id,eventSource:"focus"})},[l,a,c,e.id,t.id]);d.useEffect(()=>()=>{a&&c&&(l.exec("focus-cell",{eventSource:"destroy"}),i(!1))},[l,i]);function k(_){const C=new RegExp(`(${u.value.trim()})`,"gi");return String(_).split(C).map($=>({text:$,highlight:C.test($)}))}const S=d.useMemo(()=>{const _=t.fixed&&t.fixed.left===-1||t.fixed.right===-1,C=t.fixed&&t.fixed.right;return[m,_?"wx-shadow":"",C?"wx-fixed-right":""].filter(Boolean).join(" ")},[m,t]),N=t.cell;return g.jsxs("div",{className:"wx-TSCaXsGV "+S,ref:p,onFocus:v,style:x,"data-row-id":e.id,"data-col-id":t.id,tabIndex:a?"0":"-1",role:"gridcell","aria-colindex":t._colindex,"aria-readonly":t.editor?void 0:!0,children:[f&&t.draggable?y?g.jsx("i",{"draggable-data":"true",className:"wx-TSCaXsGV wx-draggable wxi-drag"}):g.jsx("i",{className:"wx-TSCaXsGV wx-draggable-stub"}):null,t.treetoggle?g.jsxs(g.Fragment,{children:[g.jsx("span",{style:{marginLeft:`${e.$level*28}px`}}),e.$count?g.jsx("i",{"data-action":"toggle-row",className:`wx-TSCaXsGV wx-table-tree-toggle wxi-menu-${e.open!==!1?"down":"right"}`}):null]}):null,N?g.jsx(N,{api:l,row:e,column:t,onAction:({action:_,data:C})=>l.exec(_,C)}):o?o():h?g.jsx("span",{children:k(Je(e,t)).map(({highlight:_,text:C},$)=>_?g.jsx("mark",{className:"wx-TSCaXsGV wx-search",children:C},$):g.jsx("span",{children:C},$))}):Je(e,t)]})}function Hs(n,e){let t,s;function r(i){t=i.clientX,n.style.opacity=1,document.body.style.cursor="ew-resize",document.body.style.userSelect="none",window.addEventListener("mousemove",o),window.addEventListener("mouseup",a),e&&e.down&&e.down(n)}function o(i){s=i.clientX-t,e&&e.move&&e.move(s)}function a(){n.style.opacity="",document.body.style.cursor="",document.body.style.userSelect="",e&&e.up&&e.up(s),window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",a)}return n.addEventListener("mousedown",r),{destroy(){n.removeEventListener("mousedown",r)}}}function _l({filter:n,column:e,action:t,filterValue:s}){function r({value:o}){t({value:o,key:e.id})}return g.jsx(It,{...n.config??{},value:s,onChange:r})}function Cl({filter:n,column:e,action:t,filterValue:s}){const r=d.useContext(Fe),o=B(r,"flatData"),a=d.useMemo(()=>n?.config?.options||e?.options||l(),[n,e,o]),i=d.useMemo(()=>n?.config?.template,[n]);function l(){const f=[];return o.forEach(h=>{const x=lt(h,e);f.includes(x)||f.push(x)}),f.map(h=>({id:h,label:h}))}function c({value:f}){t({value:f,key:e.id})}function u(f){f.key!=="Tab"&&f.preventDefault()}return g.jsx("div",{style:{width:"100%"},onKeyDown:u,children:g.jsx(Xs,{placeholder:"",clear:!0,...n?.config??{},options:a,value:s,onChange:c,children:f=>i?i(f):f.label})})}const jl={text:_l,richselect:Cl};function $l({filter:n,column:e}){const t=d.useContext(Fe),s=B(t,"filterValues");function r(a){t.exec("filter-rows",a)}const o=d.useMemo(()=>jl[n.type],[n.type]);return g.jsx(o,{filter:n,column:e,action:r,filterValue:s[e.id]})}function Ml(n){const{cell:e,column:t,row:s,lastRow:r,sortRow:o,columnStyle:a,bodyHeight:i,hasSplit:l}=n,c=d.useContext(Fe),u=B(c,"sortMarks"),f=d.useMemo(()=>u?u[t.id]:void 0,[u,t.id]),h=d.useRef(),x=d.useCallback(D=>{h.current=e.flexgrow?D.parentNode.clientWidth:e.width},[e.flexgrow,e.width]),w=d.useCallback((D,A)=>{c.exec("resize-column",{id:e.id,width:Math.max(1,(h.current||0)+D),inProgress:A})},[c,e.id]),m=d.useCallback(D=>w(D,!0),[w]),y=d.useCallback(D=>w(D,!1),[w]),p=d.useCallback(D=>{if(!t.sort||e.filter)return;let A=f?.order;A&&(A=A==="asc"?"desc":"asc"),c.exec("sort-rows",{key:e.id,add:D.ctrlKey,order:A})},[c,e.id,e.filter,t.sort,f?.order]),v=d.useCallback(D=>{D&&D.stopPropagation(),c.exec("collapse-column",{id:e.id,row:s})},[c,e.id,s]),k=d.useCallback(D=>{D.key==="Enter"&&v()},[v]),S=d.useCallback(D=>{D.key==="Enter"&&!e.filter&&p(D)},[p,e.filter]),N=d.useMemo(()=>e.collapsed&&t.collapsed,[e.collapsed,t.collapsed]),_=d.useMemo(()=>N&&!l&&e.collapsible!=="header",[N,l,e.collapsible]),C=d.useMemo(()=>_?{top:-i/2,position:"absolute"}:{},[_,i]),$=d.useMemo(()=>dn(e.width,e.flexgrow,t.fixed,t.left,e.right??t.right,e.height+(N&&_?i:0)),[e.width,e.flexgrow,t.fixed,t.left,e.right,t.right,e.height,N,_,i]),L=d.useMemo(()=>Ur(t,e,a),[t,e,a]),I=d.useCallback(()=>Object.fromEntries(Object.entries(e).filter(([D])=>D!=="cell")),[e]),T=`wx-cell ${L} ${e.css||""} wx-collapsed`,Y=["wx-cell",L,e.css||"",e.filter?"wx-filter":"",t.fixed&&t.fixed.right?"wx-fixed-right":""].filter(Boolean).join(" "),K=d.useRef(null);return d.useEffect(()=>{const D=K.current;if(!D)return;const A=Hs(D,{down:x,move:m,up:y});return()=>{typeof A=="function"&&A()}},[x,m,y,Hs]),N?g.jsx("div",{className:"wx-RsQD74qC "+T,style:$,role:"button","aria-label":`Expand column ${e.text||""}`,"aria-expanded":!e.collapsed,tabIndex:0,onKeyDown:k,onClick:v,"data-header-id":t.id,children:g.jsx("div",{className:"wx-RsQD74qC wx-text",style:C,children:e.text||""})}):g.jsxs("div",{className:"wx-RsQD74qC "+Y,style:$,onClick:p,"data-header-id":t.id,tabIndex:!e._hidden&&t.sort&&!e.filter?0:void 0,role:"columnheader","aria-colindex":e._colindex,"aria-colspan":e.colspan>1?e.colspan:void 0,"aria-rowspan":e.rowspan>1?e.rowspan:void 0,"aria-sort":!f?.order||e.filter?"none":f?.order==="asc"?"ascending":"descending",onKeyDown:S,children:[e.collapsible?g.jsx("div",{className:"wx-RsQD74qC wx-collapse",role:"button","aria-label":e.collapsed?"Expand column":"Collapse column","aria-expanded":!e.collapsed,tabIndex:0,onKeyDown:k,onClick:v,children:g.jsx("i",{className:`wx-RsQD74qC wxi-angle-${e.collapsed?"down":"right"}`})}):null,e.cell?(()=>{const D=e.cell;return g.jsx(D,{api:c,cell:I(),column:t,row:s,onAction:({action:A,data:E})=>c.exec(A,E)})})():e.filter?g.jsx($l,{filter:e.filter,column:t}):g.jsx("div",{className:"wx-RsQD74qC wx-text",children:e.text||""}),t.resize&&r&&!e._hidden?g.jsx("div",{className:"wx-RsQD74qC wx-grip",role:"presentation","aria-label":"Resize column",ref:K,onClick:D=>D.stopPropagation(),children:g.jsx("div",{})}):null,o?g.jsx("div",{className:"wx-RsQD74qC wx-sort",children:f?g.jsxs(g.Fragment,{children:[typeof f.index<"u"?g.jsx("div",{className:"wx-RsQD74qC wx-order",children:f.index+1}):null,g.jsx("i",{className:`wx-RsQD74qC wxi-arrow-${f.order==="asc"?"up":"down"}`})]}):null}):null]})}function Nl({cell:n,column:e,row:t,columnStyle:s}){const r=d.useContext(Fe),o=d.useMemo(()=>dn(n?.width,n?.flexgrow,e?.fixed,e?.left,n?.right??e?.right,n?.height),[n?.width,n?.flexgrow,e?.fixed,e?.left,n?.right,e?.right,n?.height]),a=d.useMemo(()=>Ur(e,n,s),[e,n,s]),i=d.useCallback(()=>Object.fromEntries(Object.entries(n||{}).filter(([c])=>c!=="cell")),[n]),l=`wx-6Sdi3Dfd wx-cell ${a||""} ${n?.css||""}`+(e?.fixed&&e?.fixed.right?" wx-fixed-right":"");return g.jsx("div",{className:l,style:o,children:!e?.collapsed&&!n?.collapsed?n?.cell?Xr.createElement(n.cell,{api:r,cell:i(),column:e,row:t,onAction:({action:c,data:u})=>r.exec(c,u)}):g.jsx("div",{className:"wx-6Sdi3Dfd wx-text",children:n?.text||""}):null})}function As({deltaLeft:n,contentWidth:e,columns:t,type:s="header",columnStyle:r,bodyHeight:o}){const a=d.useContext(Fe),i=B(a,"_sizes"),l=B(a,"split"),c=d.useMemo(()=>i?.[`${s}RowHeights`],[i,s]),u=d.useMemo(()=>{let m=[];if(t&&t.length){const y=t[0][s].length;for(let p=0;p<y;p++){let v=0;m.push([]),t.forEach((k,S)=>{const N={...k[s][p]};if(v||m[p].push(N),N.colspan>1){if(v=N.colspan-1,!Lr()&&k.right){let _=k.right;for(let C=1;C<N.colspan;C++)_-=t[S+C].width;N.right=_}}else v&&v--})}}return m},[t,s]),f=d.useMemo(()=>l?.left||l?.right,[l]);function h(m){return t.find(y=>y.id===m)}function x(m,y){let p=y;return m.rowspan&&(p+=m.rowspan-1),p===u.length-1}function w(m,y,p){if(!p.sort)return!1;for(let v=u.length-1;v>=0;v--){const k=p.header[v];if(!k.filter&&!k._hidden)return y===v}return x(m,y)}return g.jsx("div",{className:`wx-sAsPVaUK wx-${s}`,style:{paddingLeft:`${n}px`,width:`${e}px`},role:"rowgroup",children:u.map((m,y)=>g.jsx("div",{className:s==="header"?"wx-sAsPVaUK wx-h-row":"wx-sAsPVaUK wx-f-row",style:{height:`${c?.[y]}px`,display:"flex"},role:"row",children:m.map(p=>{const v=h(p.id);return s==="header"?g.jsx(Ml,{cell:p,columnStyle:r,column:v,row:y,lastRow:x(p,y),bodyHeight:o,sortRow:w(p,y,v),hasSplit:f},p.id):g.jsx(Nl,{cell:p,columnStyle:r,column:h(p.id),row:y},p.id)})},y))})}function El({overlay:n}){const e=d.useContext(Fe);function t(r){return typeof r=="function"}const s=n;return g.jsx("div",{className:"wx-1ty666CQ wx-overlay",children:t(n)?g.jsx(s,{onAction:({action:r,data:o})=>e.exec(r,o)}):n})}function Rl(n){const{actions:e,editor:t}=n,[s,r]=d.useState(t?.value||""),o=d.useRef(null);d.useEffect(()=>{o.current&&o.current.focus()},[]);function a(){o.current&&(r(o.current.value),e.updateValue(o.current.value))}function i({key:l}){l==="Enter"&&e.save()}return g.jsx("input",{className:"wx-e7Ao5ejY wx-text",onInput:a,onKeyDown:i,ref:o,type:"text",value:s})}function Dl({actions:n,editor:e,onAction:t}){const[s,r]=d.useState(e?.value),[o,a]=d.useState(e?.renderedValue),[i,l]=d.useState(e?.options||[]),c=d.useMemo(()=>e?.config?.template,[e]),u=d.useMemo(()=>e?.config?.cell,[e]),f=d.useMemo(()=>(i||[]).findIndex(v=>v.id===s),[i,s]),h=d.useRef(null),x=d.useRef(null),w=d.useCallback(v=>{h.current=v.navigate,x.current=v.keydown,h.current(f)},[f,h]),m=d.useCallback(v=>{const k=v?.target?.value??"";a(k);const S=k?(e?.options||[]).filter(N=>(N.label||"").toLowerCase().includes(k.toLowerCase())):e?.options||[];l(S),S.length?h.current(-1/0):h.current(null)},[e]),y=d.useRef(null);d.useEffect(()=>{y.current&&y.current.focus()},[]),d.useEffect(()=>{r(e?.value),a(e?.renderedValue),l(e?.options||[])},[e]);const p=d.useCallback(({id:v})=>{n.updateValue(v),n.save()},[n]);return g.jsxs(g.Fragment,{children:[g.jsx("input",{className:"wx-0UYfSd1x wx-input",ref:y,value:o??"",onChange:m,onKeyDown:v=>x.current?x.current(v,f):void 0}),g.jsx(cn,{items:i,onReady:w,onSelect:p,children:({option:v})=>c?c(v):u?g.jsx(u,{data:v,onAction:t}):v.label})]})}function Tl({actions:n,editor:e,onAction:t}){const[s]=d.useState(()=>e.value||new Date),[r]=d.useState(()=>e.config?.template),[o]=d.useState(()=>e.config?.cell);function a({value:l}){n.updateValue(l),n.save()}const i=d.useRef(null);return d.useEffect(()=>{i.current&&i.current.focus(),typeof window<"u"&&window.getSelection&&window.getSelection().removeAllRanges()},[]),g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"wx-lNWNYUb6 wx-value",ref:i,tabIndex:0,onClick:()=>n.cancel(),onKeyDown:l=>l.preventDefault(),children:r?r(s):o?g.jsx(o,{data:e.value,onAction:t}):g.jsx("span",{className:"wx-lNWNYUb6 wx-text",children:e.renderedValue})}),g.jsx(ln,{width:"auto",children:g.jsx(qs,{value:s,onChange:a,buttons:e.config?.buttons})})]})}function Il(n){const{actions:e,editor:t}=n,s=n.onAction??n.onaction,r=t.config||{},[o]=d.useState(t.options.find(m=>m.id===t.value)),[a]=d.useState(t.value),[i]=d.useState(t.options),l=d.useMemo(()=>i.findIndex(m=>m.id===a),[i,a]);function c({id:m}){e.updateValue(m),e.save()}let u;const[f,h]=d.useState();function x(m){u=m.navigate,h(()=>m.keydown),u(l)}const w=d.useRef(null);return d.useEffect(()=>{w.current&&w.current.focus(),typeof window<"u"&&window.getSelection&&window.getSelection().removeAllRanges()},[]),g.jsxs(g.Fragment,{children:[g.jsx("div",{ref:w,className:"wx-ywGRk611 wx-value",tabIndex:0,onClick:()=>e.cancel(),onKeyDown:m=>{f(m,l),m.preventDefault()},children:r.template?r.template(o):r.cell?(()=>{const m=r.cell;return g.jsx(m,{data:o,onAction:s})})():g.jsx("span",{className:"wx-ywGRk611 wx-text",children:t.renderedValue})}),g.jsx(cn,{items:i,onReady:x,onSelect:c,children:({option:m})=>r.template?r.template(m):r.cell?(()=>{const y=r.cell;return g.jsx(y,{data:m,onAction:s})})():m.label})]})}const Hl={text:Rl,combo:Dl,datepicker:Tl,richselect:Il};function Al({column:n,row:e}){const t=d.useContext(Fe),s=B(t,"editor"),r=d.useCallback((w,m)=>{t.exec("close-editor",{ignore:w}),m&&t.exec("focus-cell",{...m,eventSource:"click"})},[t]),o=d.useCallback(w=>{const m=w?null:{row:s?.id,column:s?.column};r(!1,m)},[s,r]),a=d.useCallback(()=>{r(!0,{row:s?.id,column:s?.column})},[s,r]),i=d.useCallback(w=>{t.exec("editor",{value:w})},[t]),l=d.useCallback(w=>{w.key==="Enter"&&s&&a()},[s,a]),c=d.useMemo(()=>dn(n.width,n.flexgrow,n.fixed,n.left,n.right),[n.width,n.flexgrow,n.fixed,n.left,n.right]),u=d.useMemo(()=>{let w=n.editor;typeof w=="function"&&(w=w(e,n));let m=typeof w=="string"?w:w.type;return Hl[m]},[n,e]),f=d.useRef(null);d.useEffect(()=>{if(!f.current)return;const w=rn(f.current,()=>o(!0));return()=>{typeof w=="function"&&w()}},[o]),d.useEffect(()=>{f.current&&typeof c=="string"&&f.current.setAttribute("style",c)},[c]);const h=typeof e.$parent<"u"?"gridcell":"cell",x=typeof e.$parent<"u"?!n.editor:void 0;return g.jsx("div",{className:"wx-8l724t2g wx-cell wx-editor",ref:f,style:typeof c=="object"&&c!==null?c:void 0,role:h,"aria-readonly":x,tabIndex:-1,onClick:w=>w.stopPropagation(),onDoubleClick:w=>w.stopPropagation(),onKeyDown:l,children:u?g.jsx(u,{editor:s,actions:{save:o,cancel:a,updateValue:i},onAction:({action:w,data:m})=>t.exec(w,m)}):null})}function Ls(n){const{columns:e,type:t,columnStyle:s}=n,r=d.useContext(Fe),{filterValues:o,_columns:a,_sizes:i}=r.getState();function l(c){return s?" "+s(c):""}return g.jsx(g.Fragment,{children:e.map((c,u)=>g.jsx("tr",{children:c.map(f=>{const h=a.find(m=>m.id==f.id),x=`wx-print-cell-${t}${l(h)}${f.filter?" wx-print-cell-filter":""}${f.vertical?" wx-vertical":""}`,w=f.cell;return g.jsx("th",{style:Bs(Ar(f,i.columnWidth)),className:"wx-Gy81xq2u "+x,rowSpan:f.rowspan,colSpan:f.colspan,children:w?g.jsx(w,{api:r,cell:Object.fromEntries(Object.entries(f).filter(([m])=>m!=="cell")),column:h,row:u}):f.filter?g.jsx("div",{className:"wx-Gy81xq2u wx-print-filter",children:Ai(o,a,f)}):g.jsx("div",{className:"wx-Gy81xq2u wx-text",children:f.text??""})},f.id)})},u))})}function Ll(n){const{columns:e,rowStyle:t,columnStyle:s,cellStyle:r,header:o,footer:a,reorder:i}=n,l=d.useContext(Fe),{flatData:c,_sizes:u}=l.getState(),f=o&&Es(e,"header",u.headerRowHeights),h=a&&Es(e,"footer",u.footerRowHeights);function x(m,y){let p="";return p+=s?" "+s(y):"",p+=r?" "+r(m,y):"",p}function w(m,y){return typeof y.draggable=="function"?y.draggable(m,y)!==!1:y.draggable}return g.jsxs("table",{className:`wx-8NTMLH0z wx-print-grid ${e.some(m=>m.flexgrow)?"wx-flex-columns":""}`,children:[o?g.jsx("thead",{children:g.jsx(Ls,{columns:f,type:"header",columnStyle:s})}):null,g.jsx("tbody",{children:c.map((m,y)=>g.jsx("tr",{className:"wx-8NTMLH0z wx-row"+(t?" "+t(m):""),style:{height:`${m.rowHeight||u.rowHeight}px`},children:e.map(p=>p.collapsed?null:g.jsxs("td",{className:`wx-8NTMLH0z wx-print-cell wx-cell ${x(m,p)}`,style:Bs(Ar(p,u.columnWidth)),children:[i&&p.draggable?g.jsx("span",{className:"wx-8NTMLH0z wx-print-draggable",children:w(m,p)?g.jsx("i",{className:"wx-8NTMLH0z wxi-drag"}):null}):null,p.treetoggle?g.jsxs(g.Fragment,{children:[g.jsx("span",{style:{marginLeft:m.$level*28+"px"}}),m.$count?g.jsx("i",{className:`wx-8NTMLH0z wx-print-grid-tree-toggle wxi-menu-${m.open!==!1?"down":"right"}`}):null]}):null,p.cell?(()=>{const v=p.cell;return g.jsx(v,{api:l,row:m,column:p})})():g.jsx("span",{children:Je(m,p)})]},p.id))},y))}),a?g.jsx("tfoot",{children:g.jsx(Ls,{columns:h,type:"footer",columnStyle:s})}):null]})}function Fl(n){const{config:e,...t}=n,s=d.useContext(Fe),{_skin:r,_columns:o}=s.getState(),a=d.useMemo(()=>Di(o,e),[]),i=d.useRef(null);return d.useEffect(()=>{const l=document.body;l.classList.add("wx-print");const c=i.current;if(!c)return;const u=c.cloneNode(!0);l.appendChild(u);const f=`@media print { @page { size: ${e.paper} ${e.mode}; }`,h=document.createElement("style");h.setAttribute("type","text/css"),h.setAttribute("media","print"),document.getElementsByTagName("head")[0].appendChild(h),h.appendChild(document.createTextNode(f)),window.print(),h.remove(),l.classList.remove("wx-print"),u.remove()},[]),g.jsx("div",{className:`wx-4zwCKA7C wx-${r}-theme wx-print-container`,ref:i,children:a.map((l,c)=>g.jsx("div",{className:"wx-4zwCKA7C wx-print-grid-wrapper",children:g.jsx(Ll,{columns:l,...t})},c))})}function zl(n){const{header:e,footer:t,overlay:s,multiselect:r,onreorder:o,rowStyle:a,columnStyle:i,cellStyle:l,autoRowHeight:c,resize:u,clientWidth:f,clientHeight:h,responsiveLevel:x,hotkeys:w}=n,m=d.useContext(Fe),y=B(m,"dynamic"),p=B(m,"_columns"),v=B(m,"flatData"),k=B(m,"split"),S=B(m,"_sizes"),[N,_]=Qt(m,"selectedRows"),C=B(m,"select"),$=B(m,"editor"),L=B(m,"tree"),I=B(m,"focusCell"),T=B(m,"_print"),Y=B(m,"undo"),K=B(m,"reorder"),D=B(m,"_rowHeightFromData"),[A,E]=d.useState(0);d.useEffect(()=>{E(ut())},[]);const[U,F]=d.useState(0),[P,q]=d.useState(0),R=d.useMemo(()=>(p||[]).some(j=>!j.hidden&&j.flexgrow),[p]),Z=d.useMemo(()=>S?.rowHeight||0,[S]),oe=d.useRef(null),[fe,ce]=d.useState(null),[X,te]=d.useState(null),J=d.useMemo(()=>{let j=[],z=0;return k&&k.left&&(j=(p||[]).slice(0,k.left).filter(Q=>!Q.hidden).map(Q=>({...Q})),j.forEach(Q=>{Q.fixed={left:1},Q.left=z,z+=Q.width}),j.length&&(j[j.length-1].fixed={left:-1})),{columns:j,width:z}},[k,p]),ae=d.useMemo(()=>{let j=[],z=0;if(k&&k.right){j=(p||[]).slice(k.right*-1).filter(Q=>!Q.hidden).map(Q=>({...Q}));for(let Q=j.length-1;Q>=0;Q--){const ue=j[Q];ue.fixed={right:1},ue.right=z,z+=ue.width}j.length&&(j[0].fixed={right:-1})}return{columns:j,width:z}},[k,p]),se=d.useMemo(()=>{const j=(p||[]).slice(k?.left||0,(p||[]).length-(k?.right??0)).filter(z=>!z.hidden);return j.forEach(z=>{z.fixed=0}),j},[p,k]),ie=d.useMemo(()=>(p||[]).reduce((j,z)=>(z.hidden||(j+=z.width),j),0),[p]),He=1;function _e(j,z,Q){let ue=z,ye=j;if(se.length){let de=se.length;for(let ee=j;ee>=0;ee--)se[ee][Q].forEach(ve=>{ve.colspan>1&&ee>j-ve.colspan&&ee<de&&(de=ee)});if(de!==se.length&&de<j){for(let ee=de;ee<j;ee++)ue-=se[ee].width;ye=de}}return{index:ye,delta:ue}}const ge=d.useMemo(()=>{let j,z,Q;const ue=U,ye=U+(f||0);let de=0,ee=0,ve=0,ze=0;se.forEach((st,ht)=>{ue>ve&&(de=ht,ze=ve),ve=ve+st.width,ye>ve&&(ee=ht+He)});const We={header:0,footer:0};for(let st=ee;st>=de;st--)["header","footer"].forEach(ht=>{se[st]&&se[st][ht].forEach(Gr=>{const gn=Gr.colspan;if(gn&&gn>1){const Qn=gn-(ee-st+1);Qn>0&&(We[ht]=Math.max(We[ht],Qn))}})});const ke=_e(de,ze,"header"),Ue=_e(de,ze,"footer"),St=ke.delta,Ft=ke.index,zt=Ue.delta,hn=Ue.index;return R&&ie>(f||0)?j=z=Q=[...J.columns,...se,...ae.columns]:(j=[...J.columns,...se.slice(de,ee+1),...ae.columns],z=[...J.columns,...se.slice(Ft,ee+We.header+1),...ae.columns],Q=[...J.columns,...se.slice(hn,ee+We.footer+1),...ae.columns]),{data:j||[],header:z||[],footer:Q||[],d:ze,df:zt,dh:St}},[se,J,ae,U,f,R,ie]),le=d.useMemo(()=>e&&S?.headerHeight||0,[e,S]),he=d.useMemo(()=>t&&S?.footerHeight||0,[t,S]),we=d.useMemo(()=>f&&h?ie>=f:!1,[f,h,ie]),xe=d.useMemo(()=>(h||0)-le-he-(we?A:0),[h,le,he,we,A]),qe=d.useMemo(()=>Math.ceil((xe||0)/(Z||1))+1,[xe,Z]),Xe=d.useRef([]),[et,ct]=d.useState(0),[Re,tt]=d.useState(void 0),Ce=d.useMemo(()=>{let j=0,z=0;const Q=2;if(c){let de=P;for(;de>0;)de-=Xe.current[j]||Z,j++;z=P-de;for(let ee=Math.max(0,j-Q-1);ee<j;ee++)z-=Xe.current[j-ee]||Z;j=Math.max(0,j-Q)}else{if(D){let de=0,ee=0;for(let ke=0;ke<(v||[]).length;ke++){const Ue=v[ke].rowHeight||Z;if(ee+Ue>P){de=ke;break}ee+=Ue}j=Math.max(0,de-Q);for(let ke=0;ke<j;ke++)z+=v[ke].rowHeight||Z;let ve=0,ze=0;for(let ke=de+1;ke<(v||[]).length;ke++){const Ue=v[ke].rowHeight||Z;if(ve++,ze+Ue>xe)break;ze+=Ue}const We=Math.min(y?y.rowCount:(v||[]).length,de+ve+Q);return{d:z,start:j,end:We}}j=Math.floor(P/(Z||1)),j=Math.max(0,j-Q),z=j*(Z||0)}const ue=y?y.rowCount:(v||[]).length,ye=Math.min(ue,j+(qe||0)+Q);return{d:z,start:j,end:ye}},[c,D,P,Z,y,v,qe,xe]),M=d.useMemo(()=>{const j=y?y.rowCount:(v||[]).length;if(c)return et+Ce.d+(j-(Re||0))*(Z||0);if(!D)return j*(Z||0);let z=0;for(let Q=0;Q<j;Q++)z+=v[Q]?.rowHeight||Z;return z},[y,v,Z,c,D,et,Ce.d,Re]),W=d.useMemo(()=>f&&h?M+le+he>=h-(ie>=(f||0)?A:0):!1,[f,h,M,le,he,ie,A]),V=d.useMemo(()=>R&&ie<=(f||0)?(f||0)-0-(W?A:0):ie,[R,ie,f,W,A,we]),b=d.useMemo(()=>R&&ie<=(f||0)?f||0:V<(f||0)?ie+(W?A:0):-1,[R,ie,f,V,W,A]),H=d.useRef({});d.useEffect(()=>{if(y&&(H.current.start!==Ce.start||H.current.end!==Ce.end)){const{start:j,end:z}=Ce;H.current={start:j,end:z},m&&m.exec&&m.exec("request-data",{row:{start:j,end:z}})}},[y,Ce,m]);const O=d.useMemo(()=>y?v||[]:(v||[]).slice(Ce.start,Ce.end),[y,v,Ce]),G=d.useMemo(()=>(N||[]).filter(j=>(O||[]).some(z=>z.id===j)),[_,O]),ne=d.useMemo(()=>Ce.start,[Ce.start]),me=d.useCallback(j=>{q(j.target.scrollTop),F(j.target.scrollLeft)},[]),Se=d.useCallback(j=>{j.shiftKey&&j.preventDefault(),oe.current&&oe.current.focus&&oe.current.focus()},[]),je=d.useCallback(()=>!!(p||[]).find(j=>!!j.draggable),[p]),Ne=d.useRef(null),Le=d.useRef(null),Ve=d.useRef({dblclick:(j,z)=>{const Q={id:j,column:kn(z,"data-col-id")};m.exec("open-editor",Q)},click:(j,z)=>{if(Ne.current)return;const Q=kn(z,"data-col-id");if(I?.id!==j&&m.exec("focus-cell",{row:j,column:Q,eventSource:"click"}),C===!1)return;const ue=r&&z.ctrlKey,ye=r&&z.shiftKey;(ue||N.length>1||!N.includes(j))&&m.exec("select-row",{id:j,toggle:ue,range:ye})},"toggle-row":j=>{const z=m.getRow(j);m.exec(z.open!==!1?"close-row":"open-row",{id:j})},"ignore-click":()=>!1}),nt=d.useMemo(()=>({top:le,bottom:he,left:J.width,xScroll:we,yScroll:W,sense:c&&X?X.offsetHeight:Math.max(S?.rowHeight||0,40),node:oe.current&&oe.current.firstElementChild}),[le,he,J.width,we,W,c,X,S]);function Ae(j,z){const{container:Q,sourceNode:ue,from:ye}=z;if(je()&&!ue.getAttribute("draggable-data"))return!1;ce(ye),m.getRow(ye).open&&m.exec("close-row",{id:ye,nested:!0});const de=Me(ue,"data-id"),ee=de.cloneNode(!0);ee.classList.remove("wx-selected"),ee.querySelectorAll("[tabindex]").forEach(ke=>ke.setAttribute("tabindex","-1")),Q.appendChild(ee),te(ee);const ve=U-ge.d,ze=W?A:0;Q.style.width=Math.min((f||0)-ze,R&&ie<=(f||0)?V:V-ze)+ve+"px";const We=qt(de);z.offset={x:ve,y:-Math.round(We.height/2)},Le.current||(Le.current=j.clientY)}function At(j,z){const{from:Q}=z,ue=z.pos,ye=qt(oe.current);ue.x=ye.x;const de=nt.top;if(ue.y<de)ue.y=de;else{const ee=ye.height-(we&&A>0?A:Math.round(nt.sense/2))-nt.bottom;ue.y>ee&&(ue.y=ee)}if(oe.current.contains(z.targetNode)){const ee=Me(z.targetNode,"data-id"),ve=vt(ee?.getAttribute("data-id"));if(ve&&ve!==Q){z.to=ve;const ze=c?X?.offsetHeight:S?.rowHeight;if(X&&(P===0||ue.y>de+ze-1)){const We=ee.getBoundingClientRect(),ke=qt(X).y,Ue=We.y,St=ke>Ue?-1:1,Ft=St===1?"after":"before",zt=Math.abs(m.getRowIndex(Q)-m.getRowIndex(ve)),hn=zt!==1?Ft==="before"?"after":"before":Ft;if(zt===1&&(St===-1&&j.clientY>Le.current||St===1&&j.clientY<Le.current))return;Le.current=j.clientY,m.exec("move-item",{id:Q,target:ve,mode:hn,inProgress:!0})}}o&&o({event:j,context:z})}wl(j,ye,z,nt)}function bt(j,z){const{from:Q,to:ue}=z;m.exec("move-item",{id:Q,target:ue,inProgress:!1}),Ne.current=setTimeout(()=>{Ne.current=0},1),ce(null),te(null),Le.current=null,Pr(z)}function ut(){const j=document.createElement("div");j.style.cssText="position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;min-height:100px;overflow-y:scroll;",document.body.appendChild(j);const z=j.offsetWidth-j.clientWidth;return document.body.removeChild(j),z}const dt=d.useMemo(()=>b>0?{width:`${b}px`}:void 0,[b]),Gn=d.useRef(null);function Br(){Promise.resolve().then(()=>{let j=0,z=ne;const Q=Gn.current;Q&&(Array.from(Q.children).forEach((ue,ye)=>{Xe.current[ne+ye]=ue.offsetHeight,j+=ue.offsetHeight,z++}),ct(j),tt(z))})}d.useEffect(()=>{O&&c&&Br()},[O,c,ne]);let[ft,fn]=d.useState();d.useEffect(()=>{if(I&&(!C||!G.length||G.includes(I.row)))fn({...I});else if(O.length&&ge.data.length){if(!ft||G.length&&!G.includes(ft.row)||O.findIndex(j=>j.id==ft.row)===-1||ge.data.findIndex(j=>j.id==ft.column&&!j.collapsed)===-1){const j=G[0]||O[0].id,z=ge.data.findIndex(Q=>!Q.collapsed);fn(z!==-1?{row:j,column:ge.data[z].id}:null)}}else fn(null)},[I]);const Kn=d.useRef(null);d.useEffect(()=>{const j=oe.current;if(!j)return;const z=fl(j,u);return()=>{typeof z=="function"&&z()}},[u]);const qn=d.useRef({});Object.assign(qn.current,{start:Ae,move:At,end:bt,getReorder:()=>K,getDraggableInfo:()=>({hasDraggable:je()})}),d.useEffect(()=>{const j=oe.current;return j?xl(j,qn).destroy:void 0},[K,oe.current]),d.useEffect(()=>{const j=oe.current;return j?Bn(j,{keys:w!==!1&&{...nl,"ctrl+z":Y,"ctrl+y":Y,...w},exec:z=>m.exec("hotkey",z)}).destroy:void 0},[m,Y,w]);const Lt=d.useRef({scroll:m.getReactiveState().scroll});Lt.current.getWidth=()=>(f||0)-(W?A:0),Lt.current.getHeight=()=>xe,Lt.current.getScrollMargin=()=>J.width+ae.width,d.useEffect(()=>{sl(Kn.current,Lt.current)},[]);const Xn=d.useRef(null);d.useEffect(()=>{const j=Xn.current;if(!j)return;const z=[];return z.push(rn(j,()=>m.exec("focus-cell",{eventSource:"click"})).destroy),z.push(xo(j,Ve.current)),()=>z.forEach(Q=>Q())},[]);const Vr=`wx-grid ${x?`wx-responsive-${x}`:""}`;return g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"wx-4VuBwK2D "+Vr,style:{"--header-height":`${le}px`,"--footer-height":`${he}px`,"--split-left-width":`${J.width}px`,"--split-right-width":`${ae.width}px`},children:g.jsx("div",{ref:oe,className:"wx-4VuBwK2D wx-table-box",style:dt,role:L?"treegrid":"grid","aria-colcount":ge.data.length,"aria-rowcount":O.length,"aria-multiselectable":L&&r?!0:void 0,tabIndex:-1,children:g.jsxs("div",{ref:Kn,className:"wx-4VuBwK2D wx-scroll",style:{overflowX:we?"scroll":"hidden",overflowY:W?"scroll":"hidden"},onScroll:me,children:[e?g.jsx("div",{className:"wx-4VuBwK2D wx-header-wrapper",children:g.jsx(As,{contentWidth:V,deltaLeft:ge.dh,columns:ge.header,columnStyle:i,bodyHeight:xe-+t})}):null,g.jsxs("div",{ref:Xn,className:"wx-4VuBwK2D wx-body",style:{width:`${V}px`,height:`${M}px`},onMouseDown:j=>Se(j),children:[s?g.jsx(El,{overlay:s}):null,g.jsx("div",{ref:Gn,className:"wx-4VuBwK2D wx-data",style:{paddingTop:`${Ce.d}px`,paddingLeft:`${ge.d}px`},children:O.map((j,z)=>{const Q=N.indexOf(j.id)!==-1,ue=fe===j.id,ye="wx-row"+(c?" wx-autoheight":"")+(a?" "+a(j):"")+(Q?" wx-selected":"")+(ue?" wx-inactive":""),de=c?{minHeight:`${j.rowHeight||Z}px`}:{height:`${j.rowHeight||Z}px`};return g.jsx("div",{className:"wx-4VuBwK2D "+ye,"data-id":j.id,"data-context-id":j.id,style:de,role:"row","aria-rowindex":z,"aria-expanded":j.open,"aria-level":L?j.$level+1:void 0,"aria-selected":L?Q:void 0,tabIndex:-1,children:ge.data.map(ee=>ee.collapsed?g.jsx("div",{className:"wx-4VuBwK2D wx-cell wx-collapsed"},ee.id):$?.id===j.id&&$.column==ee.id?g.jsx(Al,{row:j,column:ee},ee.id):g.jsx(Sl,{row:j,column:ee,columnStyle:i,cellStyle:l,reorder:K,focusable:ft?.row===j.id&&ft?.column==ee.id},ee.id))},j.id)})})]}),t&&(v||[]).length?g.jsx(As,{type:"footer",contentWidth:V,deltaLeft:ge.df,columns:ge.footer,columnStyle:i}):null]})})}),T?g.jsx(Fl,{config:T,rowStyle:a,columnStyle:i,cellStyle:l,header:e,footer:t,reorder:K}):null]})}const Ol=n=>n.split("-").map(e=>e?e.charAt(0).toUpperCase()+e.slice(1):"").join(""),Pl=d.forwardRef(function({data:n=[],columns:e=[],rowStyle:t=null,columnStyle:s=null,cellStyle:r=null,selectedRows:o,select:a=!0,multiselect:i=!1,header:l=!0,footer:c=!1,dynamic:u=null,overlay:f=null,reorder:h=!1,onReorder:x=null,autoRowHeight:w=!1,sizes:m,split:y,tree:p=!1,autoConfig:v=!1,init:k=null,responsive:S=null,sortMarks:N,undo:_=!1,hotkeys:C=null,...$},L){const I=d.useRef();I.current=$;const T=d.useMemo(()=>new Xi(Vs),[]),Y=d.useMemo(()=>T.in,[T]),K=d.useRef(null);K.current===null&&(K.current=new tr((J,ae)=>{const se="on"+Ol(J);I.current&&I.current[se]&&I.current[se](ae)}),Y.setNext(K.current));const D=d.useMemo(()=>({getState:T.getState.bind(T),getReactiveState:T.getReactive.bind(T),getStores:()=>({data:T}),exec:Y.exec,setNext:J=>(K.current=K.current.setNext(J),K.current),intercept:Y.intercept.bind(Y),on:Y.on.bind(Y),detach:Y.detach.bind(Y),getRow:T.getRow.bind(T),getRowIndex:T.getRowIndex.bind(T),getColumn:T.getColumn.bind(T)}),[T,Y]),[A,E]=d.useState(0),[U,F]=d.useState(0),[P,q]=d.useState(null),[R,Z]=d.useState(null),oe=d.useMemo(()=>{if(v&&!e.length&&n.length){const J=n[0],ae=[];for(let se in J)if(se!=="id"&&se[0]!=="$"){let ie={id:se,header:se[0].toUpperCase()+se.slice(1)};typeof v=="object"&&(ie={...ie,...v}),ae.push(ie)}return ae}return(R&&R.columns)??e},[v,e,n,R]),fe=d.useMemo(()=>(R&&R.sizes)??m,[R,m]),ce=d.useCallback(J=>{if(E(J.width),F(J.height),S){const ae=Object.keys(S).map(Number).sort((se,ie)=>se-ie).find(se=>J.width<=se)??null;ae!==P&&(Z(S[ae]),q(ae))}},[S,P]),X=d.useContext(Be.theme),te=d.useRef(0);return d.useEffect(()=>{if(!te.current)k&&k(D);else{const J=T.getState();T.init({data:n,columns:oe,split:y||J.split,sizes:fe||J.sizes,selectedRows:o||J.selectedRows,dynamic:u,tree:p,sortMarks:N||J.sortMarks,undo:_,reorder:h,_skin:X,_select:a})}te.current++},[T,n,oe,y,fe,o,u,p,N,_,h,X,a,k,D]),te.current===0&&T.init({data:n,columns:oe,split:y||{left:0},sizes:fe||{},selectedRows:o||[],dynamic:u,tree:p,sortMarks:N||{},undo:_,reorder:h,_skin:X,select:a}),d.useImperativeHandle(L,()=>({...D}),[D]),g.jsx(Fe.Provider,{value:D,children:g.jsx(Ks,{words:rl,optional:!0,children:g.jsx(zl,{header:l,footer:c,overlay:f,rowStyle:t,columnStyle:s,cellStyle:r,onReorder:x,multiselect:i,autoRowHeight:w,clientWidth:A,clientHeight:U,responsiveLevel:P,resize:ce,hotkeys:C})})})});In(Ie);const Wl={};function Pe(n,e){Wl[n]=e}function Ul({value:n,options:e,label:t}){const s=d.useContext(Be.i18n).getGroup("editor"),r=d.useMemo(()=>{let o=n;if(typeof n=="boolean"&&(o=s(n?"Yes":"No")),e){const a=e.find(i=>i.id===n);a&&(o=a.label)}return o},[n,e,s]);return r||r===0?g.jsx(Jt,{label:t,children:r}):null}function Yl({fieldKey:n,label:e,activeSection:t,onClick:s}){return g.jsxs("div",{className:`wx-OmgQq65I wx-section${t?" wx-section-active":""}`,onClick:()=>s&&s({item:{id:"toggle-section",key:t?null:n}}),children:[g.jsx("h3",{children:e}),g.jsx("i",{className:`wx-OmgQq65I wxi-angle-${t?"down":"right"} wx-icon`})]})}Pe("text",It);Pe("textarea",ko);Pe("checkbox",bo);Pe("readonly",Ul);Pe("section",Yl);In(Ie);const Ze=d.createContext(null);function wt(n){const e=n.getAttribute("data-id"),t=parseInt(e);return isNaN(t)||t.toString()!=e?e:t}function Bl(n,e,t){const s=n.getBoundingClientRect(),r=e.querySelector(".wx-body").getBoundingClientRect();return{top:s.top-r.top,left:s.left-r.left,dt:s.bottom-t.clientY,db:t.clientY-s.top}}function Fs(n){return n&&n.getAttribute("data-context-id")}const zs=5;function Vl(n,e){let t,s,r,o,a,i,l,c,u;function f(_){o=_.clientX,a=_.clientY,i={...Bl(t,n,_),y:e.getTask(r).$y},document.body.style.userSelect="none"}function h(_){t=Me(_),Fs(t)&&(r=wt(t),u=setTimeout(()=>{c=!0,e&&e.touchStart&&e.touchStart(),f(_.touches[0])},500),n.addEventListener("touchmove",v),n.addEventListener("contextmenu",x),window.addEventListener("touchend",k))}function x(_){if(c||u)return _.preventDefault(),!1}function w(_){_.which===1&&(t=Me(_),Fs(t)&&(r=wt(t),n.addEventListener("mousemove",p),window.addEventListener("mouseup",S),f(_)))}function m(_){n.removeEventListener("mousemove",p),n.removeEventListener("touchmove",v),document.body.removeEventListener("mouseup",S),document.body.removeEventListener("touchend",k),document.body.style.userSelect="",_&&(n.removeEventListener("mousedown",w),n.removeEventListener("touchstart",h))}function y(_){const C=_.clientX-o,$=_.clientY-a;if(!s){if(Math.abs(C)<zs&&Math.abs($)<zs||e&&e.start&&e.start({id:r,e:_})===!1)return;s=t.cloneNode(!0),s.style.pointerEvents="none",s.classList.add("wx-reorder-task"),s.style.position="absolute",s.style.left=i.left+"px",s.style.top=i.top+"px",t.style.visibility="hidden",t.parentNode.insertBefore(s,t)}if(s){const L=Math.round(Math.max(0,i.top+$));if(e&&e.move&&e.move({id:r,top:L,detail:l})===!1)return;const I=e.getTask(r),T=I.$y;if(!i.start&&i.y==T)return N();i.start=!0,i.y=I.$y-4,s.style.top=L+"px";const Y=document.elementFromPoint(_.clientX,_.clientY),K=Me(Y);if(K&&K!==t){const D=wt(K),A=K.getBoundingClientRect(),E=A.top+A.height/2,U=_.clientY+i.db>E&&K.nextElementSibling!==t,F=_.clientY-i.dt<E&&K.previousElementSibling!==t;l?.after==D||l?.before==D?l=null:U?l={id:r,after:D}:F&&(l={id:r,before:D})}}}function p(_){y(_)}function v(_){c?(_.preventDefault(),y(_.touches[0])):u&&(clearTimeout(u),u=null)}function k(){c=null,u&&(clearTimeout(u),u=null),N()}function S(){N()}function N(){t&&(t.style.visibility=""),s&&(s.parentNode.removeChild(s),e&&e.end&&e.end({id:r,top:i.top})),r=t=s=i=l=null,m()}return n.style.position!=="absolute"&&(n.style.position="relative"),n.addEventListener("mousedown",w),n.addEventListener("touchstart",h),{destroy(){m(!0)}}}function Gl({row:n,column:e}){function t(r,o){return{justifyContent:o.align,paddingLeft:`${(r.$level-1)*20}px`}}const s=e&&e._cell;return g.jsxs("div",{className:"wx-pqc08MHU wx-content",style:t(n,e),children:[n.data||n.lazy?g.jsx("i",{className:`wx-pqc08MHU wx-toggle-icon wxi-menu-${n.open?"down":"right"}`,"data-action":"open-task"}):g.jsx("i",{className:"wx-pqc08MHU wx-toggle-placeholder"}),g.jsx("div",{className:"wx-pqc08MHU wx-text",children:s?g.jsx(s,{row:n,column:e}):n.text})]})}function Os({column:n,cell:e}){const t=d.useMemo(()=>n.id,[n?.id]);return e||n.id=="add-task"?g.jsx("div",{style:{textAlign:n.align},children:g.jsx("i",{className:"wx-9DAESAHW wx-action-icon wxi-plus","data-action":t})}):null}function Kl(n){const{readonly:e,compactMode:t,width:s=0,display:r="all",columnWidth:o=0,onTableAPIChange:a}=n,[i,l]=pe(o),[c,u]=d.useState(),f=d.useContext(Be.i18n),h=d.useMemo(()=>f.getGroup("gantt"),[f]),x=d.useContext(Ze),w=B(x,"scrollTop"),m=B(x,"cellHeight"),y=B(x,"_scrollTask"),p=B(x,"_selected"),v=B(x,"area"),k=B(x,"_tasks"),S=B(x,"_scales"),N=B(x,"columns"),_=B(x,"_sort"),C=B(x,"calendar"),$=B(x,"durationUnit"),L=B(x,"splitTasks"),[I,T]=d.useState(null),Y=d.useMemo(()=>!k||!v?[]:k.slice(v.start,v.end),[k,v]),K=d.useCallback((M,W)=>{if(W==="add-task")x.exec(W,{target:M,task:{text:h("New Task")},mode:"child",show:!0});else if(W==="open-task"){const V=Y.find(b=>b.id===M);(V?.data||V?.lazy)&&x.exec(W,{id:M,mode:!V.open})}},[Y]),D=d.useCallback(M=>{const W=ot(M),V=M.target.dataset.action;V&&M.preventDefault(),W?V==="add-task"||V==="open-task"?K(W,V):x.exec("select-task",{id:W,toggle:M.ctrlKey||M.metaKey,range:M.shiftKey,show:!0}):V==="add-task"&&K(null,V)},[x,K]),A=d.useRef(null),E=d.useRef(null),[U,F]=d.useState(0),[P,q]=d.useState(!1);d.useEffect(()=>{const M=E.current;if(!M||typeof ResizeObserver>"u")return;const W=()=>F(M.clientWidth);W();const V=new ResizeObserver(W);return V.observe(M),()=>V.disconnect()},[]);const R=d.useRef(null),Z=d.useCallback(M=>{const W=M.id,{before:V,after:b}=M,H=M.onMove;let O=V||b,G=V?"before":"after";if(H){if(G==="after"){const ne=x.getTask(O);ne.data?.length&&ne.open&&(G="before",O=ne.data[0].id)}R.current={id:W,[G]:O}}else R.current=null;x.exec("move-task",{id:W,mode:G,target:O,inProgress:H})},[x]),oe=d.useMemo(()=>v?.from??0,[v]),fe=d.useMemo(()=>S?.height??0,[S]),ce=d.useMemo(()=>!t&&r!=="grid"?(i??0)>(s??0):(i??0)>(U??0),[t,r,i,s,U]),X=d.useMemo(()=>{const M={};return ce&&r==="all"||r==="grid"&&ce?M.width=i:r==="grid"&&(M.width="100%"),M},[ce,r,i]),te=d.useMemo(()=>I&&!Y.find(M=>M.id===I.id)?[...Y,I]:Y,[Y,I]),J=d.useMemo(()=>{let M=(N||[]).map(b=>{b={...b};const H=b.header;if(typeof H=="object"){const O=H.text&&h(H.text);b.header={...H,text:O}}else b.header=h(H);return b});const W=M.findIndex(b=>b.id==="text"),V=M.findIndex(b=>b.id==="add-task");if(W!==-1&&(M[W].cell&&(M[W]._cell=M[W].cell),M[W].cell=Gl),V!==-1){M[V].cell=M[V].cell||Os;const b=M[V].header;if(typeof b!="object"&&(M[V].header={text:b}),M[V].header.cell=b.cell||Os,e)M.splice(V,1);else if(t){const[H]=M.splice(V,1);M.unshift(H)}}return M.length>0&&(M[M.length-1].resize=!1),M},[N,h,e,t]),ae=d.useMemo(()=>r==="all"?`${s}px`:r==="grid"?"calc(100% - 4px)":J.find(M=>M.id==="add-task")?"50px":"0",[r,s,J]),se=d.useMemo(()=>{if(te&&_?.length){const M={};return _.forEach(({key:W,order:V},b)=>{M[W]={order:V,..._.length>1&&{index:b}}}),M}return{}},[te,_]),ie=d.useCallback(()=>J.some(M=>M.flexgrow&&!M.hidden),[]),He=d.useMemo(()=>ie(),[ie,P]),_e=d.useMemo(()=>{let M=r==="chart"?J.filter(V=>V.id==="add-task"):J;const W=r==="all"?s:U;if(!He){let V=i,b=!1;if(J.some(H=>H.$width)){let H=0;V=J.reduce((O,G)=>(G.hidden||(H+=G.width,O+=G.$width||G.width),O),0),H>V&&V>W&&(b=!0)}if(b||V<W){let H=1;return b||(H=(W-50)/(V-50||1)),M.map(O=>(O.id!=="add-task"&&!O.hidden&&(O.$width||(O.$width=O.width),O.width=O.$width*H),O))}}return M},[r,J,He,i,s,U]),ge=d.useCallback(M=>{if(!ie()){const W=_e.reduce((V,b)=>(M&&b.$width&&(b.$width=b.width),V+(b.hidden?0:b.width)),0);W!==i&&l(W)}q(!0),q(!1)},[ie,_e,i,l]),le=d.useCallback(()=>{J.filter(M=>M.flexgrow&&!M.hidden).length===1&&J.forEach(M=>{M.$width&&!M.flexgrow&&!M.hidden&&(M.width=M.$width)})},[]),he=d.useCallback(M=>{if(!e){const W=ot(M),V=kn(M,"data-col-id");!(V&&J.find(b=>b.id==V))?.editor&&W&&x.exec("show-editor",{id:W})}},[x,e]),we=d.useMemo(()=>Array.isArray(p)?p.map(M=>M.id):[],[p]),xe=d.useCallback(()=>{if(A.current&&te!==null){const M=A.current.querySelector(".wx-body");M&&(M.style.top=-((w??0)-(oe??0))+"px")}E.current&&(E.current.scrollTop=0)},[te,w,oe]);d.useEffect(()=>{A.current&&xe()},[w,oe,xe]),d.useEffect(()=>{const M=A.current;if(!M)return;const W=M.querySelector(".wx-table-box .wx-body");if(!W||typeof ResizeObserver>"u")return;const V=new ResizeObserver(()=>{xe()});return V.observe(W),()=>{V.disconnect()}},[_e,X,r,ae,te,xe]),d.useEffect(()=>{if(!y||!c)return;const{id:M}=y,W=c.getState().focusCell;W&&W.row!==M&&A.current&&A.current.contains(document.activeElement)&&c.exec("focus-cell",{row:M,column:W.column})},[y,c]);const qe=d.useCallback(({id:M})=>{if(e)return!1;x.getTask(M).open&&x.exec("open-task",{id:M,mode:!1});const W=x.getState()._tasks.find(V=>V.id===M);if(T(W||null),!W)return!1},[x,e]),Xe=d.useCallback(({id:M,top:W})=>{R.current?Z({...R.current,onMove:!1}):x.exec("drag-task",{id:M,top:W+(oe??0),inProgress:!1}),T(null)},[x,Z,oe]),et=d.useCallback(({id:M,top:W,detail:V})=>{V&&Z({...V,onMove:!0}),x.exec("drag-task",{id:M,top:W+(oe??0),inProgress:!0})},[x,Z,oe]);d.useEffect(()=>{const M=A.current;return M?Vl(M,{start:qe,end:Xe,move:et,getTask:x.getTask}).destroy:void 0},[x,qe,Xe,et]);const ct=d.useCallback(M=>{const{key:W,isInput:V}=M;if(!V&&(W==="arrowup"||W==="arrowdown"))return M.eventSource="grid",x.exec("hotkey",M),!1;if(W==="enter"){const b=c?.getState().focusCell;if(b){const{row:H,column:O}=b;O==="add-task"?K(H,"add-task"):O==="text"&&K(H,"open-task")}}},[x,K,c]),Re=d.useRef(null),tt=()=>{Re.current={setTableAPI:u,handleHotkey:ct,sortVal:_,api:x,adjustColumns:le,setColumnWidth:ge,tasks:Y,calendarVal:C,durationUnitVal:$,splitTasksVal:L,onTableAPIChange:a}};tt(),d.useEffect(()=>{tt()},[u,ct,_,x,le,ge,Y,C,$,L,a]);const Ce=d.useCallback(M=>{u(M),M.intercept("hotkey",W=>Re.current.handleHotkey(W)),M.intercept("scroll",()=>!1),M.intercept("select-row",()=>!1),M.intercept("sort-rows",W=>{const V=Re.current.sortVal,{key:b,add:H}=W,O=V?V.find(ne=>ne.key===b):null;let G="asc";return O&&(G=!O||O.order==="asc"?"desc":"asc"),x.exec("sort-tasks",{key:b,order:G,add:H}),!1}),M.on("resize-column",()=>{Re.current.setColumnWidth(!0)}),M.on("hide-column",W=>{W.mode||Re.current.adjustColumns(),Re.current.setColumnWidth()}),M.intercept("update-cell",W=>{const{id:V,column:b,value:H}=W,O=Re.current.tasks.find(G=>G.id===V);if(O){const G={...O};let ne=H;ne&&!isNaN(ne)&&!(ne instanceof Date)&&(ne*=1),G[b]=ne,ai(G,{calendar:Re.current.calendarVal,durationUnit:Re.current.durationUnitVal,splitTasks:Re.current.splitTasksVal},b),x.exec("update-task",{id:V,task:G})}return!1}),a&&a(M)},[]);return g.jsx("div",{className:"wx-rHj6070p wx-table-container",style:{flex:`0 0 ${ae}`},ref:E,children:g.jsx("div",{ref:A,style:X,className:"wx-rHj6070p wx-table",onClick:D,onDoubleClick:he,children:g.jsx(Pl,{init:Ce,sizes:{rowHeight:m,headerHeight:(fe??0)-1},rowStyle:M=>M.$reorder?"wx-rHj6070p wx-reorder-task":"wx-rHj6070p",columnStyle:M=>`wx-rHj6070p wx-text-${M.align}${M.id==="add-task"?" wx-action":""}`,data:te,columns:_e,selectedRows:[...we],sortMarks:se})})})}function ql({borders:n=""}){const e=d.useContext(Ze),t=B(e,"cellWidth"),s=B(e,"cellHeight"),r=d.useRef(null),[o,a]=d.useState("#e4e4e4");d.useEffect(()=>{if(typeof getComputedStyle<"u"&&r.current){const l=getComputedStyle(r.current).getPropertyValue("--wx-gantt-border");a(l?l.substring(l.indexOf("#")):"#1d1e261a")}},[]);const i={width:"100%",height:"100%",background:t!=null&&s!=null?`url(${li(t,s,o,n)})`:void 0,position:"absolute"};return g.jsx("div",{ref:r,style:i})}function Xl({onSelectLink:n,selectedLink:e,readonly:t}){const s=d.useContext(Ze),r=B(s,"_links"),o=B(s,"criticalPath"),a=d.useRef(null),i=d.useCallback(l=>{const c=l?.target?.classList;!c?.contains("wx-line")&&!c?.contains("wx-delete-button")&&n(null)},[n]);return d.useEffect(()=>{if(!t&&e&&a.current){const l=c=>{a.current&&!a.current.contains(c.target)&&i(c)};return document.addEventListener("click",l),()=>{document.removeEventListener("click",l)}}},[t,e,i]),g.jsxs("svg",{className:"wx-dkx3NwEn wx-links",children:[(r||[]).map(l=>{const c="wx-dkx3NwEn wx-line"+(o&&l.$critical?" wx-critical":"")+(t?"":" wx-line-selectable");return g.jsx("polyline",{className:c,points:l.$p,onClick:()=>!t&&n(l.id),"data-link-id":l.id},l.id)}),!t&&e&&g.jsx("polyline",{ref:a,className:"wx-dkx3NwEn wx-line wx-line-selected wx-line-selectable wx-delete-link",points:e.$p})]})}function Ql(n){const{task:e,type:t}=n;function s(o){const a=e.segments[o];return{left:`${a.$x}px`,top:"0px",width:`${a.$w}px`,height:"100%"}}function r(o){if(!e.progress)return 0;const a=e.duration*e.progress/100,i=e.segments;let l=0,c=0,u=null;do{const f=i[c];c===o&&(l>a?u=0:u=Math.min((a-l)/f.duration,1)*100),l+=f.duration,c++}while(u===null&&c<i.length);return u||0}return g.jsx("div",{className:"wx-segments wx-GKbcLEGA",children:e.segments.map((o,a)=>g.jsxs("div",{className:`wx-segment wx-bar wx-${t} wx-GKbcLEGA`,"data-segment":a,style:s(a),children:[e.progress?g.jsx("div",{className:"wx-progress-wrapper",children:g.jsx("div",{className:"wx-progress-percent wx-GKbcLEGA",style:{width:`${r(a)}%`}})}):null,g.jsx("div",{className:"wx-content",children:o.text||""})]},a))})}function Jl(n){const{readonly:e,taskTemplate:t}=n,s=d.useContext(Ze),[r,o]=Qt(s,"_tasks"),[a,i]=Qt(s,"_links"),l=B(s,"area"),c=B(s,"_scales"),u=B(s,"taskTypes"),f=B(s,"baselines"),h=B(s,"_selected"),x=B(s,"_scrollTask"),w=B(s,"criticalPath"),m=B(s,"tasks"),y=B(s,"schedule"),p=B(s,"splitTasks"),v=B(s,"summary"),k=d.useMemo(()=>{if(!l||!Array.isArray(r))return[];const b=l.start??0,H=l.end??0;return r.slice(b,H).map(O=>({...O}))},[o,l]),S=d.useMemo(()=>c.lengthUnitWidth,[c]),N=d.useRef(!1),[_,C]=d.useState(void 0),[$,L]=d.useState(null),I=d.useRef(null),[T,Y]=d.useState(null),K=d.useMemo(()=>T&&{...a.find(b=>b.id===T)},[T,i]),[D,A]=d.useState(void 0),E=d.useRef(null),[U,F]=d.useState(0),P=d.useRef(null),q=d.useMemo(()=>{const b=P.current;return!!(h.length&&b&&b.contains(document.activeElement))},[h,P.current]),R=d.useMemo(()=>q&&h[h.length-1]?.id,[q,h]);d.useEffect(()=>{if(x&&q&&x){const{id:b}=x,H=P.current?.querySelector(`.wx-bar[data-id='${b}']`);H&&H.focus({preventScroll:!0})}},[x]),d.useEffect(()=>{const b=P.current;if(b&&(F(b.offsetWidth||0),typeof ResizeObserver<"u")){const H=new ResizeObserver(O=>{O[0]&&F(O[0].contentRect.width)});return H.observe(b),()=>H.disconnect()}},[P.current]);const Z=d.useCallback(()=>{document.body.style.userSelect="none"},[]),oe=d.useCallback(()=>{document.body.style.userSelect=""},[]),fe=d.useCallback((b,H,O)=>{if(H.target.classList.contains("wx-line")||(O||(O=s.getTask(wt(b))),O.type==="milestone"||O.type==="summary"))return"";const G=Me(H,"data-segment");G&&(b=G);const{left:ne,width:me}=b.getBoundingClientRect(),Se=(H.clientX-ne)/me;let je=.2/(me>200?me/200:1);return Se<je?"start":Se>1-je?"end":""},[s]),ce=d.useCallback((b,H)=>{const{clientX:O}=H,G=wt(b),ne=s.getTask(G),me=H.target.classList;if(!H.target.closest(".wx-delete-button")&&!e){if(me.contains("wx-progress-marker")){const{progress:Se}=s.getTask(G);I.current={id:G,x:O,progress:Se,dx:0,node:b,marker:H.target},H.target.classList.add("wx-progress-in-drag")}else{const Se=fe(b,H,ne)||"move",je={id:G,mode:Se,x:O,dx:0,l:ne.$x,w:ne.$w};if(p&&ne.segments?.length){const Ne=Me(H,"data-segment");Ne&&(je.segmentIndex=Ne.dataset.segment*1,void 0)}L(je)}Z()}},[s,e,fe,Z,p]),X=d.useCallback(b=>{if(b.button!==0)return;const H=Me(b);H&&ce(H,b)},[ce]),te=d.useCallback(b=>{const H=Me(b);H&&(E.current=setTimeout(()=>{A(!0),ce(H,b.touches[0])},300))},[ce]),J=d.useCallback(b=>{Y(b)},[]),ae=d.useCallback(()=>{if(I.current){const{dx:b,id:H,marker:O,value:G}=I.current;I.current=null,typeof G<"u"&&b&&s.exec("update-task",{id:H,task:{progress:G},inProgress:!1}),O.classList.remove("wx-progress-in-drag"),N.current=!0,oe()}else if($){const{id:b,mode:H,dx:O,l:G,w:ne,start:me,segment:Se,index:je}=$;if(L(null),me){const Ne=Math.round(O/S);if(!Ne)s.exec("drag-task",{id:b,width:ne,left:G,inProgress:!1,...Se&&{segmentIndex:je}});else{let Le={},Ve=s.getTask(b);Se&&(Ve=Ve.segments[je]),H==="move"?(Le.start=Ve.start,Le.end=Ve.end):Le[H]=Ve[H],s.exec("update-task",{id:b,diff:Ne,task:Le,...Se&&{segmentIndex:je}})}N.current=!0}oe()}},[s,oe,$,S]),se=d.useCallback((b,H)=>{const{clientX:O}=H;if(!e)if(I.current){const{node:G,x:ne,id:me}=I.current,Se=I.current.dx=O-ne,je=Math.round(Se/G.offsetWidth*100);let Ne=I.current.progress+je;I.current.value=Ne=Math.min(Math.max(0,Ne),100),s.exec("update-task",{id:me,task:{progress:Ne},inProgress:!0})}else if($){J(null);const{mode:G,l:ne,w:me,x:Se,id:je,start:Ne,segment:Le,index:Ve}=$,nt=s.getTask(je),Ae=O-Se,At=Math.round(S)||1;if(!Ne&&Math.abs(Ae)<20||G==="start"&&me-Ae<At||G==="end"&&me+Ae<At||G==="move"&&(Ae<0&&ne+Ae<0||Ae>0&&ne+me+Ae>U)||$.segment)return;const bt={...$,dx:Ae};let ut,dt;if(G==="start"?(ut=ne+Ae,dt=me-Ae):G==="end"?(ut=ne,dt=me+Ae):G==="move"&&(ut=ne+Ae,dt=me),s.exec("drag-task",{id:je,width:dt,left:ut,inProgress:!0,start:Ne,...Le&&{segmentIndex:Ve}}),!bt.start&&(G==="move"&&nt.$x==ne||G!=="move"&&nt.$w==me)){N.current=!0,ae();return}bt.start=!0,L(bt)}else{const G=Me(b);if(G){const ne=s.getTask(wt(G)),me=Me(b,"data-segment")||G,Se=fe(me,H,ne);me.style.cursor=Se&&!e?"col-resize":"pointer"}}},[s,e,$,S,U,fe,J,ae]),ie=d.useCallback(b=>{se(b,b)},[se]),He=d.useCallback(b=>{D?(b.preventDefault(),se(b,b.touches[0])):E.current&&(clearTimeout(E.current),E.current=null)},[D,se]),_e=d.useCallback(()=>{ae()},[ae]),ge=d.useCallback(()=>{A(null),E.current&&(clearTimeout(E.current),E.current=null),ae()},[ae]);d.useEffect(()=>(window.addEventListener("mouseup",_e),()=>{window.removeEventListener("mouseup",_e)}),[_e]);const le=d.useCallback(b=>{if(!e){const H=ot(b.target);if(H&&!b.target.classList.contains("wx-link")){const O=ot(b.target,"data-segment");s.exec("show-editor",{id:H,...O!==null&&{segmentIndex:O}})}}},[s,e]),he=["e2s","s2s","e2e","s2e"],we=d.useCallback((b,H)=>he[(b?1:0)+(H?0:2)],[]),xe=d.useCallback((b,H)=>{const O=_.id,G=_.start;return b===O?!0:!!a.find(ne=>ne.target==b&&ne.source==O&&ne.type===we(G,H))},[_,i,we]),qe=d.useCallback(()=>{_&&C(null)},[_]),Xe=d.useCallback(b=>{if(N.current){N.current=!1;return}const H=ot(b.target);if(H){const O=b.target.classList;if(O.contains("wx-link")){const G=O.contains("wx-left");if(!_){C({id:H,start:G});return}_.id!==H&&!xe(H,G)&&s.exec("add-link",{link:{source:_.id,target:H,type:we(_.start,G)}})}else if(O.contains("wx-delete-button-icon"))s.exec("delete-link",{id:T}),Y(null);else{let G;const ne=Me(b,"data-segment");ne&&(G=ne.dataset.segment*1),s.exec("select-task",{id:H,toggle:b.ctrlKey||b.metaKey,range:b.shiftKey,segmentIndex:G})}}qe()},[s,_,i,K,xe,we,qe]),et=d.useCallback(b=>({left:`${b.$x}px`,top:`${b.$y}px`,width:`${b.$w}px`,height:`${b.$h}px`}),[]),ct=d.useCallback(b=>({left:`${b.$x_base}px`,top:`${b.$y_base}px`,width:`${b.$w_base}px`,height:`${b.$h_base}px`}),[]),Re=d.useCallback(b=>{if(D||E.current)return b.preventDefault(),!1},[D]),tt=d.useMemo(()=>u.map(b=>b.id),[u]),Ce=d.useCallback(b=>{let H=tt.includes(b)?b:"task";return["task","milestone","summary"].includes(b)||(H=`task ${H}`),H},[tt]),M=d.useCallback(b=>{s.exec(b.action,b.data)},[s]),W=d.useCallback(b=>w&&m.byId(b).$critical,[w,m]),V=d.useCallback(b=>{if(y?.auto){const H=m.getSummaryId(b,!0),O=m.getSummaryId(_.id,!0);return _?.id&&!(Array.isArray(H)?H:[H]).includes(_.id)&&!(Array.isArray(O)?O:[O]).includes(b)}return _},[y,m,_]);return g.jsxs("div",{className:"wx-GKbcLEGA wx-bars",style:{lineHeight:`${k.length?k[0].$h:0}px`},ref:P,onContextMenu:Re,onMouseDown:X,onMouseMove:ie,onTouchStart:te,onTouchMove:He,onTouchEnd:ge,onClick:Xe,onDoubleClick:le,onDragStart:b=>(b.preventDefault(),!1),children:[g.jsx(Xl,{onSelectLink:J,selectedLink:K,readonly:e}),k.map(b=>{if(b.$skip&&b.$skip_baseline)return null;const H=`wx-bar wx-${Ce(b.type)}`+(D&&$&&b.id===$.id?" wx-touch":"")+(_&&_.id===b.id?" wx-selected":"")+(W(b.id)?" wx-critical":"")+(b.$reorder?" wx-reorder-task":"")+(p&&b.segments?" wx-split":""),O="wx-link wx-left"+(_?" wx-visible":"")+(!_||!xe(b.id,!0)&&V(b.id)?" wx-target":"")+(_&&_.id===b.id&&_.start?" wx-selected":"")+(W(b.id)?" wx-critical":""),G="wx-link wx-right"+(_?" wx-visible":"")+(!_||!xe(b.id,!1)&&V(b.id)?" wx-target":"")+(_&&_.id===b.id&&!_.start?" wx-selected":"")+(W(b.id)?" wx-critical":"");return g.jsxs(d.Fragment,{children:[!b.$skip&&g.jsxs("div",{className:"wx-GKbcLEGA "+H,style:et(b),"data-tooltip-id":b.id,"data-id":b.id,tabIndex:R===b.id?0:-1,children:[e?null:b.id===K?.target&&K?.type[2]==="s"?g.jsx(xt,{type:"danger",css:"wx-left wx-delete-button wx-delete-link",children:g.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):g.jsx("div",{className:"wx-GKbcLEGA "+O,children:g.jsx("div",{className:"wx-GKbcLEGA wx-inner"})}),b.type!=="milestone"?g.jsxs(g.Fragment,{children:[b.progress&&!(p&&b.segments)?g.jsx("div",{className:"wx-GKbcLEGA wx-progress-wrapper",children:g.jsx("div",{className:"wx-GKbcLEGA wx-progress-percent",style:{width:`${b.progress}%`}})}):null,!e&&!(p&&b.segments)&&!(b.type=="summary"&&v?.autoProgress)?g.jsx("div",{className:"wx-GKbcLEGA wx-progress-marker",style:{left:`calc(${b.progress}% - 10px)`},children:b.progress}):null,t?g.jsx(t,{data:b,api:s,onAction:M}):p&&b.segments?g.jsx(Ql,{task:b,type:Ce(b.type)}):g.jsx("div",{className:"wx-GKbcLEGA wx-content",children:b.text||""})]}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"wx-GKbcLEGA wx-content"}),t?g.jsx(t,{data:b,api:s,onAction:M}):g.jsx("div",{className:"wx-GKbcLEGA wx-text-out",children:b.text})]}),e?null:b.id===K?.target&&K?.type[2]==="e"?g.jsx(xt,{type:"danger",css:"wx-right wx-delete-button wx-delete-link",children:g.jsx("i",{className:"wxi-close wx-delete-button-icon"})}):g.jsx("div",{className:"wx-GKbcLEGA "+G,children:g.jsx("div",{className:"wx-GKbcLEGA wx-inner"})})]}),f&&!b.$skip_baseline?g.jsx("div",{className:"wx-GKbcLEGA wx-baseline"+(b.type==="milestone"?" wx-milestone":""),style:ct(b)}):null]},b.id)})]})}function Zl(n){const{highlightTime:e}=n,t=d.useContext(Ze),s=B(t,"_scales");return g.jsx("div",{className:"wx-ZkvhDKir wx-scale",style:{width:s.width},children:(s?.rows||[]).map((r,o)=>g.jsx("div",{className:"wx-ZkvhDKir wx-row",style:{height:`${r.height}px`},children:(r.cells||[]).map((a,i)=>{const l=e?e(a.date,a.unit):"",c="wx-cell "+(a.css||"")+" "+(l||"");return g.jsx("div",{className:"wx-ZkvhDKir "+c,style:{width:`${a.width}px`},children:a.value},i)})},o))})}const ec=new Map;function tc(n){const e=d.useRef(null),t=d.useRef(0),s=d.useRef(null),r=typeof window<"u"&&window.__RENDER_METRICS_ENABLED__;e.current===null&&(e.current=performance.now()),t.current++,d.useEffect(()=>{if(r)return cancelAnimationFrame(s.current),s.current=requestAnimationFrame(()=>{const o={label:n,time:performance.now()-e.current,renders:t.current,timestamp:Date.now()};ec.set(n,o),window.dispatchEvent(new CustomEvent("render-metric",{detail:o}))}),()=>cancelAnimationFrame(s.current)})}function nc(n){const{readonly:e,fullWidth:t,fullHeight:s,taskTemplate:r,cellBorders:o,highlightTime:a}=n,i=d.useContext(Ze),[l,c]=Qt(i,"_selected"),u=B(i,"scrollTop"),f=B(i,"cellHeight"),h=B(i,"cellWidth"),x=B(i,"_scales"),w=B(i,"_markers"),m=B(i,"_scrollTask"),y=B(i,"zoom"),[p,v]=d.useState(),k=d.useRef(null),S=1+(x?.rows?.length||0),N=d.useMemo(()=>{const E=[];return l&&l.length&&f&&l.forEach(U=>{E.push({height:`${f}px`,top:`${U.$y-3}px`})}),E},[c,f]),_=d.useMemo(()=>Math.max(p||0,s),[p,s]);d.useEffect(()=>{const E=k.current;E&&typeof u=="number"&&(E.scrollTop=u)},[u]);const C=()=>{$()};function $(E){const U=k.current;if(!U)return;const F={};F.left=U.scrollLeft,i.exec("scroll-chart",F)}function L(){const E=k.current,U=Math.ceil((p||0)/(f||1))+1,F=Math.floor((E&&E.scrollTop||0)/(f||1)),P=Math.max(0,F-S),q=F+U+S,R=P*(f||0);i.exec("render-data",{start:P,end:q,from:R})}d.useEffect(()=>{L()},[p,u]);const I=d.useCallback(E=>{if(!E)return;const{id:U,mode:F}=E;if(F.toString().indexOf("x")<0)return;const P=k.current;if(!P)return;const{clientWidth:q}=P,R=i.getTask(U);if(R.$x+R.$w<P.scrollLeft)i.exec("scroll-chart",{left:R.$x-(h||0)}),P.scrollLeft=R.$x-(h||0);else if(R.$x>=q+P.scrollLeft){const Z=q<R.$w?h||0:R.$w;i.exec("scroll-chart",{left:R.$x-q+Z}),P.scrollLeft=R.$x-q+Z}},[i,h]);d.useEffect(()=>{I(m)},[m]);function T(E){if(y&&(E.ctrlKey||E.metaKey)){E.preventDefault();const U=k.current,F=-Math.sign(E.deltaY),P=E.clientX-(U?U.getBoundingClientRect().left:0);i.exec("zoom-scale",{dir:F,offset:P})}}function Y(E){const U=a(E.date,E.unit);return U?{css:U,width:E.width}:null}const K=d.useMemo(()=>x&&(x.minUnit==="hour"||x.minUnit==="day")&&a?x.rows[x.rows.length-1].cells.map(Y):null,[x,a]),D=d.useCallback(E=>{E.eventSource="chart",i.exec("hotkey",E)},[i]);d.useEffect(()=>{const E=k.current;if(!E)return;const U=()=>v(E.clientHeight);U();const F=new ResizeObserver(()=>U());return F.observe(E),()=>{F.disconnect()}},[k.current]);const A=d.useRef(null);return d.useEffect(()=>{const E=k.current;if(E&&!A.current)return A.current=Bn(E,{keys:{arrowup:!0,arrowdown:!0},exec:U=>D(U)}),()=>{A.current?.destroy(),A.current=null}},[]),d.useEffect(()=>{const E=k.current;if(!E)return;const U=T;return E.addEventListener("wheel",U),()=>{E.removeEventListener("wheel",U)}},[T]),tc("chart"),g.jsxs("div",{className:"wx-mR7v2Xag wx-chart",tabIndex:-1,ref:k,onScroll:C,children:[g.jsx(Zl,{highlightTime:a,scales:x}),w&&w.length?g.jsx("div",{className:"wx-mR7v2Xag wx-markers",style:{height:`${_}px`},children:w.map((E,U)=>g.jsx("div",{className:`wx-mR7v2Xag wx-marker ${E.css||""}`,style:{left:`${E.left}px`},children:g.jsx("div",{className:"wx-mR7v2Xag wx-content",children:E.text})},U))}):null,g.jsxs("div",{className:"wx-mR7v2Xag wx-area",style:{width:`${t}px`,height:`${_}px`},children:[K?g.jsx("div",{className:"wx-mR7v2Xag wx-gantt-holidays",style:{height:"100%"},children:K.map((E,U)=>E?g.jsx("div",{className:"wx-mR7v2Xag "+E.css,style:{width:`${E.width}px`,left:`${U*E.width}px`}},U):null)}):null,g.jsx(ql,{borders:o}),l&&l.length?l.map((E,U)=>E.$y?g.jsx("div",{className:"wx-mR7v2Xag wx-selected","data-id":E.id,style:N[U]},E.id):null):null,g.jsx(Jl,{readonly:e,taskTemplate:r})]})]})}function sc(n){const{position:e="after",size:t=4,dir:s="x",onMove:r,onDisplayChange:o,compactMode:a,containerWidth:i=0,leftThreshold:l=50,rightThreshold:c=50}=n,[u,f]=pe(n.value??0),[h,x]=pe(n.display??"all");function w(F){let P=0;e=="center"?P=t/2:e=="before"&&(P=t);const q={size:[t+"px","auto"],p:[F-P+"px","0px"],p2:["auto","0px"]};if(s!="x")for(let R in q)q[R]=q[R].reverse();return q}const[m,y]=d.useState(!1),[p,v]=d.useState(null),k=d.useRef(0),S=d.useRef(),N=d.useRef(),_=d.useRef(h);d.useEffect(()=>{_.current=h},[h]),d.useEffect(()=>{p===null&&u>0&&v(u)},[p,u]);function C(F){return s=="x"?F.clientX:F.clientY}const $=d.useCallback(F=>{const P=S.current+C(F)-k.current;f(P);let q;P<=l?q="chart":i-P<=c?q="grid":q="all",_.current!==q&&(x(q),_.current=q),N.current&&clearTimeout(N.current),N.current=setTimeout(()=>r&&r(P),100)},[i,l,c,r]),L=d.useCallback(()=>{document.body.style.cursor="",document.body.style.userSelect="",y(!1),window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",L)},[$]),I=d.useMemo(()=>h!=="all"?"auto":s=="x"?"ew-resize":"ns-resize",[h,s]),T=d.useCallback(F=>{!a&&(h==="grid"||h==="chart")||(k.current=C(F),S.current=u,y(!0),document.body.style.cursor=I,document.body.style.userSelect="none",window.addEventListener("mousemove",$),window.addEventListener("mouseup",L))},[I,$,L,u,a,h]);function Y(){x("all"),p!==null&&(f(p),r&&r(p))}function K(F){if(a){const P=h==="chart"?"grid":"chart";x(P),o(P)}else if(h==="grid"||h==="chart")Y(),o("all");else{const P=F==="left"?"chart":"grid";x(P),o(P)}}function D(){K("left")}function A(){K("right")}const E=d.useMemo(()=>w(u),[u,e,t,s]),U=["wx-resizer",`wx-resizer-${s}`,`wx-resizer-display-${h}`,m?"wx-resizer-active":""].filter(Boolean).join(" ");return g.jsxs("div",{className:"wx-pFykzMlT "+U,onMouseDown:T,style:{width:E.size[0],height:E.size[1],cursor:I},children:[g.jsxs("div",{className:"wx-pFykzMlT wx-button-expand-box",children:[g.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-left",children:g.jsx("i",{className:"wx-pFykzMlT wxi-menu-left",onClick:D})}),g.jsx("div",{className:"wx-pFykzMlT wx-button-expand-content wx-button-expand-right",children:g.jsx("i",{className:"wx-pFykzMlT wxi-menu-right",onClick:A})})]}),g.jsx("div",{className:"wx-pFykzMlT wx-resizer-line"})]})}const rc=650;function oc(n){let e;function t(){e=new ResizeObserver(r=>{for(let o of r)if(o.target===document.body){let a=o.contentRect.width<=rc;n(a)}}),e.observe(document.body)}function s(){e&&(e.disconnect(),e=null)}return{observe:t,disconnect:s}}function ac(n){const{taskTemplate:e,readonly:t,cellBorders:s,highlightTime:r,onTableAPIChange:o}=n,a=d.useContext(Ze),i=B(a,"_tasks"),l=B(a,"_scales"),c=B(a,"cellHeight"),u=B(a,"columns"),f=B(a,"_scrollTask"),h=B(a,"undo"),[x,w]=d.useState(!1);let[m,y]=d.useState(0);const[p,v]=d.useState(0),[k,S]=d.useState(0),[N,_]=d.useState(void 0),[C,$]=d.useState("all"),L=d.useRef(null),I=d.useCallback(X=>{w(te=>(X!==te&&(X?(L.current=C,C==="all"&&$("grid")):(!L.current||L.current==="all")&&$("all")),X))},[C]);d.useEffect(()=>{const X=oc(I);return X.observe(),()=>{X.disconnect()}},[I]);const T=d.useMemo(()=>{let X;return u.every(te=>te.width&&!te.flexgrow)?X=u.reduce((te,J)=>te+parseInt(J.width),0):x&&C==="chart"?X=parseInt(u.find(te=>te.id==="action")?.width)||50:X=440,m=X,X},[u,x,C]);d.useEffect(()=>{y(T)},[T]);const Y=d.useMemo(()=>(p??0)-(N??0),[p,N]),K=d.useMemo(()=>l.width,[l]),D=d.useMemo(()=>i.length*c,[i,c]),A=d.useMemo(()=>l.height+D+Y,[l,D,Y]),E=d.useMemo(()=>m+K,[m,K]),U=d.useRef(null),F=d.useCallback(()=>{Promise.resolve().then(()=>{if((p??0)>(E??0)){const X=(p??0)-m;a.exec("expand-scale",{minWidth:X})}})},[p,E,m,a]);d.useEffect(()=>{let X;return U.current&&(X=new ResizeObserver(F),X.observe(U.current)),()=>{X&&X.disconnect()}},[U.current,F]),d.useEffect(()=>{F()},[K]);const P=d.useRef(null),q=d.useRef(null),R=d.useCallback(()=>{const X=P.current;X&&a.exec("scroll-chart",{top:X.scrollTop})},[a]),Z=d.useRef({rTasks:[],rScales:{height:0},rCellHeight:0,scrollSize:0,ganttDiv:null,ganttHeight:0});d.useEffect(()=>{Z.current={rTasks:i,rScales:l,rCellHeight:c,scrollSize:Y,ganttDiv:P.current,ganttHeight:k??0}},[i,l,c,Y,k]);const oe=d.useCallback(X=>{if(!X)return;const{rTasks:te,rScales:J,rCellHeight:ae,scrollSize:se,ganttDiv:ie,ganttHeight:He}=Z.current;if(!ie)return;const{id:_e}=X,ge=te.findIndex(le=>le.id===_e);if(ge>-1){const le=He-J.height,he=ge*ae,we=ie.scrollTop;let xe=null;he<we?xe=he:he+ae>we+le&&(xe=he-le+ae+se),xe!==null&&(a.exec("scroll-chart",{top:Math.max(xe,0)}),P.current.scrollTop=Math.max(xe,0))}},[a]);d.useEffect(()=>{oe(f)},[f]),d.useEffect(()=>{const X=P.current,te=q.current;if(!X||!te)return;const J=()=>{Tn.flushSync(()=>{S(X.offsetHeight),v(X.offsetWidth),_(te.offsetWidth)})},ae=new ResizeObserver(J);return ae.observe(X),()=>ae.disconnect()},[P.current]);const fe=d.useRef(null),ce=d.useRef(null);return d.useEffect(()=>{ce.current&&(ce.current.destroy(),ce.current=null);const X=fe.current;if(X)return ce.current=Bn(X,{keys:{"ctrl+c":!0,"ctrl+v":!0,"ctrl+x":!0,"ctrl+d":!0,backspace:!0,"ctrl+z":h,"ctrl+y":h},exec:te=>{te.isInput||a.exec("hotkey",te)}}),()=>{ce.current?.destroy(),ce.current=null}},[h]),g.jsx("div",{className:"wx-jlbQoHOz wx-gantt",ref:P,onScroll:R,children:g.jsx("div",{className:"wx-jlbQoHOz wx-pseudo-rows",style:{height:A,width:"100%"},ref:q,children:g.jsx("div",{className:"wx-jlbQoHOz wx-stuck",style:{height:k,width:N},children:g.jsxs("div",{tabIndex:0,className:"wx-jlbQoHOz wx-layout",ref:fe,children:[u.length?g.jsxs(g.Fragment,{children:[g.jsx(Kl,{display:C,compactMode:x,columnWidth:T,width:m,readonly:t,fullHeight:D,onTableAPIChange:o}),g.jsx(sc,{value:m,display:C,compactMode:x,containerWidth:p,onMove:X=>y(X),onDisplayChange:X=>$(X)})]}):null,g.jsx("div",{className:"wx-jlbQoHOz wx-content",ref:U,children:g.jsx(nc,{readonly:t,fullWidth:K,fullHeight:D,taskTemplate:e,cellBorders:s,highlightTime:r})})]})})})})}function ic(n){return{year:"%Y",quarter:`${n("Q")} %Q`,month:"%M",week:`${n("Week")} %w`,day:"%M %j",hour:"%H:%i"}}function lc(n,e){return typeof n=="function"?n:Qe(n,e)}function Yr(n,e){return n.map(({format:t,...s})=>({...s,format:lc(t,e)}))}function cc(n,e){const t=ic(e);for(let s in t)t[s]=Qe(t[s],n);return t}function uc(n,e){if(!n||!n.length)return n;const t=Qe("%d-%m-%Y",e);return n.map(s=>s.template?s:s.id==="start"||s.id=="end"?{...s,_template:r=>t(r),template:r=>t(r)}:s.id==="duration"?{...s,_template:r=>r,template:r=>r}:s)}function dc(n,e){return n.levels?{...n,levels:n.levels.map(t=>({...t,scales:Yr(t.scales,e)}))}:n}const fc=n=>n.split("-").map(e=>e?e.charAt(0).toUpperCase()+e.slice(1):"").join(""),hc=[{unit:"month",step:1,format:"%F %Y"},{unit:"day",step:1,format:"%j"}],_c=d.forwardRef(function({taskTemplate:n=null,markers:e=[],taskTypes:t=Dr,tasks:s=[],selected:r=[],activeTask:o=null,links:a=[],scales:i=hc,columns:l=si,start:c=null,end:u=null,lengthUnit:f="day",durationUnit:h="day",cellWidth:x=100,cellHeight:w=38,scaleHeight:m=36,readonly:y=!1,cellBorders:p="full",zoom:v=!1,baselines:k=!1,highlightTime:S=null,init:N=null,autoScale:_=!0,unscheduledTasks:C=!1,criticalPath:$=null,schedule:L={type:"forward"},projectStart:I=null,projectEnd:T=null,calendar:Y=null,undo:K=!1,splitTasks:D=!1,summary:A=null,_export:E=!1,...U},F){const P=d.useRef();P.current=U;const q=d.useMemo(()=>new ii(Vs),[]),R=d.useMemo(()=>({...on,...er}),[]),Z=d.useContext(Be.i18n),oe=d.useMemo(()=>Z?Z.extend(R,!0):Dt(R),[Z,R]),fe=d.useMemo(()=>oe.getRaw().calendar,[oe]),ce=d.useMemo(()=>{let le={zoom:dc(v,fe),scales:Yr(i,fe),columns:uc(l,fe),links:Mr(a),cellWidth:x};return le.zoom&&(le={...le,...Ba(le.zoom,cc(fe,oe.getGroup("gantt")),le.scales,x)}),le},[v,i,l,a,x,fe,oe]),X=d.useRef(null);X.current!==s&&(E||En(s,{durationUnit:h,calendar:Y}),X.current=s),d.useEffect(()=>{E||En(s,{durationUnit:h,calendar:Y})},[s,h,Y,D,E]);const te=d.useMemo(()=>q.in,[q]),J=d.useRef(null);J.current===null&&(J.current=new tr((le,he)=>{const we="on"+fc(le);P.current&&P.current[we]&&P.current[we](he)}),te.setNext(J.current));const[ae,se]=d.useState(null),ie=d.useRef(null);ie.current=ae;const He=d.useMemo(()=>({getState:q.getState.bind(q),getReactiveState:q.getReactive.bind(q),getStores:()=>({data:q}),exec:te.exec,setNext:le=>(J.current=J.current.setNext(le),J.current),intercept:te.intercept.bind(te),on:te.on.bind(te),detach:te.detach.bind(te),getTask:q.getTask.bind(q),serialize:()=>q.serialize(),getTable:le=>le?new Promise(he=>setTimeout(()=>he(ie.current),1)):ie.current,getHistory:()=>q.getHistory()}),[q,te]);d.useImperativeHandle(F,()=>({...He}),[He]);const _e=d.useRef(0);d.useEffect(()=>{_e.current?q.init({tasks:s,links:ce.links,start:c,columns:ce.columns,end:u,lengthUnit:f,cellWidth:ce.cellWidth,cellHeight:w,scaleHeight:m,scales:ce.scales,taskTypes:t,zoom:ce.zoom,selected:r,activeTask:o,baselines:k,autoScale:_,unscheduledTasks:C,markers:e,durationUnit:h,criticalPath:$,schedule:L,projectStart:I,projectEnd:T,calendar:Y,undo:K,_weekStart:fe.weekStart,splitTasks:D,summary:A}):N&&N(He),_e.current++},[He,N,s,ce,c,u,f,w,m,t,r,o,k,_,C,e,h,$,L,I,T,Y,K,fe,D,A,q]),_e.current===0&&q.init({tasks:s,links:ce.links,start:c,columns:ce.columns,end:u,lengthUnit:f,cellWidth:ce.cellWidth,cellHeight:w,scaleHeight:m,scales:ce.scales,taskTypes:t,zoom:ce.zoom,selected:r,activeTask:o,baselines:k,autoScale:_,unscheduledTasks:C,markers:e,durationUnit:h,criticalPath:$,schedule:L,projectStart:I,projectEnd:T,calendar:Y,undo:K,_weekStart:fe.weekStart,splitTasks:D,summary:A});const ge=d.useMemo(()=>Y?(le,he)=>he=="day"&&!Y.getDayHours(le)||he=="hour"&&!Y.getDayHours(le)?"wx-weekend":"":S,[Y,S]);return g.jsx(Be.i18n.Provider,{value:oe,children:g.jsx(Ze.Provider,{value:He,children:g.jsx(ac,{taskTemplate:n,readonly:y,cellBorders:p,highlightTime:ge,onTableAPIChange:se})})})});d.forwardRef(function({options:n=[],api:e=null,resolver:t=null,filter:s=null,at:r="point",children:o,onClick:a,css:i},l){const c=d.useRef(null),u=d.useRef(null),f=d.useContext(Be.i18n),h=d.useMemo(()=>f||Dt({...er,...on}),[f]),x=d.useMemo(()=>h.getGroup("gantt"),[h]),w=jt(e,"taskTypes"),m=jt(e,"selected"),y=jt(e,"_selected"),p=jt(e,"splitTasks"),v=jt(e,"summary"),k=d.useMemo(()=>({splitTasks:p,taskTypes:w,summary:v}),[p,w,v]),S=d.useMemo(()=>_s(k),[k]);d.useEffect(()=>{e&&(e.on("scroll-chart",()=>{c.current&&c.current.show&&c.current.show()}),e.on("drag-task",()=>{c.current&&c.current.show&&c.current.show()}))},[e]);function N(D){return D.map(A=>(A={...A},A.text&&(A.text=x(A.text)),A.subtext&&(A.subtext=x(A.subtext)),A.data&&(A.data=N(A.data)),A))}function _(){const D=n.length?n:_s(k);return N(D)}const C=d.useMemo(()=>_(),[e,n,k,x]),$=d.useMemo(()=>y&&y.length?y:[],[y]),L=d.useCallback((D,A)=>{let E=D?e?.getTask(D):null;if(t){const U=t(D,A);E=U===!0?E:U}if(E){const U=ot(A.target,"data-segment");U!==null?u.current={id:E.id,segmentIndex:U}:u.current=E.id,(!Array.isArray(m)||!m.includes(E.id))&&e&&e.exec&&e.exec("select-task",{id:E.id})}return E},[e,t,m]),I=d.useCallback(D=>{const A=D.action;A&&(Er(S,A.id)&&Mt(e,A.id,u.current,x),a&&a(D))},[e,x,a,S]),T=d.useCallback((D,A)=>{const E=$.length?$:A?[A]:[];let U=s?E.every(F=>s(D,F)):!0;if(U&&(D.isHidden&&(U=!E.some(F=>D.isHidden(F,e.getState(),u.current))),D.isDisabled)){const F=E.some(P=>D.isDisabled(P,e.getState(),u.current));D.disabled=F}return U},[s,$,e]);d.useImperativeHandle(l,()=>({show:(D,A)=>{c.current&&c.current.show&&c.current.show(D,A)}}));const Y=d.useCallback(D=>{c.current&&c.current.show&&c.current.show(D)},[]),K=g.jsxs(g.Fragment,{children:[g.jsx(dl,{filter:T,options:C,dataKey:"id",resolver:L,onClick:I,at:r,ref:c,css:i}),g.jsx("span",{onContextMenu:Y,"data-menu-ignore":"true",children:typeof o=="function"?o():o})]});if(!f&&Be.i18n?.Provider){const D=Be.i18n.Provider;return g.jsx(D,{value:h,children:K})}return K});function gc({api:n,autoSave:e,onLinksChange:t}){const s=d.useContext(Be.i18n).getGroup("gantt"),r=B(n,"activeTask"),o=B(n,"_activeTask"),a=B(n,"_links"),i=B(n,"schedule"),l=B(n,"unscheduledTasks"),[c,u]=d.useState();function f(){if(r){const m=a.filter(p=>p.target==r).map(p=>({link:p,task:n.getTask(p.source)})),y=a.filter(p=>p.source==r).map(p=>({link:p,task:n.getTask(p.target)}));return[{title:s("Predecessors"),data:m},{title:s("Successors"),data:y}]}}d.useEffect(()=>{u(f())},[r,a]);const h=d.useMemo(()=>[{id:"e2s",label:s("End-to-start")},{id:"s2s",label:s("Start-to-start")},{id:"e2e",label:s("End-to-end")},{id:"s2e",label:s("Start-to-end")}],[s]);function x(m){e?n.exec("delete-link",{id:m}):(u(y=>(y||[]).map(p=>({...p,data:p.data.filter(v=>v.link.id!==m)}))),t&&t({id:m,action:"delete-link",data:{id:m}}))}function w(m,y){e?n.exec("update-link",{id:m,link:y}):(u(p=>(p||[]).map(v=>({...v,data:v.data.map(k=>k.link.id===m?{...k,link:{...k.link,...y}}:k)}))),t&&t({id:m,action:"update-link",data:{id:m,link:y}}))}return g.jsx(g.Fragment,{children:(c||[]).map((m,y)=>m.data.length?g.jsx("div",{className:"wx-j93aYGQf wx-links",children:g.jsx(Be.fieldId.Provider,{value:null,children:g.jsx(Jt,{label:m.title,position:"top",children:g.jsx("table",{children:g.jsx("tbody",{children:m.data.map(p=>g.jsxs("tr",{children:[g.jsx("td",{className:"wx-j93aYGQf wx-cell",children:g.jsx("div",{className:"wx-j93aYGQf wx-task-name",children:p.task.text||""})}),i?.auto&&p.link.type==="e2s"?g.jsx("td",{className:"wx-j93aYGQf wx-cell wx-link-lag",children:g.jsx(It,{type:"number",placeholder:s("Lag"),value:p.link.lag,disabled:l&&o?.unscheduled,onChange:v=>{v.input||w(p.link.id,{lag:v.value})}})}):null,g.jsx("td",{className:"wx-j93aYGQf wx-cell",children:g.jsx("div",{className:"wx-j93aYGQf wx-wrapper",children:g.jsx(_o,{value:p.link.type,placeholder:s("Select link type"),options:h,onChange:v=>w(p.link.id,{type:v.value}),children:({option:v})=>v.label})})}),g.jsx("td",{className:"wx-j93aYGQf wx-cell",children:g.jsx("i",{className:"wx-j93aYGQf wxi-delete wx-delete-icon",onClick:()=>x(p.link.id),role:"button"})})]},p.link.id))})})})})},y):null)})}function xc(n){const{value:e,time:t,format:s,onchange:r,onChange:o,...a}=n,i=o??r;function l(c){const u=new Date(c.value);u.setHours(e.getHours()),u.setMinutes(e.getMinutes()),i&&i({value:u})}return g.jsxs("div",{className:"wx-hFsbgDln date-time-controll",children:[g.jsx(Oo,{...a,value:e,onChange:l,format:s,buttons:["today"],clear:!1}),t?g.jsx(Vo,{value:e,onChange:i,format:s}):null]})}Pe("select",Xs);Pe("date",xc);Pe("twostate",Qs);Pe("slider",Sn);Pe("counter",Po);Pe("links",gc);function Cc({fonts:n=!0,children:e}){return e?g.jsx(hs,{fonts:n,children:e}):g.jsx(hs,{fonts:n})}function jc({fonts:n=!0,children:e}){return e?g.jsx(gs,{fonts:n,children:e}):g.jsx(gs,{fonts:n})}export{_c as A,pc as R,jc as V,Cc as _,g as j,eo as r};
//# sourceMappingURL=vendor-svar-ByJVIq39.js.map
